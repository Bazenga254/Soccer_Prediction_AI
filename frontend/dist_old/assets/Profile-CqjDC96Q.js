import{u as oe,a as ce,b as de,r,c as o,j as e}from"./index-B3SC9TNl.js";import{i as ue,s as pe}from"./sounds-Ck9TXWp9.js";function he(){const{t:s}=oe(),{user:l,updateUser:x,refreshProfile:O,logout:H}=ce(),W=de(),[V,j]=r.useState(!1),[_,C]=r.useState(l?.username||""),[d,v]=r.useState(null),[D,t]=r.useState(""),[L,n]=r.useState(""),[u,Z]=r.useState(null),[T,Y]=r.useState(null),[E,Q]=r.useState(!1),[R,A]=r.useState(!1),p=r.useRef(null),[g,G]=r.useState(l?.full_name||""),[N,J]=r.useState(l?.date_of_birth||""),[y,K]=r.useState(l?.security_question||""),[b,U]=r.useState(""),[P,w]=r.useState(!1),[k,X]=r.useState(ue),[ee,f]=r.useState(!1),[m,F]=r.useState(""),[S,I]=r.useState(""),[$,z]=r.useState(!1),[M,c]=r.useState("");if(r.useEffect(()=>{(async()=>{try{const i=await o.get("/api/user/referral-stats");Z(i.data)}catch{}})(),o.get("/api/pricing").then(i=>{Y(i.data?.commissions?.referral_rate)}).catch(()=>{})},[]),!l)return null;const se=async a=>{if(a.length<3){v(null);return}try{const i=await o.get(`/api/user/check-username/${a}`);v(i.data.available||a===l.username)}catch{v(null)}},ae=async()=>{t(""),n("");try{const a=await o.put("/api/user/username",{username:_});a.data.success&&(x({username:a.data.username,display_name:a.data.display_name}),j(!1),n(s("profile.usernameUpdated")),setTimeout(()=>n(""),3e3))}catch(a){t(a.response?.data?.detail||"Failed to update username")}},le=async a=>{const i=a.target.files?.[0];if(i){if(i.size>2*1024*1024){t(s("profile.imageSize")),setTimeout(()=>t(""),3e3);return}if(!["image/jpeg","image/png","image/gif","image/webp"].includes(i.type)){t(s("profile.imageType")),setTimeout(()=>t(""),3e3);return}Q(!0),t("");try{const h=new FormData;h.append("file",i);const B=await o.post("/api/user/avatar",h,{headers:{"Content-Type":"multipart/form-data"}});B.data.success&&(x({avatar_url:B.data.avatar_url}),n(s("profile.avatarUpdated")),setTimeout(()=>n(""),3e3))}catch(h){t(h.response?.data?.detail||"Failed to upload avatar")}finally{Q(!1),p.current&&(p.current.value="")}}},re=async()=>{t("");try{(await o.delete("/api/user/avatar")).data.success&&(x({avatar_url:null}),n(s("profile.avatarRemoved")),setTimeout(()=>n(""),3e3))}catch(a){t(a.response?.data?.detail||"Failed to remove avatar")}},te=async()=>{t(""),n(""),w(!0);try{const a={};if(g!==(l.full_name||"")&&(a.full_name=g),N!==(l.date_of_birth||"")&&(a.date_of_birth=N),y!==(l.security_question||"")&&(a.security_question=y),b.trim()&&(a.security_answer=b),Object.keys(a).length===0){t(s("profile.noChanges")),setTimeout(()=>t(""),3e3),w(!1);return}await o.put("/api/user/personal-info",a),await O(),U(""),n(s("profile.personalInfoUpdated")),setTimeout(()=>n(""),3e3)}catch(a){t(a.response?.data?.detail||"Failed to update personal info"),setTimeout(()=>t(""),5e3)}finally{w(!1)}},ie=async()=>{if(c(""),S!=="DELETE"){c(s("profile.pleaseTypeDelete"));return}if(!m){c(s("profile.pleaseEnterPassword"));return}z(!0);try{await o.delete("/api/user/account",{data:{password:m}}),f(!1),H(),W("/")}catch(a){c(a.response?.data?.detail||"Failed to delete account")}finally{z(!1)}},q=`${window.location.origin}/ref/${l.username}`,ne=()=>{navigator.clipboard.writeText(q),A(!0),setTimeout(()=>A(!1),2e3)};return e.jsxs("div",{className:"profile-page",children:[e.jsxs("div",{className:"profile-container",children:[e.jsx("h2",{className:"profile-title",children:s("profile.title")}),D&&e.jsx("div",{className:"profile-error",children:D}),L&&e.jsx("div",{className:"profile-success",children:L}),e.jsxs("div",{className:"profile-header-section",children:[e.jsxs("div",{className:"profile-avatar-wrapper",children:[l.avatar_url?e.jsx("img",{src:l.avatar_url,alt:"Avatar",className:"profile-avatar-large profile-avatar-img"}):e.jsx("div",{className:"profile-avatar-large",style:{background:l.avatar_color},children:(l.display_name||l.username||"?")[0].toUpperCase()}),e.jsx("button",{className:"avatar-upload-btn",onClick:()=>p.current?.click(),disabled:E,title:"Change photo",children:E?e.jsx("span",{className:"avatar-upload-spinner"}):e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"}),e.jsx("circle",{cx:"12",cy:"13",r:"4"})]})}),l.avatar_url&&e.jsx("button",{className:"avatar-remove-btn",onClick:re,title:"Remove photo",children:e.jsxs("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})}),e.jsx("input",{ref:p,type:"file",accept:"image/jpeg,image/png,image/gif,image/webp",onChange:le,style:{display:"none"}})]}),e.jsxs("div",{className:"profile-header-info",children:[e.jsx("div",{className:"profile-display-name",children:l.display_name}),e.jsxs("div",{className:"profile-username",children:["@",l.username]}),e.jsx("span",{className:`tier-badge ${l.tier}`,children:l.tier==="pro"?"PRO":l.tier==="trial"?"TRIAL":"FREE"})]})]}),e.jsxs("div",{className:"profile-field",children:[e.jsx("label",{children:s("profile.username")}),V?e.jsxs("div",{className:"profile-edit-row",children:[e.jsxs("div",{className:"username-input-wrap",children:[e.jsx("input",{type:"text",value:_,onChange:a=>{const i=a.target.value.replace(/[^a-zA-Z0-9]/g,"");C(i),se(i)},maxLength:24,autoFocus:!0}),d!==null&&e.jsx("span",{className:`username-status ${d?"available":"taken"}`,children:s(d?"common.available":"common.taken")})]}),e.jsx("button",{className:"save-btn",onClick:ae,disabled:d===!1,children:s("common.save")}),e.jsx("button",{className:"cancel-btn",onClick:()=>j(!1),children:s("common.cancel")})]}):e.jsxs("div",{className:"profile-value-row",children:[e.jsxs("span",{children:["@",l.username]}),e.jsx("button",{className:"edit-btn",onClick:()=>{j(!0),C(l.username)},children:s("common.edit")})]})]}),e.jsxs("div",{className:"profile-field",children:[e.jsx("label",{children:s("profile.email")}),e.jsx("div",{className:"profile-value-row",children:e.jsx("span",{children:l.email})})]}),e.jsxs("div",{className:"profile-personal-info",children:[e.jsx("h3",{className:"profile-section-title",children:s("profile.personalInfo")}),e.jsx("p",{className:"profile-section-desc",children:s("profile.personalInfoDesc")}),e.jsxs("div",{className:"personal-info-form",children:[e.jsxs("div",{className:"personal-info-field",children:[e.jsx("label",{children:s("profile.fullName")}),e.jsx("input",{type:"text",value:g,onChange:a=>G(a.target.value),placeholder:s("profile.enterFullName"),maxLength:100})]}),e.jsxs("div",{className:"personal-info-field",children:[e.jsx("label",{children:s("profile.dateOfBirth")}),e.jsx("input",{type:"date",value:N,onChange:a=>J(a.target.value)})]}),e.jsxs("div",{className:"personal-info-field",children:[e.jsxs("label",{children:[s("profile.securityQuestion")," ",l.security_question&&e.jsx("span",{className:"security-set-badge",children:s("profile.set")})]}),e.jsxs("select",{value:y,onChange:a=>K(a.target.value),disabled:!!l.security_question,children:[e.jsx("option",{value:"",children:s("profile.selectSecurityQuestion")}),e.jsx("option",{value:s("auth.secQ1"),children:s("auth.secQ1")}),e.jsx("option",{value:s("auth.secQ2"),children:s("auth.secQ2")}),e.jsx("option",{value:s("auth.secQ3"),children:s("auth.secQ3")}),e.jsx("option",{value:s("auth.secQ4"),children:s("auth.secQ4")}),e.jsx("option",{value:s("auth.secQ5"),children:s("auth.secQ5")}),e.jsx("option",{value:s("auth.secQ6"),children:s("auth.secQ6")})]}),l.security_question&&e.jsx("p",{className:"security-question-disclaimer",children:s("profile.securityQuestionDisclaimer")})]}),e.jsxs("div",{className:"personal-info-field",children:[e.jsxs("label",{children:[s("profile.securityAnswer")," ",l.has_security_answer&&e.jsx("span",{className:"security-set-badge",children:s("profile.set")})]}),e.jsx("input",{type:"text",value:b,onChange:a=>U(a.target.value),placeholder:l.has_security_answer?s("profile.enterNewAnswer"):s("auth.enterYourAnswer"),maxLength:200})]}),e.jsx("button",{className:"save-personal-btn",onClick:te,disabled:P,children:s(P?"common.saving":"profile.savePersonalInfo")})]})]}),e.jsxs("div",{className:"profile-preferences",children:[e.jsx("h3",{className:"profile-section-title",children:s("profile.preferences")}),e.jsxs("div",{className:"preference-row",children:[e.jsxs("div",{className:"preference-info",children:[e.jsx("span",{className:"preference-label",children:s("profile.soundNotifications")}),e.jsx("span",{className:"preference-desc",children:s("profile.soundDesc")})]}),e.jsx("button",{className:`sound-toggle ${k?"on":"off"}`,onClick:()=>{const a=!k;X(a),pe(a)},"aria-label":k?"Disable sounds":"Enable sounds",children:e.jsx("span",{className:"sound-toggle-knob"})})]})]}),e.jsxs("div",{className:"profile-field",children:[e.jsx("label",{children:s("profile.referralProgram")}),e.jsxs("div",{className:"referral-card",children:[e.jsxs("div",{className:"referral-code-section",children:[e.jsx("span",{className:"referral-label",children:s("profile.yourReferralLink")}),e.jsxs("div",{className:"referral-code-row",children:[e.jsx("span",{className:"referral-link-display",children:q}),e.jsx("button",{className:`copy-referral-btn${R?" copied":""}`,onClick:ne,children:s(R?"common.copied":"common.copy")})]})]}),e.jsxs("div",{className:"referral-stats-row",children:[e.jsxs("div",{className:"referral-stat",children:[e.jsx("span",{className:"referral-stat-value",children:u?.total_referred||0}),e.jsx("span",{className:"referral-stat-label",children:s("profile.referrals")})]}),e.jsxs("div",{className:"referral-stat",children:[e.jsx("span",{className:"referral-stat-value",children:u?.pro_referred||0}),e.jsx("span",{className:"referral-stat-label",children:s("profile.proSignups")})]}),e.jsxs("div",{className:"referral-stat",children:[e.jsx("span",{className:"referral-stat-value",children:T?`${Math.round(T*100)}%`:"30%"}),e.jsx("span",{className:"referral-stat-label",children:s("profile.commission")})]})]}),u?.referrals?.length>0&&e.jsxs("div",{className:"referral-list",children:[e.jsx("span",{className:"referral-list-title",children:s("profile.yourReferrals")}),u.referrals.map(a=>e.jsxs("div",{className:"referral-list-item",children:[e.jsx("span",{className:"referral-list-name",children:a.display_name}),e.jsx("span",{className:`tier-tag ${a.tier}`,children:a.tier.toUpperCase()}),e.jsx("span",{className:"referral-list-date",children:new Date(a.joined).toLocaleDateString()})]},a.id))]}),e.jsx("p",{className:"referral-hint",children:s("profile.referralHint")})]})]}),e.jsxs("div",{className:"profile-field",children:[e.jsx("label",{children:s("profile.memberSince")}),e.jsx("div",{className:"profile-value-row",children:e.jsx("span",{children:new Date(l.created_at).toLocaleDateString()})})]}),e.jsxs("div",{className:"profile-danger-zone",children:[e.jsx("h3",{className:"danger-zone-title",children:s("profile.dangerZone")}),e.jsx("p",{className:"danger-zone-desc",children:s("profile.dangerZoneDesc")}),e.jsxs("button",{className:"delete-account-btn",onClick:()=>f(!0),children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("polyline",{points:"3 6 5 6 21 6"}),e.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})]}),s("profile.deleteAccount")]})]})]}),ee&&e.jsx("div",{className:"delete-modal-overlay",onClick:()=>f(!1),children:e.jsxs("div",{className:"delete-modal",onClick:a=>a.stopPropagation(),children:[e.jsx("h3",{className:"delete-modal-title",children:s("profile.deleteAccountTitle")}),e.jsxs("div",{className:"delete-modal-warning",children:[e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"}),e.jsx("line",{x1:"12",y1:"9",x2:"12",y2:"13"}),e.jsx("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})]}),e.jsx("p",{dangerouslySetInnerHTML:{__html:s("profile.deleteWarning")}})]}),M&&e.jsx("div",{className:"delete-modal-error",children:M}),e.jsxs("div",{className:"delete-modal-field",children:[e.jsx("label",{children:s("profile.enterPasswordConfirm")}),e.jsx("input",{type:"password",value:m,onChange:a=>F(a.target.value),placeholder:s("profile.yourPassword")})]}),e.jsxs("div",{className:"delete-modal-field",children:[e.jsx("label",{dangerouslySetInnerHTML:{__html:s("profile.typeDelete")}}),e.jsx("input",{type:"text",value:S,onChange:a=>I(a.target.value),placeholder:"DELETE"})]}),e.jsxs("div",{className:"delete-modal-actions",children:[e.jsx("button",{className:"delete-modal-cancel",onClick:()=>{f(!1),F(""),I(""),c("")},children:s("common.cancel")}),e.jsx("button",{className:"delete-modal-confirm",onClick:ie,disabled:$||S!=="DELETE"||!m,children:s($?"profile.deleting":"profile.permanentlyDelete")})]})]})})]})}export{he as default};
