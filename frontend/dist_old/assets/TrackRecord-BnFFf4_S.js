import{u as S,r as t,j as a,c as i}from"./index-B3SC9TNl.js";function L(){const{t:r}=S(),[n,m]=t.useState([]),[s,p]=t.useState(null),[f,u]=t.useState(!0),[x,j]=t.useState(null),[N,y]=t.useState(!1),[v,o]=t.useState(!1),[h,_]=t.useState({}),d=async()=>{try{u(!0);const[e,c]=await Promise.allSettled([i.get("/api/predictions?limit=100"),i.get("/api/predictions/accuracy")]);e.status==="fulfilled"&&m(e.value.data.predictions||[]),c.status==="fulfilled"&&p(c.value.data)}catch(e){console.error("Error fetching predictions:",e)}finally{u(!1)}},w=async()=>{u(!0);try{await i.post("/api/predictions/refresh-results")}catch{}await d()};t.useEffect(()=>{d()},[]);const k=async e=>{const c=h[e];if(!(!c||c.home===void 0||c.away===void 0)){j(e);try{await i.post("/api/predictions/update-result",{fixture_id:e,home_goals:parseInt(c.home),away_goals:parseInt(c.away)}),await d()}catch(l){console.error("Error updating result:",l)}finally{j(null)}}},C=async()=>{y(!0);try{await i.delete("/api/predictions/clear"),m([]),p(null),o(!1),await d()}catch(e){console.error("Error clearing predictions:",e)}finally{y(!1)}},b=(e,c,l)=>{_(g=>({...g,[e]:{...g[e],[c]:l}}))},R=e=>{const c=e.predicted_result_prob;return c?c>=65?{label:"High",className:"prob-high"}:c>=45?{label:"Medium",className:"prob-medium"}:{label:"Low",className:"prob-low"}:null};return f?a.jsx("div",{className:"track-record-page",children:a.jsxs("div",{className:"loading-container",children:[a.jsx("div",{className:"spinner"}),a.jsx("p",{children:r("common.loading")})]})}):a.jsxs("div",{className:"track-record-page",children:[a.jsxs("div",{className:"track-record-header",children:[a.jsx("h1",{children:r("trackRecord.title")}),a.jsxs("div",{className:"track-record-actions",children:[a.jsx("button",{className:"refresh-btn",onClick:w,children:r("common.refresh")}),n.length>0&&a.jsx("button",{className:"clear-all-btn",onClick:()=>o(!0),children:"Clear All"})]})]}),v&&a.jsx("div",{className:"clear-confirm-overlay",onClick:()=>o(!1),children:a.jsxs("div",{className:"clear-confirm-modal",onClick:e=>e.stopPropagation(),children:[a.jsx("h3",{children:"Clear All Predictions?"}),a.jsxs("p",{children:["This will permanently delete all ",n.length," prediction",n.length!==1?"s":""," and reset your accuracy stats. This cannot be undone."]}),a.jsxs("div",{className:"clear-confirm-actions",children:[a.jsx("button",{className:"clear-cancel-btn",onClick:()=>o(!1),children:r("common.cancel")}),a.jsx("button",{className:"clear-delete-btn",onClick:C,disabled:N,children:N?"Clearing...":"Yes, Clear All"})]})]})}),s&&s.total_predictions>0&&a.jsxs("div",{className:"accuracy-cards",children:[a.jsxs("div",{className:"accuracy-card total",children:[a.jsx("div",{className:"accuracy-number",children:s.total_predictions}),a.jsx("div",{className:"accuracy-label",children:r("trackRecord.totalPredictions")}),a.jsxs("div",{className:"accuracy-sub",children:[s.matches_finished," finished, ",s.pending," ",r("trackRecord.pending").toLowerCase()]})]}),a.jsxs("div",{className:`accuracy-card ${s.result_accuracy.percentage>=50?"good":"needs-work"}`,children:[a.jsxs("div",{className:"accuracy-number",children:[s.result_accuracy.percentage,"%"]}),a.jsxs("div",{className:"accuracy-label",children:["1X2 ",r("trackRecord.accuracy")]}),a.jsxs("div",{className:"accuracy-sub",children:[s.result_accuracy.correct,"/",s.result_accuracy.total," ",r("trackRecord.correct").toLowerCase()]})]}),a.jsxs("div",{className:`accuracy-card ${s.over25_accuracy.percentage>=50?"good":"needs-work"}`,children:[a.jsxs("div",{className:"accuracy-number",children:[s.over25_accuracy.percentage,"%"]}),a.jsx("div",{className:"accuracy-label",children:"Over/Under 2.5"}),a.jsxs("div",{className:"accuracy-sub",children:[s.over25_accuracy.correct,"/",s.over25_accuracy.total," ",r("trackRecord.correct").toLowerCase()]})]}),a.jsxs("div",{className:`accuracy-card ${s.btts_accuracy.percentage>=50?"good":"needs-work"}`,children:[a.jsxs("div",{className:"accuracy-number",children:[s.btts_accuracy.percentage,"%"]}),a.jsxs("div",{className:"accuracy-label",children:["BTTS ",r("trackRecord.accuracy")]}),a.jsxs("div",{className:"accuracy-sub",children:[s.btts_accuracy.correct,"/",s.btts_accuracy.total," ",r("trackRecord.correct").toLowerCase()]})]})]}),a.jsxs("div",{className:"predictions-table-container",children:[a.jsx("h2",{children:"Prediction History"}),n.length===0?a.jsx("div",{className:"no-predictions",children:a.jsx("p",{children:r("trackRecord.noPredictions")})}):a.jsxs("div",{className:"predictions-table",children:[a.jsxs("div",{className:"pred-table-header",children:[a.jsx("span",{className:"col-date",children:"Date"}),a.jsx("span",{className:"col-match",children:"Match"}),a.jsx("span",{className:"col-pick",children:"Our Pick"}),a.jsx("span",{className:"col-prob",children:"Probability"}),a.jsx("span",{className:"col-result",children:"Result"}),a.jsx("span",{className:"col-correct",children:"Status"})]}),n.map(e=>{const c=R(e);return a.jsxs("div",{className:`pred-table-row ${e.match_finished?e.result_correct?"correct":"wrong":"pending"}`,children:[a.jsx("span",{className:"col-date",children:new Date(e.match_date||e.created_at).toLocaleDateString("en-GB",{day:"2-digit",month:"short"})}),a.jsx("span",{className:"col-match",children:a.jsxs("span",{className:"match-teams-text",children:[e.team_a_name," vs ",e.team_b_name]})}),a.jsx("span",{className:"col-pick",children:e.predicted_result}),a.jsxs("span",{className:"col-prob",children:[a.jsxs("span",{className:"prob-value",children:[e.predicted_result_prob?.toFixed(0),"%"]}),c&&a.jsx("span",{className:`prob-badge ${c.className}`,children:c.label})]}),a.jsx("span",{className:"col-result",children:e.match_finished?a.jsxs("span",{className:"actual-score",children:[e.actual_home_goals," - ",e.actual_away_goals]}):a.jsxs("span",{className:"enter-score",children:[a.jsx("input",{type:"number",min:"0",max:"20",placeholder:"H",className:"score-input",value:h[e.fixture_id]?.home??"",onChange:l=>b(e.fixture_id,"home",l.target.value)}),a.jsx("span",{children:"-"}),a.jsx("input",{type:"number",min:"0",max:"20",placeholder:"A",className:"score-input",value:h[e.fixture_id]?.away??"",onChange:l=>b(e.fixture_id,"away",l.target.value)}),a.jsx("button",{className:"submit-score-btn",onClick:()=>k(e.fixture_id),disabled:x===e.fixture_id,children:x===e.fixture_id?"...":"OK"})]})}),a.jsx("span",{className:"col-correct",children:e.match_finished?e.result_correct?a.jsx("span",{className:"status-correct",children:"WIN"}):a.jsx("span",{className:"status-wrong",children:"LOSS"}):a.jsx("span",{className:"status-pending",children:r("trackRecord.pending")})})]},e.fixture_id)})]})]})]})}export{L as default};
