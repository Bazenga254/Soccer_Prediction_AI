import{u as O,f as Z,h as te,r as a,c as $,j as e,R as X,a as K,b as ee,C as Y}from"./index-B3SC9TNl.js";import{M as ae,W as ie}from"./WhopCheckoutModal-DrBcKNRG.js";const z=new Set,ne=[{value:"best",labelKey:"community.best",icon:"ðŸ†"},{value:"new",labelKey:"community.new",icon:"ðŸ†•"},{value:"top_rated",labelKey:"community.topRated",icon:"â­"},{value:"hot",labelKey:"community.hot",icon:"ðŸ”¥"}];function ce({rating:s,onRate:i,interactive:j=!1}){const[r,n]=a.useState(0);return e.jsx("div",{className:"star-rating",children:[1,2,3,4,5].map(x=>e.jsx("span",{className:`star ${x<=(r||s)?"filled":""} ${j?"clickable":""}`,onClick:()=>j&&i&&i(x),onMouseEnter:()=>j&&n(x),onMouseLeave:()=>j&&n(0),children:"â˜…"},x))})}const le=["âš½","ðŸ¥…","ðŸ†","ðŸ”¥","ðŸ’ª","ðŸ‘","ðŸŽ¯","ðŸ‘","ðŸ‘Ž","ðŸ˜‚","ðŸ˜­","ðŸ™","â¤ï¸","ðŸ’¯","ðŸ¤”","ðŸ˜","ðŸ¤£","ðŸ’€","ðŸ˜¤","ðŸ«¡","ðŸŽ‰","ðŸ˜Ž","ðŸ¤","ðŸ’°","â­","ðŸš€","ðŸ˜±"];function oe({onSelect:s}){return e.jsx("div",{className:"emoji-picker",onClick:i=>i.stopPropagation(),children:e.jsx("div",{className:"emoji-picker-grid",children:le.map(i=>e.jsx("button",{className:"emoji-picker-btn",onClick:()=>s(i),type:"button",children:i},i))})})}function re({predictionId:s}){const{user:i}=K(),{t:j}=O(),[r,n]=a.useState([]),[x,L]=a.useState(""),[N,g]=a.useState(!1),[d,k]=a.useState(!1),[y,_]=a.useState(0),[h,F]=a.useState(!1),C=a.useRef(0),E=a.useRef(null),o=a.useRef(null),T=a.useRef(null),S=async(m=0)=>{try{const b=(await $.get(`/api/community/${s}/chat?since_id=${m}`)).data.messages||[];m===0?(n(b),_(b.length)):b.length>0&&(n(u=>[...u,...b]),_(u=>u+b.length)),b.length>0&&(C.current=b[b.length-1].id)}catch{}};a.useEffect(()=>(d&&(C.current=0,S(0)),()=>{o.current&&clearInterval(o.current)}),[d]),a.useEffect(()=>{if(d)return o.current=setInterval(()=>{S(C.current)},3e3),()=>clearInterval(o.current)},[d]),a.useEffect(()=>{d&&E.current&&E.current.scrollIntoView({behavior:"smooth"})},[r.length,d]);const R=async()=>{if(x.trim()){g(!0),F(!1);try{const m=await $.post(`/api/community/${s}/chat`,{message:x});m.data.success&&(n(w=>[...w,m.data.chat]),C.current=m.data.chat.id,L(""),_(w=>w+1))}catch{}g(!1)}},P=m=>{L(w=>w+m),T.current?.focus()},M=m=>new Date(m).toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"});return e.jsxs("div",{className:"live-chat-section",children:[e.jsxs("button",{className:"live-chat-toggle",onClick:()=>k(!d),children:[e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"})}),e.jsx("span",{children:j(d?"community.hideChat":"community.liveChat")}),y>0&&!d&&e.jsx("span",{className:"chat-count-badge",children:y}),d&&e.jsx("span",{className:"live-dot"})]}),d&&e.jsxs("div",{className:"live-chat-panel",children:[e.jsxs("div",{className:"live-chat-messages",children:[r.length===0&&e.jsx("p",{className:"chat-empty",children:j("community.noChatMessages")}),r.map(m=>e.jsxs("div",{className:`chat-bubble ${m.user_id===i?.id?"own":""}`,children:[e.jsx("span",{className:"chat-avatar",style:{background:m.avatar_color},children:(m.display_name||"?")[0].toUpperCase()}),e.jsxs("div",{className:"chat-bubble-content",children:[e.jsxs("div",{className:"chat-bubble-header",children:[e.jsx("strong",{children:m.display_name}),e.jsx("span",{className:"chat-time",children:M(m.created_at)})]}),e.jsx("p",{className:"chat-text",children:m.message})]})]},m.id)),e.jsx("div",{ref:E})]}),e.jsxs("div",{className:"live-chat-input",children:[e.jsx("button",{className:"emoji-toggle-btn",onClick:()=>F(!h),type:"button",title:"Emojis",children:"ðŸ˜€"}),h&&e.jsx(oe,{onSelect:P}),e.jsx("input",{ref:T,type:"text",value:x,onChange:m=>L(m.target.value),placeholder:j("community.typeMessage"),maxLength:500,onKeyDown:m=>m.key==="Enter"&&R(),disabled:N}),e.jsx("button",{className:"chat-send-btn",onClick:R,disabled:N||!x.trim(),children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"22",y1:"2",x2:"11",y2:"13"}),e.jsx("polygon",{points:"22 2 15 22 11 13 2 9 22 2"})]})})]})]})]})}function me({predictionId:s,initialLikes:i=0,initialDislikes:j=0,onLiked:r}){const{user:n}=K(),[x,L]=a.useState(i),[N,g]=a.useState(j),[d,k]=a.useState(null),y=async _=>{if(n)try{const h=await $.post(`/api/community/${s}/react`,{reaction:_});h.data.success&&(L(h.data.likes),g(h.data.dislikes),k(h.data.user_reaction),h.data.user_reaction==="like"&&r&&r())}catch{}};return e.jsxs("div",{className:"reaction-buttons",children:[e.jsxs("button",{className:`reaction-btn like ${d==="like"?"active":""}`,onClick:()=>y("like"),title:"Like",children:[e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:d==="like"?"currentColor":"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"})}),e.jsx("span",{children:x})]}),e.jsxs("button",{className:`reaction-btn dislike ${d==="dislike"?"active":""}`,onClick:()=>y("dislike"),title:"Dislike",children:[e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:d==="dislike"?"currentColor":"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M10 15v4a3 3 0 0 0 3 3l4-9V2H5.72a2 2 0 0 0-2 1.7l-1.38 9a2 2 0 0 0 2 2.3zm7-13h2.67A2.31 2.31 0 0 1 22 4v7a2.31 2.31 0 0 1-2.33 2H17"})}),e.jsx("span",{children:N})]})]})}function de({userId:s,displayName:i,avatarColor:j,onClose:r,onFollowed:n}){const{t:x}=O(),L=async()=>{try{(await $.post(`/api/community/follow/${s}`)).data.success&&n()}catch{}r()};return e.jsx("div",{className:"follow-prompt-overlay",onClick:r,children:e.jsxs("div",{className:"follow-prompt-modal",onClick:N=>N.stopPropagation(),children:[e.jsx("div",{className:"follow-prompt-avatar",style:{background:j},children:(i||"?")[0].toUpperCase()}),e.jsx("h3",{children:x("community.likePredictions")}),e.jsx("p",{dangerouslySetInnerHTML:{__html:x("community.followNotify",{name:i})}}),e.jsxs("div",{className:"follow-prompt-actions",children:[e.jsx("button",{className:"follow-prompt-btn primary",onClick:L,children:x("community.follow")}),e.jsx("button",{className:"follow-prompt-btn secondary",onClick:r,children:x("community.notNow")})]})]})})}function ue({userId:s,displayName:i,avatarColor:j,onClose:r}){const{t:n}=O(),[x,L]=a.useState(null),[N,g]=a.useState(!0);return a.useEffect(()=>{(async()=>{try{const k=await $.get(`/api/community/user-stats/${s}`);L(k.data)}catch{}g(!1)})()},[s]),e.jsx("div",{className:"modal-overlay",onClick:r,children:e.jsxs("div",{className:"user-stats-modal",onClick:d=>d.stopPropagation(),children:[e.jsx("button",{className:"modal-close-btn",onClick:r,children:"Ã—"}),e.jsxs("div",{className:"user-stats-header",children:[e.jsx("span",{className:"predictor-avatar",style:{background:j,width:48,height:48,fontSize:20},children:(i||"?")[0].toUpperCase()}),e.jsx("h3",{style:{margin:0,color:"#f1f5f9"},children:i})]}),N?e.jsx("div",{style:{textAlign:"center",padding:20,color:"#94a3b8"},children:"Loading..."}):x?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"stats-summary",children:[e.jsxs("div",{className:"stat-item wins",children:[e.jsx("span",{className:"stat-number",children:x.wins}),e.jsx("span",{className:"stat-label",children:"Wins"})]}),e.jsxs("div",{className:"stat-item losses",children:[e.jsx("span",{className:"stat-number",children:x.losses}),e.jsx("span",{className:"stat-label",children:"Losses"})]}),e.jsxs("div",{className:"stat-item percentage",children:[e.jsxs("span",{className:"stat-number",children:[x.win_percentage,"%"]}),e.jsx("span",{className:"stat-label",children:"Win Rate"})]}),e.jsxs("div",{className:"stat-item pending",children:[e.jsx("span",{className:"stat-number",children:x.pending}),e.jsx("span",{className:"stat-label",children:"Pending"})]})]}),x.recent_history.length>0&&e.jsxs("div",{className:"stats-history",children:[e.jsx("h4",{style:{color:"#94a3b8",margin:"0 0 12px",fontSize:13},children:"Recent Results"}),e.jsxs("table",{className:"history-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Match"}),e.jsx("th",{children:"Predicted"}),e.jsx("th",{children:"Actual"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:x.recent_history.map((d,k)=>e.jsxs("tr",{className:d.correct?"row-correct":"row-incorrect",children:[e.jsx("td",{children:d.match}),e.jsx("td",{children:d.predicted}),e.jsx("td",{children:d.actual}),e.jsx("td",{style:{textAlign:"center"},children:d.correct?"âœ…":"âŒ"})]},k))})]})]})]}):e.jsx("div",{style:{textAlign:"center",padding:20,color:"#94a3b8"},children:"No data available"})]})})}function q({pred:s,onRate:i,onPurchase:j}){const{user:r}=K(),{t:n}=O(),{isKenyan:x}=Z(),L=ee(),N=r?.id===s.user_id,[g,d]=a.useState(!1),[k,y]=a.useState(!1),[_,h]=a.useState(!1),[F,C]=a.useState(!1),[E,o]=a.useState(!1),[T,S]=a.useState(!1),R=a.useRef(null),P=s.slip_picks&&s.slip_picks.length>1;a.useEffect(()=>{if(!R.current||z.has(s.id))return;const t=new IntersectionObserver(([c])=>{c.isIntersecting&&!z.has(s.id)&&(z.add(s.id),$.post("/api/community/track-views",{prediction_ids:[s.id]}).catch(()=>{}),t.disconnect())},{threshold:.5});return t.observe(R.current),()=>t.disconnect()},[s.id]);const[M,m]=a.useState({isFollowing:!1,followersCount:s.followers_count||0,loaded:!1});a.useEffect(()=>{if(!r||N)return;let t=!1;return(async()=>{try{const v=await $.get(`/api/community/follow-status/${s.user_id}`);t||m({isFollowing:v.data.is_following,followersCount:v.data.followers_count,loaded:!0})}catch{}})(),()=>{t=!0}},[s.user_id,r,N]);const w=async t=>{if(t.stopPropagation(),!N){if(!r){L("/login");return}try{if(M.isFollowing){const c=await $.delete(`/api/community/follow/${s.user_id}`);c.data.success&&m(v=>({...v,isFollowing:!1,followersCount:c.data.followers_count}))}else{const c=await $.post(`/api/community/follow/${s.user_id}`);c.data.success&&m(v=>({...v,isFollowing:!0,followersCount:c.data.followers_count}))}}catch{}}},b=()=>{$.post(`/api/community/${s.id}/track-click`).catch(()=>{});const t=(s.fixture_id||"").split("-");if(t.length>=2){const c=t[0],v=t[1],H=s.competition_code||"PL";L(`/match/${H}/${c}/${v}`,{state:{from:"predictions"}})}},u=async t=>{try{const c=await $.post(`/api/community/${s.id}/rate`,{rating:t});c.data.success&&i(s.id,c.data.avg_rating,c.data.rating_count)}catch{}},l=()=>{d(!1),y(!1),j&&j(s.id),!N&&!M.isFollowing&&M.loaded&&setTimeout(()=>C(!0),500)},f=s.is_paid&&!s.unlocked;return e.jsxs("div",{ref:R,className:`community-card ${s.is_paid?"paid-card":""}`,children:[e.jsxs("div",{className:"community-card-top",children:[s.rank&&e.jsx("div",{className:"prediction-rank-number",children:e.jsx("span",{children:s.rank})}),e.jsxs("div",{className:"community-card-left",children:[e.jsxs("div",{className:"predictor-info",onClick:t=>{t.stopPropagation(),o(!0)},style:{cursor:"pointer"},children:[e.jsx("span",{className:"predictor-avatar",style:{background:s.avatar_color},children:(s.display_name||s.username||"?")[0].toUpperCase()}),e.jsxs("div",{children:[e.jsxs("div",{className:"predictor-name-row",children:[e.jsx("strong",{className:"predictor-name",children:s.display_name}),s.predictor_accuracy!=null&&e.jsxs("span",{className:`predictor-accuracy-badge ${s.predictor_accuracy>=60?"good":s.predictor_accuracy>=40?"average":"low"}`,children:[s.predictor_accuracy,"%"]}),(s.predictor_wins>0||s.predictor_losses>0)&&e.jsxs("span",{className:"predictor-record",children:[e.jsxs("span",{className:"record-wins",children:[s.predictor_wins,"W"]}),e.jsx("span",{className:"record-sep",children:"-"}),e.jsxs("span",{className:"record-losses",children:[s.predictor_losses,"L"]})]})]}),e.jsx("div",{className:"predictor-follow-row",children:e.jsxs("span",{className:"predictor-username",children:["@",s.username]})})]})]}),P?e.jsxs("div",{className:"community-match",children:[e.jsxs("span",{className:"community-teams slip-label",children:[s.slip_picks.length," Picks - Combined Slip"]}),e.jsxs("div",{className:"community-match-meta",children:[s.combined_odds&&e.jsxs("span",{className:"slip-combined-odds",children:["Total Odds: ",s.combined_odds.toFixed(2)]}),e.jsxs("button",{className:"slip-toggle-btn",onClick:t=>{t.stopPropagation(),S(!T)},children:[T?"Hide Picks":"Show Picks"," ",T?"â–²":"â–¼"]})]})]}):e.jsxs("div",{className:"community-match",children:[e.jsxs("span",{className:"community-teams",children:[s.team_a_name," vs ",s.team_b_name]}),e.jsxs("div",{className:"community-match-meta",children:[s.competition&&e.jsx("span",{className:"community-comp",children:s.competition}),(()=>{const t=(s.fixture_id||"").split("-");if(t.length>=3){const c=t[t.length-1];if(c.length===8){const v=new Date(c.slice(0,4)+"-"+c.slice(4,6)+"-"+c.slice(6,8));if(!isNaN(v))return e.jsx("span",{className:"community-match-date",children:v.toLocaleDateString("en-GB",{weekday:"short",day:"numeric",month:"short"})})}}return null})(),e.jsxs("button",{className:"analyze-btn-sm",onClick:t=>{t.stopPropagation(),b()},children:[e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M2 20h20"}),e.jsx("path",{d:"M5 17V7l5 4 4-8 6 7"})]}),n("community.analyze")||"Analyze"]})]})]})]}),e.jsx("div",{className:"community-card-center",children:f?e.jsxs("div",{className:"locked-prediction-inline",children:[e.jsx("span",{className:"locked-icon-sm",children:"ðŸ”’"}),e.jsx("span",{className:"locked-text-sm",children:n("community.premium")}),!N&&!_&&e.jsxs("button",{className:"unlock-btn-sm",onClick:()=>h(!0),children:[n("community.unlock")," $",s.price_usd]}),!N&&_&&e.jsxs("div",{className:"pay-choice-row",children:[e.jsx("button",{className:"pay-choice-btn mpesa",onClick:()=>{h(!1),d(!0)},children:"M-Pesa"}),!x&&e.jsx("button",{className:"pay-choice-btn card",onClick:()=>{h(!1),y(!0)},children:n("upgrade.cardPayment")})]})]}):P?e.jsxs("div",{className:"community-picks slip-picks-summary",children:[e.jsxs("div",{className:"pick-item main-pick",children:[e.jsx("span",{className:"pick-label",children:n("community.prediction")}),e.jsxs("span",{className:"pick-value",children:[s.slip_picks.length," selections"]}),s.combined_odds&&e.jsx("span",{className:"pick-prob slip-odds-badge",children:s.combined_odds.toFixed(2)})]}),T&&e.jsx("div",{className:"slip-picks-dropdown",children:s.slip_picks.map((t,c)=>e.jsxs("div",{className:"slip-pick-item",children:[e.jsxs("div",{className:"slip-pick-match",children:[t.team_a_name," vs ",t.team_b_name]}),e.jsxs("div",{className:"slip-pick-details",children:[e.jsx("span",{className:"slip-pick-result",children:t.predicted_result}),t.odds&&e.jsx("span",{className:"slip-pick-odds",children:t.odds.toFixed(2)}),t.predicted_result_prob>0&&e.jsxs("span",{className:"slip-pick-prob",children:[Math.round(t.predicted_result_prob),"%"]})]})]},t.id||c))})]}):e.jsxs("div",{className:"community-picks",children:[e.jsxs("div",{className:"pick-item main-pick",children:[e.jsx("span",{className:"pick-label",children:n("community.prediction")}),e.jsx("span",{className:"pick-value",children:s.predicted_result}),s.predicted_result_prob>0&&e.jsxs("span",{className:"pick-prob",children:[Math.round(s.predicted_result_prob),"%"]})]}),s.odds&&e.jsxs("div",{className:"pick-item",children:[e.jsx("span",{className:"pick-label",children:"Odds"}),e.jsx("span",{className:"pick-value pick-odds-value",children:s.odds.toFixed(2)})]}),s.predicted_over25&&e.jsxs("div",{className:"pick-item",children:[e.jsx("span",{className:"pick-label",children:n("community.overUnder")}),e.jsx("span",{className:"pick-value",children:s.predicted_over25})]}),s.predicted_btts&&e.jsxs("div",{className:"pick-item",children:[e.jsx("span",{className:"pick-label",children:n("community.btts")}),e.jsx("span",{className:"pick-value",children:s.predicted_btts})]}),s.best_value_bet&&e.jsxs("div",{className:"pick-item value-pick",children:[e.jsx("span",{className:"pick-label",children:n("community.bestValue")}),e.jsx("span",{className:"pick-value",children:s.best_value_bet})]})]})}),e.jsxs("div",{className:"community-card-right",children:[e.jsx("span",{className:"community-time",children:new Date(s.created_at).toLocaleDateString()}),s.is_paid&&e.jsx("span",{className:`paid-badge ${s.unlocked?"unlocked":""}`,children:s.unlocked?n("community.unlocked"):`$${s.price_usd}`}),s.match_finished&&e.jsxs("div",{className:`community-result ${s.result_correct?"correct":"incorrect"}`,children:[s.result_correct?"âœ… ":"âŒ ",s.result_correct?n("community.correct"):n("community.incorrect")]}),e.jsxs("div",{className:"rating-section",children:[e.jsx(ce,{rating:Math.round(s.avg_rating),interactive:!N&&!f,onRate:u}),e.jsxs("span",{className:"rating-text",children:[s.avg_rating>0?`${s.avg_rating}`:"0"," (",s.rating_count,")"]})]})]})]}),!f&&s.analysis_summary&&e.jsx("p",{className:"community-summary",children:s.analysis_summary}),!N&&e.jsxs("div",{className:"community-card-follow-bar",children:[e.jsx("button",{className:`follow-bar-btn ${M.isFollowing?"following":""}`,onClick:w,children:M.isFollowing?e.jsxs(e.Fragment,{children:[e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"currentColor",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M20 6L9 17l-5-5"})})," ",n("community.followingBtn")]}):e.jsxs(e.Fragment,{children:[e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]})," ",n("community.follow")," ",s.display_name?.split(" ")[0]]})}),M.followersCount>0&&e.jsxs("span",{className:"follow-bar-count",children:[M.followersCount," ",M.followersCount!==1?n("community.followers"):n("community.follower")]})]}),e.jsxs("div",{className:"community-card-footer",children:[e.jsx(me,{predictionId:s.id,initialLikes:s.likes||0,initialDislikes:s.dislikes||0,onLiked:()=>{!N&&r&&!M.isFollowing&&M.loaded&&C(!0)}}),!f&&e.jsx(re,{predictionId:s.id})]}),g&&e.jsx(ae,{isOpen:g,onClose:()=>d(!1),onSuccess:l,amountUsd:s.price_usd,transactionType:"prediction_purchase",referenceId:String(s.id),title:n("community.unlockPrediction"),description:`${s.team_a_name} vs ${s.team_b_name}`}),k&&e.jsx(ie,{isOpen:k,onClose:()=>y(!1),onSuccess:l,transactionType:"prediction_purchase",predictionId:s.id,amountUsd:s.price_usd,title:`${n("community.unlock")}: ${s.team_a_name} vs ${s.team_b_name}`}),F&&e.jsx(de,{userId:s.user_id,displayName:s.display_name,avatarColor:s.avatar_color,onClose:()=>C(!1),onFollowed:()=>m(t=>({...t,isFollowing:!0,followersCount:t.followersCount+1}))}),E&&e.jsx(ue,{userId:s.user_id,displayName:s.display_name,avatarColor:s.avatar_color,onClose:()=>o(!1)})]})}function he(s){return new Date(s).toLocaleDateString("en-GB",{weekday:"short",month:"short",day:"numeric"})}function pe(s){return new Date(s).toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"})}function xe(s){const i={};return s.forEach(j=>{const r=j.date.split("T")[0];i[r]||(i[r]=[]),i[r].push(j)}),i}function je(){const{user:s}=K(),{t:i}=O(),j=ee(),[r,n]=a.useState("ALL"),[x,L]=a.useState([]),[N,g]=a.useState(!0),[d,k]=a.useState(""),[y,_]=a.useState(""),[h,F]=a.useState(1),C=15,E=10,o=s?.tier==="pro";a.useEffect(()=>{(async()=>{g(!0),k("");try{const l=r==="ALL"?"/api/fixtures/upcoming-all?days=7":`/api/fixtures?competition=${r}&days=14`,f=await $.get(l);L(f.data.fixtures||[]),f.data.message&&k(f.data.message)}catch{L([])}g(!1)})(),F(1),_("")},[r]);const T=x.filter(u=>{if(!y.trim())return!0;const l=y.toLowerCase();return(u.home_team?.name||"").toLowerCase().includes(l)||(u.away_team?.name||"").toLowerCase().includes(l)}),R=[...T].sort((u,l)=>new Date(u.date)-new Date(l.date)).slice(0,E*C),P=Math.max(1,Math.ceil(R.length/C)),M=R.slice((h-1)*C,h*C),m=xe(M),w=Object.keys(m).sort(),b=u=>{F(u),window.scrollTo({top:0,behavior:"smooth"})};return e.jsxs("div",{className:"upcoming-matches-section",children:[e.jsxs("div",{className:"league-selector",children:[e.jsxs("button",{className:`league-chip ${r==="ALL"?"active":""}`,onClick:()=>{n("ALL"),F(1)},children:[e.jsx("span",{className:"league-chip-flag",children:"âš½"}),e.jsx("span",{className:"league-chip-name",children:"All"})]}),Y.map(u=>e.jsxs("button",{className:`league-chip ${r===u.id?"active":""}`,onClick:()=>{n(u.id),F(1)},children:[e.jsx("span",{className:"league-chip-flag",children:u.flag}),e.jsx("span",{className:"league-chip-name",children:u.shortName})]},u.id))]}),e.jsxs("div",{className:"upcoming-search-bar",children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"11",cy:"11",r:"8"}),e.jsx("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]}),e.jsx("input",{type:"text",placeholder:i("community.searchTeamName"),value:y,onChange:u=>{_(u.target.value),F(1)},className:"upcoming-search-input"}),y&&e.jsx("button",{className:"upcoming-search-clear",onClick:()=>{_(""),F(1)},children:"Ã—"})]}),d&&e.jsx("p",{className:"upcoming-notice",children:d}),N?e.jsxs("div",{className:"loading-container",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:i("community.loadingFixtures")})]}):T.length===0?e.jsx("div",{className:"empty-community",children:y?e.jsx("p",{children:i("community.noMatchesFor",{query:y})}):e.jsxs(e.Fragment,{children:[e.jsx("p",{children:r==="ALL"?"No upcoming matches found":i("community.noUpcomingMatches",{league:Y.find(u=>u.id===r)?.name||r})}),e.jsx("p",{className:"empty-hint",children:i("community.tryAnotherLeague")})]})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"upcoming-match-count",children:i("community.showingMatches",{start:(h-1)*C+1,end:Math.min(h*C,R.length),total:R.length})}),e.jsx("div",{className:"upcoming-fixtures-list",children:w.map(u=>e.jsxs("div",{className:"upcoming-date-group",children:[e.jsxs("div",{className:"upcoming-date-header",children:[e.jsx("span",{children:he(u+"T00:00:00")}),e.jsxs("span",{className:"upcoming-date-count",children:[m[u].length," ",m[u].length!==1?i("community.matches"):i("community.match")]})]}),e.jsx("div",{className:"upcoming-fixtures-grid",children:m[u].map(l=>{const f=l.status&&l.status!=="NS"&&l.status!=="TBD";return e.jsxs("div",{className:`upcoming-fixture-card ${f?"match-started":""} ${!o&&!f?"pro-gated":""}`,onClick:()=>{if(f)return;if(!o){j("/upgrade",{state:{from:"upcoming"}});return}const t=l.competition?.code||r;j(`/match/${t}/${l.home_team.id}/${l.away_team.id}`,{state:{fixture:l,from:"upcoming"}})},children:[e.jsxs("div",{className:"upcoming-fixture-time",children:[f?e.jsx("span",{className:"match-started-badge",children:i("community.started")}):pe(l.date),r==="ALL"&&l.competition?.name&&e.jsx("span",{className:"upcoming-fixture-league",children:l.competition.name})]}),e.jsxs("div",{className:"upcoming-fixture-teams",children:[e.jsxs("div",{className:"upcoming-team home",children:[l.home_team.crest&&e.jsx("img",{src:l.home_team.crest,alt:"",className:"upcoming-team-crest"}),e.jsx("span",{children:l.home_team.name})]}),e.jsx("span",{className:"upcoming-vs",children:"vs"}),e.jsxs("div",{className:"upcoming-team away",children:[e.jsx("span",{children:l.away_team.name}),l.away_team.crest&&e.jsx("img",{src:l.away_team.crest,alt:"",className:"upcoming-team-crest"})]})]}),e.jsx("div",{className:`upcoming-analyze-btn ${!o&&!f?"pro-only":""}`,children:i(f?"community.started":o?"community.analyze":"community.proOnly")})]},l.id)})})]},u))}),P>1&&(()=>{let l=Math.max(1,h-Math.floor(2.5)),f=Math.min(P,l+5-1);f-l<4&&(l=Math.max(1,f-5+1));const t=[];for(let c=l;c<=f;c++)t.push(c);return e.jsxs("div",{className:"upcoming-pagination",children:[e.jsx("button",{className:"upcoming-page-btn",disabled:h<=1,onClick:()=>b(h-1),children:i("community.prev")}),l>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"upcoming-page-btn",onClick:()=>b(1),children:"1"}),l>2&&e.jsx("span",{className:"pagination-dots",children:"..."})]}),t.map(c=>e.jsx("button",{className:`upcoming-page-btn ${c===h?"active":""}`,onClick:()=>b(c),children:c},c)),f<P&&e.jsxs(e.Fragment,{children:[f<P-1&&e.jsx("span",{className:"pagination-dots",children:"..."}),e.jsx("button",{className:"upcoming-page-btn",onClick:()=>b(P),children:P})]}),e.jsx("button",{className:"upcoming-page-btn",disabled:h>=P,onClick:()=>b(h+1),children:i("community.next")})]})})()]})]})}const G=[{value:"match_winner",labelKey:"community.matchWinner",optionKeys:["community.homeWin","community.draw","community.awayWin"]},{value:"next_goal",labelKey:"community.nextGoal",optionKeys:["community.homeTeam","community.awayTeam","community.noMoreGoals"]},{value:"total_goals",labelKey:"community.totalGoals",options:["Over 0.5","Over 1.5","Over 2.5","Over 3.5","Under 1.5","Under 2.5","Under 3.5"]},{value:"btts",labelKey:"community.bothTeamsScore",optionKeys:["common.yes","common.no"]}];function ge(){const{user:s}=K(),{t:i}=O(),[j,r]=a.useState([]),[n,x]=a.useState([]),[L,N]=a.useState(!0),[g,d]=a.useState(null),[k,y]=a.useState("match_winner"),[_,h]=a.useState(""),[F,C]=a.useState(50),[E,o]=a.useState(!1),[T,S]=a.useState(""),[R,P]=a.useState(""),[M,m]=a.useState(""),[w,b]=a.useState(""),u=a.useRef(null),l=a.useCallback(async()=>{try{const[t,c]=await Promise.all([$.get("/api/live-matches"),$.get("/api/community/live-predictions")]);r((t.data.matches||[]).filter(v=>["1H","2H","HT","ET","LIVE"].includes(v.status))),x(c.data.predictions||[])}catch{}N(!1)},[]);a.useEffect(()=>{l();const t=setInterval(l,3e4);return()=>clearInterval(t)},[l]);const f=async()=>{if(!(!g||!_||!s)){o(!0),m("");try{(await $.post("/api/community/live-bet",{predictions:[{fixture_id:g.id,match_name:`${g.home_team.name} vs ${g.away_team.name}`,prediction_type:G.find(c=>c.value===k)?.labelKey||k,prediction_value:_,confidence:F,analysis_notes:T,odds:R?parseFloat(R):null}],visibility:"public"})).data.success&&(m(i("community.livePredictionSubmitted")),d(null),h(""),C(50),S(""),P(""),l(),setTimeout(()=>m(""),3e3))}catch{m(i("community.failedSubmit"))}o(!1)}};return L?e.jsxs("div",{className:"loading-container",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:i("common.loading")})]}):e.jsxs("div",{className:"live-bets-section",children:[e.jsxs("div",{className:"live-bets-strip-header",children:[e.jsx("span",{className:"live-pulse-dot"}),e.jsx("span",{children:i("community.liveMatchesCount",{count:j.length})})]}),j.length>0&&e.jsxs("div",{className:"live-search-bar",children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"11",cy:"11",r:"8"}),e.jsx("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]}),e.jsx("input",{type:"text",placeholder:i("community.searchLiveMatches"),value:w,onChange:t=>b(t.target.value),className:"live-search-input"}),w&&e.jsx("button",{className:"live-search-clear",onClick:()=>b(""),children:"Ã—"})]}),j.length===0?e.jsxs("div",{className:"empty-community",children:[e.jsx("p",{children:i("community.noLiveMatches")}),e.jsx("p",{className:"empty-hint",children:i("community.liveMatchesHint")})]}):e.jsxs("div",{className:"live-bets-match-grid",children:[j.filter(t=>{if(!w.trim())return!0;const c=w.toLowerCase();return(t.home_team?.name||"").toLowerCase().includes(c)||(t.away_team?.name||"").toLowerCase().includes(c)||(t.competition?.name||"").toLowerCase().includes(c)}).map(t=>e.jsxs("div",{className:`live-bet-match-card ${g?.id===t.id?"selected":""}`,onClick:()=>{const c=g?.id===t.id?null:t;d(c)},children:[e.jsxs("div",{className:"live-bet-card-left",children:[e.jsxs("div",{className:"live-bet-match-status",children:[e.jsx("span",{className:"live-indicator-dot"}),e.jsxs("span",{children:[t.elapsed||t.status,"'"]})]}),e.jsx("div",{className:"live-bet-competition",children:t.competition?.name||""})]}),e.jsxs("div",{className:"live-bet-card-center",children:[e.jsxs("div",{className:"live-bet-team home",children:[t.home_team?.crest&&e.jsx("img",{src:t.home_team.crest,alt:"",className:"live-bet-crest"}),e.jsx("span",{children:t.home_team?.name})]}),e.jsxs("div",{className:"live-bet-score",children:[t.goals?.home??0," - ",t.goals?.away??0]}),e.jsxs("div",{className:"live-bet-team away",children:[t.away_team?.crest&&e.jsx("img",{src:t.away_team.crest,alt:"",className:"live-bet-crest"}),e.jsx("span",{children:t.away_team?.name})]})]}),e.jsx("div",{className:"live-bet-card-right",children:e.jsx("button",{className:"live-bet-predict-btn",children:g?.id===t.id?i("community.selected"):i("community.predict")})})]},t.id)),j.filter(t=>{if(!w.trim())return!0;const c=w.toLowerCase();return(t.home_team?.name||"").toLowerCase().includes(c)||(t.away_team?.name||"").toLowerCase().includes(c)||(t.competition?.name||"").toLowerCase().includes(c)}).length===0&&e.jsx("div",{className:"empty-community",children:e.jsx("p",{children:i("community.noMatchesFor",{query:w})})})]}),g&&s&&e.jsxs("div",{className:"live-bet-form",ref:u,children:[e.jsxs("div",{className:"live-bet-form-header",children:[e.jsx("span",{className:"live-pulse-dot"}),e.jsx("strong",{children:i("community.predictMatch",{match:`${g.home_team?.name} vs ${g.away_team?.name}`})}),e.jsxs("span",{className:"live-bet-minute",children:[g.elapsed||g.status,"'"]})]}),e.jsx("div",{className:"live-bet-type-selector",children:G.map(t=>e.jsx("button",{className:`live-bet-type-btn ${k===t.value?"active":""}`,onClick:()=>{y(t.value),h("")},children:i(t.labelKey)},t.value))}),e.jsx("div",{className:"live-bet-options",children:(()=>{const t=G.find(v=>v.value===k);return t?(t.optionKeys?t.optionKeys.map(v=>({display:i(v),value:i(v)})):(t.options||[]).map(v=>({display:v,value:v}))).map(v=>e.jsx("button",{className:`live-bet-option ${_===v.value?"selected":""}`,onClick:()=>h(v.value),children:v.display},v.value)):null})()}),e.jsxs("div",{className:"live-bet-confidence",children:[e.jsxs("label",{children:[i("community.confidence"),": ",e.jsxs("strong",{children:[F,"%"]})]}),e.jsx("input",{type:"range",min:"10",max:"95",value:F,onChange:t=>C(Number(t.target.value)),className:"confidence-slider"}),e.jsxs("div",{className:"confidence-labels",children:[e.jsx("span",{children:i("community.low")}),e.jsx("span",{children:i("community.medium")}),e.jsx("span",{children:i("community.high")})]})]}),e.jsxs("div",{className:"live-bet-odds-row",children:[e.jsx("label",{className:"live-bet-odds-label",children:"Odds:"}),e.jsx("input",{type:"number",className:"live-bet-odds-input",placeholder:"e.g. 1.50",value:R,onChange:t=>P(t.target.value),min:"1.01",step:"0.01"})]}),e.jsx("textarea",{className:"live-bet-notes",placeholder:i("community.quickAnalysis"),value:T,onChange:t=>S(t.target.value),maxLength:300,rows:2}),e.jsx("button",{className:"live-bet-submit-btn",disabled:!_||E,onClick:f,children:i(E?"community.submitting":"community.submitLivePrediction")}),M&&e.jsx("p",{className:"live-bet-msg",children:M})]}),g&&!s&&e.jsx("div",{className:"live-bet-form",ref:u,children:e.jsx("p",{style:{color:"#94a3b8",textAlign:"center",padding:"16px"},children:i("community.loginToPredict")})}),n.length>0&&e.jsxs("div",{className:"live-predictions-feed",children:[e.jsx("h3",{className:"live-predictions-title",children:i("community.recentLivePredictions")}),e.jsx("div",{className:"community-grid",children:n.map(t=>e.jsx(q,{pred:t,onRate:()=>{},onPurchase:()=>{}},t.id))})]})]})}function Ne(){const{t:s}=O(),{isKenyan:i}=Z(),[j,r]=te(),n=j.get("user_id"),[x,L]=a.useState(""),[N,g]=a.useState([]),[d,k]=a.useState(!0),[y,_]=a.useState(1),[h,F]=a.useState(1),[C,E]=a.useState(0),[o,T]=a.useState("free"),[S,R]=a.useState("best"),[P,M]=a.useState([]),[m,w]=a.useState(!0),b=a.useRef(o),u=a.useRef(y),l=a.useRef(n),f=a.useRef(S);b.current=o,u.current=y,l.current=n,f.current=S;const t=async(p=1,U=o,A=!1,B=n,I=S)=>{A||k(!0);try{let J=U==="paid"?`/api/community/paid?page=${p}&per_page=20&sort_by=${I}`:`/api/community/predictions?page=${p}&per_page=20&sort_by=${I}`;B&&U!=="paid"&&(J+=`&user_id=${B}`);const W=await $.get(J);g(W.data.predictions||[]),F(W.data.total_pages||1),E(W.data.total||0),_(p),B&&W.data.predictions?.length>0&&!x&&L(W.data.predictions[0].display_name||"")}catch{}A||k(!1)},c=async()=>{w(!0);try{const p=await $.get("/api/predictions/daily-free");M(p.data.predictions||[])}catch{}w(!1)};a.useEffect(()=>{$.get("/api/predictions/daily-free").then(p=>{M(p.data.predictions||[]),w(!1)}).catch(()=>w(!1))},[]),a.useEffect(()=>{o==="free"?c():o!=="upcoming"&&t(1,o,!1,n,S)},[o,n,S]),a.useEffect(()=>{const p=setInterval(()=>{b.current!=="upcoming"&&b.current!=="live"&&b.current!=="free"&&t(u.current,b.current,!0,l.current,f.current)},5e3);return()=>clearInterval(p)},[]);const v=()=>{r({}),L("")},H=(p,U,A)=>{g(B=>B.map(I=>I.id===p?{...I,avg_rating:U,rating_count:A}:I))},Q=()=>{t(y,o,!1,n,S)},V=p=>{T(p),_(1)},se=p=>{R(p),_(1)},D=()=>{const p=[];let A=Math.max(1,y-Math.floor(2.5)),B=Math.min(h,A+5-1);B-A<4&&(A=Math.max(1,B-5+1));for(let I=A;I<=B;I++)p.push(I);return p};return e.jsxs("div",{className:"community-page",children:[e.jsxs("div",{className:"community-header-section",children:[e.jsx("h2",{children:s("community.title")}),e.jsx("p",{className:"community-subtitle",children:s("community.subtitle")})]}),e.jsxs("div",{className:"disclaimer-banner",children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"}),e.jsx("line",{x1:"12",y1:"9",x2:"12",y2:"13"}),e.jsx("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})]}),e.jsx("span",{children:s("community.disclaimer")})]}),n&&e.jsxs("div",{className:"community-filter-banner",children:[e.jsxs("span",{children:[s("community.showingPredictionsBy")," ",e.jsx("strong",{children:x||`User #${n}`})]}),e.jsx("button",{onClick:v,children:s("community.showAll")})]}),e.jsxs("div",{className:"community-tabs",children:[e.jsxs("button",{className:`community-tab ${o==="free"?"active":""}`,onClick:()=>V("free"),children:["âš¡"," Daily Free Picks",P.length>0&&e.jsx("span",{className:"community-tab-badge",children:P.length})]}),e.jsx("button",{className:`community-tab ${o==="all"?"active":""}`,onClick:()=>V("all"),children:s("community.allPredictions")}),e.jsx("button",{className:`community-tab ${o==="paid"?"active":""}`,onClick:()=>V("paid"),children:s("community.premiumPicks")}),e.jsxs("button",{className:`community-tab live-tab ${o==="live"?"active":""}`,onClick:()=>V("live"),children:[e.jsx("span",{className:"live-tab-dot"}),s("community.liveBets")]}),e.jsx("button",{className:`community-tab ${o==="upcoming"?"active":""}`,onClick:()=>V("upcoming"),children:s("community.upcomingMatches")})]}),o==="free"&&e.jsxs("div",{className:"daily-free-section",children:[e.jsxs("div",{className:"daily-free-header",children:[e.jsxs("h3",{children:["âš¡"," Today's Free AI Picks"]}),e.jsxs("p",{className:"daily-free-subtitle",children:[new Date().toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"})," Â· Updated daily"]})]}),m?e.jsxs("div",{className:"loading-container",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading today's picks..."})]}):P.length===0?e.jsxs("div",{className:"empty-community",children:[e.jsxs("p",{children:["ðŸ”®"," Today's predictions are being generated..."]}),e.jsx("p",{className:"empty-hint",children:"Our AI analyzes top matches from the best leagues worldwide. Check back soon!"})]}):e.jsx("div",{className:"community-grid",children:P.map(p=>e.jsx(X.Fragment,{children:e.jsx(q,{pred:p,onRate:H,onPurchase:Q})},p.id))})]}),o==="upcoming"&&e.jsx(je,{}),o==="live"&&e.jsx(ge,{}),o!=="upcoming"&&o!=="live"&&o!=="free"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"sort-selector",children:[ne.map(p=>e.jsxs("button",{className:`sort-btn ${S===p.value?"active":""}`,onClick:()=>se(p.value),children:[e.jsx("span",{className:"sort-icon",children:p.icon}),e.jsx("span",{children:s(p.labelKey)})]},p.value)),C>0&&e.jsxs("span",{className:"sort-total",children:[C," ",s("community.predictionsCount")]})]}),d?e.jsxs("div",{className:"loading-container",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:s("community.loadingPredictions")})]}):N.length===0?e.jsxs("div",{className:"empty-community",children:[e.jsx("p",{children:s(o==="paid"?"community.noPremium":"community.noCommunity")}),e.jsx("p",{className:"empty-hint",children:s("community.shareHint")})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"community-grid",children:N.map((p,U)=>e.jsx(X.Fragment,{children:e.jsx(q,{pred:p,onRate:H,onPurchase:Q})},p.id))}),h>1&&e.jsxs("div",{className:"pagination-numbered",children:[e.jsx("button",{className:"pagination-btn",disabled:y<=1,onClick:()=>t(y-1,o,!1,n,S),children:s("community.prev")}),D()[0]>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"pagination-btn",onClick:()=>t(1,o,!1,n,S),children:"1"}),D()[0]>2&&e.jsx("span",{className:"pagination-dots",children:"..."})]}),D().map(p=>e.jsx("button",{className:`pagination-btn ${p===y?"active":""}`,onClick:()=>t(p,o,!1,n,S),children:p},p)),D()[D().length-1]<h&&e.jsxs(e.Fragment,{children:[D()[D().length-1]<h-1&&e.jsx("span",{className:"pagination-dots",children:"..."}),e.jsx("button",{className:"pagination-btn",onClick:()=>t(h,o,!1,n,S),children:h})]}),e.jsx("button",{className:"pagination-btn",disabled:y>=h,onClick:()=>t(y+1,o,!1,n,S),children:s("community.next")})]})]})]})]})}export{Ne as default};
