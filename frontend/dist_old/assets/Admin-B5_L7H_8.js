import{r as s,j as e,c as T}from"./index-B3SC9TNl.js";import Os from"./DocsPage-BN8zGVP2.js";const Ss=s.createContext(null),Fe="/api",Ws=1800*1e3,Hs=60*1e3;function Ks({children:a}){const[t,j]=s.useState(!1),[p,E]=s.useState(!0),[h,f]=s.useState(null),[o,v]=s.useState(null),[_,C]=s.useState(null),[x,F]=s.useState(null),[q,y]=s.useState([]),[z,G]=s.useState(null),g=s.useRef(null),H=s.useRef(null),I=s.useCallback(()=>{if(h==="password"&&o)return{"x-admin-password":o};const c=localStorage.getItem("spark_token");return c?{Authorization:`Bearer ${c}`}:{}},[h,o]),N=s.useCallback(async c=>{try{const n=await fetch(`${Fe}/admin/my-permissions`,{headers:c});if(n.ok){const D=await n.json();return F(D.role),y(D.modules||[]),D}}catch(n){console.error("Failed to fetch permissions:",n)}return null},[]),P=s.useCallback((c,n="read")=>{if(h==="password")return!0;const D=q.find(k=>k.module===c);return D?!!D[`can_${n}`]:!1},[h,q]),K=s.useCallback(c=>h==="password"?"company":q.find(D=>D.module===c)?.data_scope||"own",[h,q]),U=s.useCallback(async c=>{try{const n=await fetch(`${Fe}/admin/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:c})}),D=await n.json();return n.ok&&D.success?(v(c),f("password"),C("super_admin"),F({name:"owner",display_name:"Owner",level:0,department:null}),sessionStorage.setItem("admin_pw",c),j(!0),await N({"x-admin-password":c}),{success:!0}):{success:!1,error:D.detail||"Invalid password"}}catch{return{success:!1,error:"Connection error"}}},[N]),u=s.useCallback(async()=>{const c=localStorage.getItem("spark_token");if(!c)return!1;try{const n=await fetch(`${Fe}/user/staff-role`,{headers:{Authorization:`Bearer ${c}`}});if(n.ok){const D=await n.json();if(D.staff_role){f("jwt"),C(D.staff_role),F(D.role_info),j(!0),await N({Authorization:`Bearer ${c}`});try{const k=await fetch(`${Fe}/user/me`,{headers:{Authorization:`Bearer ${c}`}});if(k.ok){const $=await k.json();G($.user||$)}}catch{}return fetch(`${Fe}/admin/login`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify({password:""})}).catch(()=>{}),!0}}}catch{}return!1},[N]),J=s.useCallback(async()=>{try{await fetch(`${Fe}/admin/logout`,{method:"POST",headers:I()})}catch{}j(!1),f(null),v(null),C(null),F(null),y([]),G(null),sessionStorage.removeItem("admin_pw"),clearTimeout(g.current),clearInterval(H.current)},[I]);s.useEffect(()=>{(async()=>{if(!await u()){const D=sessionStorage.getItem("admin_pw");D&&await U(D)}E(!1)})()},[u,U]),s.useEffect(()=>{if(!t)return;const c=()=>{clearTimeout(g.current),g.current=setTimeout(()=>{J()},Ws)},n=["mousemove","keypress","click","scroll"];return n.forEach(D=>window.addEventListener(D,c)),c(),()=>{clearTimeout(g.current),n.forEach(D=>window.removeEventListener(D,c))}},[t,J]),s.useEffect(()=>{if(!(!t||h!=="jwt"))return H.current=setInterval(()=>{fetch(`${Fe}/admin/staff/heartbeat`,{method:"POST",headers:I()}).catch(()=>{})},Hs),()=>clearInterval(H.current)},[t,h,I]);const b={isLoggedIn:t,loading:p,authMode:h,staffRole:_,roleInfo:x,permissions:q,currentUser:z,getAuthHeaders:I,hasPermission:P,getDataScope:K,loginWithPassword:U,loginWithJWT:u,logout:J};return e.jsx(Ss.Provider,{value:b,children:a})}function fe(){const a=s.useContext(Ss);if(!a)throw new Error("useAdmin must be used within AdminProvider");return a}function Vs(){const{loginWithPassword:a}=fe(),[t,j]=s.useState(""),[p,E]=s.useState(""),[h,f]=s.useState(!1),o=async v=>{v.preventDefault(),E(""),f(!0);const _=await a(t);_.success||E(_.error),f(!1)};return e.jsx("div",{className:"admin-login-page",children:e.jsxs("div",{className:"admin-login-card",children:[e.jsxs("div",{className:"admin-login-logo",children:[e.jsx("span",{className:"admin-login-icon",children:"ðŸ›¡ï¸"}),e.jsx("h1",{children:"Spark AI Admin"}),e.jsx("p",{children:"Enter your credentials to access the admin portal"})]}),e.jsxs("form",{onSubmit:o,children:[e.jsxs("div",{className:"admin-login-field",children:[e.jsx("label",{children:"Admin Password"}),e.jsx("input",{type:"password",value:t,onChange:v=>j(v.target.value),placeholder:"Enter admin password",autoFocus:!0})]}),p&&e.jsx("div",{className:"admin-login-error",children:p}),e.jsx("button",{type:"submit",className:"admin-login-btn",disabled:h||!t,children:h?"Authenticating...":"Sign In"})]}),e.jsx("div",{className:"admin-login-footer",children:e.jsx("p",{children:"Staff members are automatically authenticated via their account."})})]})})}const Gs={owner:"#e74c3c",general_manager:"#3498db",sales_hod:"#2ecc71",customer_care_hod:"#e67e22",marketing_hod:"#9b59b6",predictions_hod:"#1abc9c",sales_agent:"#27ae60",customer_support_agent:"#f39c12",prediction_analyst:"#16a085"},Ys=[{id:"overview",icon:"ðŸ“Š",label:"Overview",module:"dashboard"},{id:"online",icon:"ðŸŸ¢",label:"Online Users",module:"online_users"},{id:"users",icon:"ðŸ‘¥",label:"Users",module:"users"},{id:"subscriptions",icon:"ðŸ’Ž",label:"Subscriptions",module:"subscriptions"},{id:"withdrawals",icon:"ðŸ’¸",label:"Withdrawals",module:"withdrawals"},{id:"community",icon:"ðŸ’¬",label:"Community",module:"community"},{id:"referrals",icon:"ðŸ”—",label:"Referrals",module:"referrals"},{id:"codes",icon:"ðŸ”‘",label:"Access Codes",module:"access_codes"},{id:"support",icon:"ðŸŽ§",label:"Support",module:"support"},{id:"broadcast",icon:"ðŸ“¢",label:"Broadcast",module:"community"},{id:"staff",icon:"ðŸ¢",label:"Employees",module:"employees"},{id:"activity",icon:"ðŸ“‹",label:"Activity Logs",module:"activity_logs"},{id:"security",icon:"ðŸ”’",label:"Security",module:"security"},{id:"predictions",icon:"âš½",label:"Predictions",module:"predictions"},{id:"sales",icon:"ðŸ’°",label:"Sales & Revenue",module:"sales"},{id:"settings",icon:"âš™ï¸",label:"Settings",module:"settings"},{id:"pricing",icon:"ðŸ’²",label:"Pricing",module:"settings"},{id:"bots",icon:"ðŸ¤–",label:"Bot Accounts",module:"bots"},{id:"analytics",icon:"ðŸ“ˆ",label:"Creator Analytics",module:"community"},{id:"docs",icon:"ðŸ“š",label:"Documentation",module:"dashboard"},{id:"extension",icon:"ðŸ§©",label:"Chrome Extension",module:"dashboard"}];function Js({activeTab:a,setActiveTab:t}){const{roleInfo:j,hasPermission:p,logout:E,currentUser:h}=fe(),f=Ys.filter(C=>p(C.module,"read")),o=j?.display_name||"Admin",v=Gs[j?.name]||"#6c5ce7",_=h?.display_name||"Admin";return e.jsxs("div",{className:"admin-sidebar",children:[e.jsxs("div",{className:"admin-sidebar-header",children:[e.jsx("h2",{children:"Spark AI"}),e.jsx("div",{className:"admin-sidebar-role",style:{background:v},children:o}),e.jsx("div",{className:"admin-sidebar-user",children:_})]}),e.jsx("nav",{className:"admin-sidebar-nav",children:f.map(C=>e.jsxs("button",{className:`admin-sidebar-tab ${a===C.id?"active":""}`,onClick:()=>t(C.id),children:[e.jsx("span",{className:"admin-tab-icon",children:C.icon}),e.jsx("span",{className:"admin-tab-label",children:C.label})]},C.id))}),e.jsx("div",{className:"admin-sidebar-footer",children:e.jsx("button",{className:"admin-logout-btn",onClick:E,children:"ðŸšª Logout"})})]})}function Q({label:a,value:t,sub:j,color:p,icon:E}){return e.jsxs("div",{className:"admin-stat-card",style:p?{borderLeftColor:p}:void 0,children:[E&&e.jsx("div",{className:"admin-stat-icon",children:E}),e.jsxs("div",{className:"admin-stat-content",children:[e.jsx("div",{className:"admin-stat-value",children:t??"â€”"}),e.jsx("div",{className:"admin-stat-label",children:a}),j&&e.jsx("div",{className:"admin-stat-sub",children:j})]})]})}function Qs(a,t=5){if(a<=0)return[0];const j=a/(t-1),p=Math.pow(10,Math.floor(Math.log10(j))),E=j/p;let h;E<=1.5?h=1*p:E<=3?h=2*p:E<=7?h=5*p:h=10*p;const f=[];for(let o=0;o<=a+h*.01&&(f.push(Math.round(o*100)/100),!(f.length>=t));o+=h);return f}const Zs=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],Xs=["January","February","March","April","May","June","July","August","September","October","November","December"];function Ue(a){const t=a.split("-"),j=parseInt(t[1],10)-1,p=parseInt(t[2],10);return`${Zs[j]} ${p}`}function Ve(a){const t=a.getFullYear(),j=String(a.getMonth()+1).padStart(2,"0"),p=String(a.getDate()).padStart(2,"0");return`${t}-${j}-${p}`}function bs(a,t){return new Date(a,t+1,0).getDate()}function ea({labels:a,data:t,color:j,prefix:p="",height:E=180}){const h=s.useRef(null);if(!t||t.length===0)return null;const f=700,o={top:24,right:20,bottom:36,left:65},v=f-o.left-o.right,_=E-o.top-o.bottom,C=Math.max(...t,1),x=Qs(C,5),F=x[x.length-1]||C,q=t.map((N,P)=>({x:o.left+P/Math.max(t.length-1,1)*v,y:o.top+_-N/F*_,val:N})),y=q.map((N,P)=>`${P===0?"M":"L"}${N.x},${N.y}`).join(" "),z=y+` L${q[q.length-1].x},${o.top+_} L${q[0].x},${o.top+_} Z`,G=x.map(N=>({val:N,y:o.top+_-N/F*_})),g=N=>N>=1e4?`${p}${(N/1e3).toFixed(0)}k`:N>=1e3?`${p}${(N/1e3).toFixed(1)}k`:`${p}${Math.round(N).toLocaleString()}`,H=Math.min(6,a.length),I=[];for(let N=0;N<H;N++){const P=Math.round(N/Math.max(H-1,1)*(a.length-1));I.push({label:Ue(a[P]),x:o.left+P/Math.max(a.length-1,1)*v})}return e.jsxs("svg",{viewBox:`0 0 ${f} ${E}`,style:{width:"100%",height:"auto"},ref:h,children:[G.map((N,P)=>e.jsxs("g",{children:[e.jsx("line",{x1:o.left,y1:N.y,x2:o.left+v,y2:N.y,stroke:"#1e293b",strokeWidth:"1"}),e.jsx("text",{x:o.left-10,y:N.y+4,textAnchor:"end",fill:"#64748b",fontSize:"11",fontFamily:"monospace",children:g(N.val)})]},P)),e.jsx("path",{d:z,fill:j,opacity:"0.08"}),e.jsx("path",{d:y,fill:"none",stroke:j,strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round"}),q.map((N,P)=>N.val>0&&e.jsx("circle",{cx:N.x,cy:N.y,r:"3.5",fill:j,stroke:"#0f172a",strokeWidth:"2"},P)),I.map((N,P)=>e.jsx("text",{x:N.x,y:o.top+_+22,textAnchor:"middle",fill:"#64748b",fontSize:"11",fontFamily:"sans-serif",children:N.label},P))]})}function sa({value:a,onChange:t,onClose:j}){const[p,E]=s.useState(()=>parseInt(a.start.split("-")[0])),[h,f]=s.useState(()=>parseInt(a.start.split("-")[1])-1),[o,v]=s.useState(null),[_,C]=s.useState(a.start),[x,F]=s.useState(a.end),q=s.useRef(null);s.useEffect(()=>{const b=c=>{q.current&&!q.current.contains(c.target)&&j()};return document.addEventListener("mousedown",b),()=>document.removeEventListener("mousedown",b)},[j]);const y=bs(p,h),z=new Date(p,h,1).getDay(),G=[];for(let b=0;b<z;b++)G.push(null);for(let b=1;b<=y;b++)G.push(b);const g=b=>{const c=`${p}-${String(h+1).padStart(2,"0")}-${String(b).padStart(2,"0")}`;!o||o==="start"?(C(c),F(c),v("end")):(c<_?(C(c),F(_)):F(c),v(null))},H=b=>{if(!b)return!1;const c=`${p}-${String(h+1).padStart(2,"0")}-${String(b).padStart(2,"0")}`;return c>=_&&c<=x},I=b=>b?`${p}-${String(h+1).padStart(2,"0")}-${String(b).padStart(2,"0")}`===_:!1,N=b=>b?`${p}-${String(h+1).padStart(2,"0")}-${String(b).padStart(2,"0")}`===x:!1,P=()=>{h===0?(f(11),E(b=>b-1)):f(b=>b-1)},K=()=>{h===11?(f(0),E(b=>b+1)):f(b=>b+1)},U=()=>{t({start:_,end:x}),j()},u=new Date,J=b=>{let c,n;const D=Ve(u);if(b==="today")c=n=D;else if(b==="7d")c=Ve(new Date(u.getTime()-6*864e5)),n=D;else if(b==="30d")c=Ve(new Date(u.getTime()-29*864e5)),n=D;else if(b==="this_month")c=`${u.getFullYear()}-${String(u.getMonth()+1).padStart(2,"0")}-01`,n=D;else if(b==="last_month"){const k=u.getMonth()===0?11:u.getMonth()-1,$=u.getMonth()===0?u.getFullYear()-1:u.getFullYear();c=`${$}-${String(k+1).padStart(2,"0")}-01`,n=`${$}-${String(k+1).padStart(2,"0")}-${String(bs($,k)).padStart(2,"0")}`}C(c),F(n),v(null),E(parseInt(c.split("-")[0])),f(parseInt(c.split("-")[1])-1)};return e.jsxs("div",{className:"cal-picker",ref:q,children:[e.jsxs("div",{className:"cal-quick-btns",children:[e.jsx("button",{onClick:()=>J("today"),children:"Today"}),e.jsx("button",{onClick:()=>J("7d"),children:"Last 7 Days"}),e.jsx("button",{onClick:()=>J("30d"),children:"Last 30 Days"}),e.jsx("button",{onClick:()=>J("this_month"),children:"This Month"}),e.jsx("button",{onClick:()=>J("last_month"),children:"Last Month"})]}),e.jsxs("div",{className:"cal-nav",children:[e.jsx("button",{onClick:P,children:"â€¹"}),e.jsxs("span",{className:"cal-nav-title",children:[Xs[h]," ",p]}),e.jsx("button",{onClick:K,children:"â€º"})]}),e.jsxs("div",{className:"cal-grid",children:[["Su","Mo","Tu","We","Th","Fr","Sa"].map(b=>e.jsx("div",{className:"cal-day-header",children:b},b)),G.map((b,c)=>e.jsx("div",{className:`cal-day ${b?"active":""} ${H(b)?"in-range":""} ${I(b)?"range-start":""} ${N(b)?"range-end":""}`,onClick:()=>b&&g(b),children:b||""},c))]}),e.jsxs("div",{className:"cal-footer",children:[e.jsxs("div",{className:"cal-range-display",children:[e.jsx("span",{children:Ue(_)}),e.jsx("span",{className:"cal-range-arrow",children:"â†’"}),e.jsx("span",{children:Ue(x)})]}),e.jsx("button",{className:"cal-apply-btn",onClick:U,children:"Apply"})]})]})}function aa(){const{getAuthHeaders:a}=fe(),[t,j]=s.useState(null),[p,E]=s.useState(!0),[h,f]=s.useState(null),[o,v]=s.useState("kes"),[_,C]=s.useState(!1),[x,F]=s.useState(()=>{const b=new Date;return{start:Ve(new Date(b.getTime()-29*864e5)),end:Ve(b)}}),q=s.useCallback(async()=>{E(!0);try{const b=await T.get("/api/admin/dashboard-stats",{headers:a()});j(b.data)}catch{}E(!1)},[a]),y=s.useCallback(async(b,c)=>{try{const n={currency:b};c&&(n.start_date=c.start,n.end_date=c.end);const D=await T.get("/api/admin/transaction-analytics",{headers:a(),params:n});f(D.data)}catch{}},[a]),[z,G]=s.useState(0);if(s.useEffect(()=>{const b=()=>{T.get("/api/active-users-count").then(n=>{G(n.data.active_users||0)}).catch(()=>{})};b();const c=setInterval(b,3e3);return()=>clearInterval(c)},[]),s.useEffect(()=>{q()},[q]),s.useEffect(()=>{y(o,x)},[o,x,y]),s.useEffect(()=>{const b=setInterval(()=>y(o,x),6e4);return()=>clearInterval(b)},[o,x,y]),p)return e.jsx("div",{className:"admin-loading",children:"Loading stats..."});if(!t)return null;const{users:g,community:H,predictions:I,subscriptions:N,balance_adjustments:P}=t,K=(b,c)=>c==="kes"?`KES ${Math.round(b).toLocaleString()}`:`$${b.toFixed(2)}`,U=b=>{v(b)},u=b=>{F(b)},J=h?.range?`${Ue(h.range.start)} â€” ${Ue(h.range.end)}`:"Last 30 Days";return e.jsxs("div",{className:"admin-tab-content",children:[e.jsxs("div",{className:"admin-overview-online",children:[e.jsx("span",{className:"online-dot-pulse"}),e.jsx("span",{className:"admin-overview-online-count",children:z.toLocaleString()}),e.jsx("span",{className:"admin-overview-online-label",children:"users online now"})]}),e.jsx("h3",{children:"Platform Overview"}),e.jsxs("div",{className:"admin-stats-grid",children:[e.jsx(Q,{label:"Total Users",value:g?.total_users||0,color:"#6c5ce7"}),e.jsx(Q,{label:"Active Users",value:g?.active_users||0,color:"#00b894"}),e.jsx(Q,{label:"Pro Users",value:g?.pro_users||0,color:"#fdcb6e"}),e.jsx(Q,{label:"Free Users",value:g?.free_users||0,color:"#74b9ff"}),e.jsx(Q,{label:"New Today",value:g?.new_today||0,color:"#55efc4"})]}),e.jsxs("div",{className:"tx-analytics-section",children:[e.jsxs("div",{className:"tx-analytics-header",children:[e.jsx("h3",{children:"Transaction Analytics"}),e.jsxs("div",{className:"tx-header-right",children:[e.jsxs("div",{className:"tx-date-picker-wrapper",children:[e.jsxs("button",{className:"tx-date-btn",onClick:()=>C(!_),children:[e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),e.jsx("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),e.jsx("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),e.jsx("line",{x1:"3",y1:"10",x2:"21",y2:"10"})]}),e.jsxs("span",{children:[Ue(x.start)," â€” ",Ue(x.end)]})]}),_&&e.jsx(sa,{value:x,onChange:u,onClose:()=>C(!1)})]}),e.jsx("span",{className:"tx-timezone-badge",children:"EAT (UTC+3)"})]})]}),e.jsxs("div",{className:"tx-tabs",children:[e.jsxs("button",{className:`tx-tab ${o==="kes"?"active kes":""}`,onClick:()=>U("kes"),children:[e.jsx("span",{className:"tx-tab-icon",children:"ðŸ“±"})," KES (M-Pesa)"]}),e.jsxs("button",{className:`tx-tab ${o==="usd"?"active usd":""}`,onClick:()=>U("usd"),children:[e.jsx("span",{className:"tx-tab-icon",children:"ðŸ’³"})," USD (Card)"]})]}),h?e.jsxs("div",{className:"tx-content",children:[e.jsxs("div",{className:"tx-summary-grid",children:[e.jsxs("div",{className:"tx-summary-card daily",children:[e.jsx("div",{className:"tx-summary-label",children:"Today"}),e.jsx("div",{className:"tx-summary-amount",children:K(h.daily.total,o)}),e.jsxs("div",{className:"tx-summary-count",children:[h.daily.count," transaction",h.daily.count!==1?"s":""]})]}),e.jsxs("div",{className:"tx-summary-card weekly",children:[e.jsx("div",{className:"tx-summary-label",children:"This Week"}),e.jsx("div",{className:"tx-summary-amount",children:K(h.weekly.total,o)}),e.jsxs("div",{className:"tx-summary-count",children:[h.weekly.count," transaction",h.weekly.count!==1?"s":""]})]}),e.jsxs("div",{className:"tx-summary-card monthly",children:[e.jsx("div",{className:"tx-summary-label",children:"This Month"}),e.jsx("div",{className:"tx-summary-amount",children:K(h.monthly.total,o)}),e.jsxs("div",{className:"tx-summary-count",children:[h.monthly.count," transaction",h.monthly.count!==1?"s":""]})]})]}),h.range&&e.jsxs("div",{className:"tx-range-total",children:[e.jsx("span",{className:"tx-range-label",children:"Selected Period Total"}),e.jsx("span",{className:"tx-range-amount",children:K(h.range.total,o)}),e.jsxs("span",{className:"tx-range-count",children:[h.range.count," transaction",h.range.count!==1?"s":""]})]}),e.jsxs("div",{className:"tx-chart-container",children:[e.jsx("div",{className:"tx-chart-header",children:e.jsxs("span",{className:"tx-chart-title",children:[o==="kes"?"M-Pesa Income":"Card Income"," â€” ",J]})}),e.jsx("div",{className:"tx-chart-body",children:e.jsx(ea,{labels:h.chart_labels,data:h.chart,color:o==="kes"?"#22c55e":"#3b82f6",prefix:o==="kes"?"":"$"})})]})]}):e.jsx("div",{className:"tx-loading",children:"Loading transaction data..."})]}),e.jsx("h3",{children:"Subscriptions & Revenue"}),e.jsxs("div",{className:"admin-stats-grid",children:[e.jsx(Q,{label:"Active Subs",value:N?.active||0,color:"#00b894"}),e.jsx(Q,{label:"Total Subs",value:N?.total_subscriptions||0,color:"#6c5ce7"}),e.jsx(Q,{label:"Cancelled",value:N?.cancelled||0,color:"#e17055"}),e.jsx(Q,{label:"Expired",value:N?.expired||0,color:"#636e72"}),e.jsx(Q,{label:"Revenue (USD)",value:`$${N?.revenue_usd||0}`,color:"#fdcb6e"}),e.jsx(Q,{label:"Revenue (KES)",value:`KES ${N?.revenue_kes||0}`,color:"#55efc4"})]}),P&&P.total_adjustments>0&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{children:"Balance Adjustments (by Super Admin)"}),e.jsxs("div",{className:"admin-stats-grid",children:[e.jsx(Q,{label:"Total Adjustments",value:P.total_adjustments,color:"#a78bfa"}),e.jsx(Q,{label:"Credited (USD)",value:`$${P.total_credited_usd}`,color:"#22c55e"}),e.jsx(Q,{label:"Debited (USD)",value:`$${P.total_debited_usd}`,color:"#ef4444"}),e.jsx(Q,{label:"Credited (KES)",value:`KES ${P.total_credited_kes}`,color:"#22c55e"}),e.jsx(Q,{label:"Debited (KES)",value:`KES ${P.total_debited_kes}`,color:"#ef4444"})]})]}),e.jsx("h3",{children:"Community Activity"}),e.jsxs("div",{className:"admin-stats-grid",children:[e.jsx(Q,{label:"Predictions Shared",value:H?.total_predictions||0,color:"#e17055"}),e.jsx(Q,{label:"Public",value:H?.public_predictions||0,color:"#00b894"}),e.jsx(Q,{label:"Private",value:H?.private_predictions||0,color:"#636e72"}),e.jsx(Q,{label:"Total Ratings",value:H?.total_ratings||0,color:"#fdcb6e"}),e.jsx(Q,{label:"Total Comments",value:H?.total_comments||0,color:"#74b9ff"}),e.jsx(Q,{label:"Unique Sharers",value:H?.unique_sharers||0,color:"#a29bfe"}),e.jsx(Q,{label:"Today's Predictions",value:H?.predictions_today||0,color:"#55efc4"})]}),e.jsx("h3",{children:"Prediction Accuracy"}),e.jsxs("div",{className:"admin-stats-grid",children:[e.jsx(Q,{label:"Total Predictions",value:I?.total_predictions||0,color:"#6c5ce7"}),e.jsx(Q,{label:"Completed",value:I?.matches_finished||0,color:"#00b894"}),e.jsx(Q,{label:"Result Accuracy",value:I?.result_accuracy?.percentage?`${I.result_accuracy.percentage}%`:"N/A",color:I?.result_accuracy?.percentage>=60?"#00b894":I?.result_accuracy?.percentage>=40?"#fdcb6e":"#e17055"}),e.jsx(Q,{label:"O/U 2.5 Accuracy",value:I?.over25_accuracy?.percentage?`${I.over25_accuracy.percentage}%`:"N/A",color:I?.over25_accuracy?.percentage>=60?"#00b894":"#fdcb6e"}),e.jsx(Q,{label:"BTTS Accuracy",value:I?.btts_accuracy?.percentage?`${I.btts_accuracy.percentage}%`:"N/A",color:I?.btts_accuracy?.percentage>=60?"#00b894":"#fdcb6e"})]})]})}function us({userProfile:a,onBack:t,onTierChange:j,onToggleActive:p,staffRole:E,getAuthHeaders:h,onRefresh:f}){const[o,v]=s.useState(""),[_,C]=s.useState("USD"),[x,F]=s.useState(""),[q,y]=s.useState("credit"),[z,G]=s.useState(!1),[g,H]=s.useState(""),[I,N]=s.useState(!1);if(!a)return null;const P=a.subscription,K=a.wallet,U=a.user_balance,u=a.tracking,J=a.balance_adjustments||[],b=a.transactions||[],c=a.withdrawals||[],n=b.length>0||c.length>0,D=E==="super_admin",k=async()=>{const $=parseFloat(o);if(!$||$<=0){H("Enter a valid amount");return}G(!0),H("");const ie=q==="debit"?-$:$;try{await T.post(`/api/admin/users/${a.id}/adjust-balance`,{amount_usd:_==="USD"?ie:0,amount_kes:_==="KES"?ie:0,reason:x||(q==="credit"?"Admin credit":"Admin debit"),adjustment_type:q==="credit"?"admin_credit":"admin_debit"},{headers:h()}),H("Balance updated successfully"),v(""),F(""),f&&f(a.id),setTimeout(()=>{H(""),N(!1)},1500)}catch(Z){H(Z.response?.data?.detail||"Failed to adjust balance")}G(!1)};return e.jsxs("div",{className:"user-detail-panel",children:[e.jsx("div",{className:"user-detail-header",children:e.jsxs("button",{className:"user-detail-back",onClick:t,children:[e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("polyline",{points:"15 18 9 12 15 6"})}),"Back"]})}),e.jsxs("div",{className:"user-detail-body",children:[e.jsxs("div",{className:"user-detail-top",children:[a.avatar_url?e.jsx("img",{src:a.avatar_url,alt:"",className:"user-detail-avatar-img"}):e.jsx("span",{className:"user-detail-avatar",style:{background:a.avatar_color},children:(a.display_name||"?")[0].toUpperCase()}),e.jsx("h3",{children:a.display_name}),a.full_name&&e.jsx("p",{className:"user-detail-realname",children:a.full_name}),e.jsxs("p",{className:"user-detail-username",children:["@",a.username]}),e.jsxs("div",{className:"user-detail-badges",children:[e.jsx("span",{className:`admin-support-tier-badge ${a.tier}`,children:a.tier?.toUpperCase()}),e.jsx("span",{className:`admin-support-status-badge ${a.is_active?"active":"suspended"}`,children:a.is_active?"Active":"Suspended"})]})]}),e.jsxs("div",{className:"user-detail-section",children:[e.jsx("h4",{children:"Personal Info"}),e.jsxs("div",{className:"user-detail-grid",children:[e.jsxs("div",{className:"user-detail-row",children:[e.jsx("span",{children:"Full Name"}),e.jsx("strong",{children:a.full_name||"Not set"})]}),e.jsxs("div",{className:"user-detail-row",children:[e.jsx("span",{children:"Email"}),e.jsx("strong",{children:a.email})]}),e.jsxs("div",{className:"user-detail-row",children:[e.jsx("span",{children:"Date of Birth"}),e.jsx("strong",{children:a.date_of_birth||"Not set"})]}),e.jsxs("div",{className:"user-detail-row",children:[e.jsx("span",{children:"Joined"}),e.jsx("strong",{children:a.created_at?new Date(a.created_at).toLocaleDateString():"N/A"})]}),e.jsxs("div",{className:"user-detail-row",children:[e.jsx("span",{children:"Logins"}),e.jsx("strong",{children:a.login_count||0})]}),e.jsxs("div",{className:"user-detail-row",children:[e.jsx("span",{children:"Last Login"}),e.jsx("strong",{children:a.last_login?new Date(a.last_login).toLocaleDateString():"Never"})]}),e.jsxs("div",{className:"user-detail-row",children:[e.jsx("span",{children:"Referral Code"}),e.jsx("strong",{children:a.referral_code||"None"})]}),e.jsxs("div",{className:"user-detail-row",children:[e.jsx("span",{children:"Security Question"}),e.jsx("strong",{children:a.security_question?"Set":"Not set"})]})]})]}),u&&u.has_tracking&&e.jsxs("div",{className:"user-detail-section",children:[e.jsx("h4",{children:"Device & Analytics"}),e.jsxs("div",{className:"user-detail-grid",children:[e.jsxs("div",{className:"user-detail-row",children:[e.jsx("span",{children:"Country (IP)"}),e.jsx("strong",{children:u.latest?.country_ip||"Unknown"})]}),e.jsxs("div",{className:"user-detail-row",children:[e.jsx("span",{children:"Country (Profile)"}),e.jsx("strong",{children:a.country||"Not set"})]}),e.jsxs("div",{className:"user-detail-row",children:[e.jsx("span",{children:"Cookie Consent"}),e.jsx("strong",{className:u.cookie_consent?"text-green":"text-red",children:u.cookie_consent===!0?"Accepted":u.cookie_consent===!1?"Declined":"Unknown"})]}),e.jsxs("div",{className:"user-detail-row",children:[e.jsx("span",{children:"Device Type"}),e.jsx("strong",{children:u.latest?.device_type==="mobile"?"Phone":u.latest?.device_type==="tablet"?"Tablet":u.latest?.device_type==="desktop"?"Desktop":"-"})]}),e.jsxs("div",{className:"user-detail-row",children:[e.jsx("span",{children:"Browser"}),e.jsx("strong",{children:u.latest?.browser||"-"})]}),e.jsxs("div",{className:"user-detail-row",children:[e.jsx("span",{children:"Operating System"}),e.jsx("strong",{children:u.latest?.os||"-"})]}),e.jsxs("div",{className:"user-detail-row",children:[e.jsx("span",{children:"Traffic Source"}),e.jsx("strong",{children:u.first_visit?.source||"Direct"})]}),u.first_visit?.referrer&&e.jsxs("div",{className:"user-detail-row",children:[e.jsx("span",{children:"Original Referrer"}),e.jsx("strong",{className:"tracking-referrer",children:u.first_visit.referrer})]}),e.jsxs("div",{className:"user-detail-row",children:[e.jsx("span",{children:"IP Address"}),e.jsx("strong",{children:u.latest?.ip_address||"-"})]}),e.jsxs("div",{className:"user-detail-row",children:[e.jsx("span",{children:"Total Sessions"}),e.jsx("strong",{children:u.total_sessions})]}),e.jsxs("div",{className:"user-detail-row",children:[e.jsx("span",{children:"Total Page Views"}),e.jsx("strong",{children:u.total_pageviews})]}),u.first_visit?.timestamp&&e.jsxs("div",{className:"user-detail-row",children:[e.jsx("span",{children:"First Visit"}),e.jsx("strong",{children:new Date(u.first_visit.timestamp).toLocaleDateString()})]}),u.latest?.last_seen&&e.jsxs("div",{className:"user-detail-row",children:[e.jsx("span",{children:"Last Seen"}),e.jsx("strong",{children:new Date(u.latest.last_seen).toLocaleString()})]})]})]}),e.jsxs("div",{className:"user-detail-section",children:[e.jsx("h4",{children:"Account Balance"}),e.jsxs("div",{className:"user-detail-wallet-grid",children:[e.jsxs("div",{className:"user-detail-wallet-card balance-card",children:[e.jsx("span",{children:"Balance"}),e.jsxs("strong",{className:"balance-amount",children:["$",(U?.balance_usd||0).toFixed(2)," / KES ",(U?.balance_kes||0).toFixed(0)]})]}),e.jsxs("div",{className:"user-detail-wallet-card",children:[e.jsx("span",{children:"Total Deposited"}),e.jsxs("strong",{children:["$",(U?.total_deposited_usd||0).toFixed(2)," / KES ",(U?.total_deposited_kes||0).toFixed(0)]})]}),e.jsxs("div",{className:"user-detail-wallet-card",children:[e.jsx("span",{children:"Total Spent"}),e.jsxs("strong",{children:["$",(U?.total_spent_usd||0).toFixed(2)," / KES ",(U?.total_spent_kes||0).toFixed(0)]})]})]}),D&&e.jsx("div",{className:"balance-adjust-section",children:I?e.jsxs("div",{className:"balance-adjust-form",children:[e.jsxs("div",{className:"balance-adjust-row",children:[e.jsxs("select",{value:q,onChange:$=>y($.target.value),className:"balance-adjust-select",children:[e.jsx("option",{value:"credit",children:"Add (+)"}),e.jsx("option",{value:"debit",children:"Subtract (-)"})]}),e.jsx("input",{type:"number",value:o,onChange:$=>v($.target.value),placeholder:"Amount",min:"0",step:"0.01",className:"balance-adjust-input"}),e.jsxs("select",{value:_,onChange:$=>C($.target.value),className:"balance-adjust-select",children:[e.jsx("option",{value:"USD",children:"USD"}),e.jsx("option",{value:"KES",children:"KES"})]})]}),e.jsx("input",{type:"text",value:x,onChange:$=>F($.target.value),placeholder:"Reason (optional)",className:"balance-adjust-reason"}),e.jsxs("div",{className:"balance-adjust-actions",children:[e.jsx("button",{className:"balance-adjust-btn confirm",onClick:k,disabled:z,children:z?"Updating...":"Confirm"}),e.jsx("button",{className:"balance-adjust-btn cancel",onClick:()=>{N(!1),H("")},children:"Cancel"})]}),g&&e.jsx("div",{className:`balance-adjust-msg ${g.includes("success")?"success":"error"}`,children:g})]}):e.jsx("button",{className:"balance-adjust-toggle",onClick:()=>N(!0),children:"Adjust Balance"})}),J.length>0&&e.jsxs("div",{className:"balance-history",children:[e.jsx("h5",{children:"Recent Adjustments"}),J.map($=>e.jsxs("div",{className:"balance-history-item",children:[e.jsxs("div",{className:"balance-history-top",children:[e.jsx("span",{className:`balance-history-type ${$.adjustment_type}`,children:$.adjustment_type==="admin_credit"?`Credited by ${$.adjusted_by_name||"Super Admin"}`:$.adjustment_type==="admin_debit"?`Debited by ${$.adjusted_by_name||"Super Admin"}`:$.adjustment_type}),e.jsxs("span",{className:"balance-history-amount",children:[$.amount_usd!==0?`${$.amount_usd>0?"+":""}$${$.amount_usd.toFixed(2)}`:"",$.amount_kes!==0?`${$.amount_usd!==0?" / ":""}${$.amount_kes>0?"+":""}KES ${$.amount_kes.toFixed(0)}`:""]})]}),$.reason&&e.jsx("div",{className:"balance-history-reason",children:$.reason}),e.jsx("div",{className:"balance-history-meta",children:e.jsx("span",{children:$.created_at?new Date($.created_at).toLocaleString():""})})]},$.id))]})]}),e.jsxs("div",{className:"user-detail-section",children:[e.jsx("h4",{children:"Subscription"}),P?e.jsxs("div",{className:"user-detail-sub-card",children:[e.jsx("div",{className:"user-detail-sub-plan",children:P.plan?.replace("_"," ").toUpperCase()}),e.jsxs("div",{className:"user-detail-grid",children:[e.jsxs("div",{className:"user-detail-row",children:[e.jsx("span",{children:"Price"}),e.jsxs("strong",{children:[P.price_currency," ",P.price_amount]})]}),e.jsxs("div",{className:"user-detail-row",children:[e.jsx("span",{children:"Status"}),e.jsx("strong",{className:"text-green",children:P.status})]}),e.jsxs("div",{className:"user-detail-row",children:[e.jsx("span",{children:"Expires"}),e.jsx("strong",{children:P.expires_at?new Date(P.expires_at).toLocaleDateString():"N/A"})]}),e.jsxs("div",{className:"user-detail-row",children:[e.jsx("span",{children:"Days Left"}),e.jsx("strong",{children:P.days_remaining})]})]})]}):e.jsx("p",{className:"user-detail-empty",children:"No active subscription (Free tier)"})]}),e.jsxs("div",{className:"user-detail-section",children:[e.jsx("h4",{children:"Creator Wallet"}),K?e.jsxs("div",{className:"user-detail-wallet-grid",children:[e.jsxs("div",{className:"user-detail-wallet-card",children:[e.jsx("span",{children:"Balance"}),e.jsxs("strong",{children:["$",K.balance_usd?.toFixed(2)," / KES ",K.balance_kes?.toFixed(0)]})]}),e.jsxs("div",{className:"user-detail-wallet-card",children:[e.jsx("span",{children:"Total Earned"}),e.jsxs("strong",{children:["$",K.total_earned_usd?.toFixed(2)," / KES ",K.total_earned_kes?.toFixed(0)]})]}),e.jsxs("div",{className:"user-detail-wallet-card",children:[e.jsx("span",{children:"Total Sales"}),e.jsx("strong",{children:K.total_sales})]})]}):e.jsx("p",{className:"user-detail-empty",children:"No creator wallet"})]}),e.jsxs("div",{className:"user-detail-section",children:[e.jsx("h4",{children:"Transaction History"}),n?e.jsxs("div",{className:"user-detail-tx-list",children:[b.map($=>e.jsxs("div",{className:"user-detail-tx-item",children:[e.jsxs("div",{className:"user-detail-tx-top",children:[e.jsx("span",{className:`user-detail-tx-type ${$.transaction_type}`,children:$.transaction_type==="subscription"?"Subscription":$.transaction_type==="prediction_purchase"?"Prediction":$.transaction_type}),e.jsx("span",{className:`user-detail-tx-status ${$.payment_status}`,children:$.payment_status})]}),e.jsxs("div",{className:"user-detail-tx-amounts",children:["KES ",$.amount_kes?.toFixed(0)," ($",$.amount_usd?.toFixed(2),")"]}),e.jsx("div",{className:"user-detail-tx-date",children:$.created_at?new Date($.created_at).toLocaleString():""})]},`tx-${$.id}`)),c.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("h5",{style:{color:"#94a3b8",margin:"12px 0 6px",fontSize:"12px"},children:"Withdrawals"}),c.map($=>e.jsxs("div",{className:"user-detail-tx-item",children:[e.jsxs("div",{className:"user-detail-tx-top",children:[e.jsx("span",{className:"user-detail-tx-type withdrawal",children:"Withdrawal"}),e.jsx("span",{className:`user-detail-tx-status ${$.status}`,children:$.status})]}),e.jsxs("div",{className:"user-detail-tx-amounts",children:["$",$.amount_usd?.toFixed(2)," â†’ KES ",$.amount_kes?.toFixed(0)]}),e.jsx("div",{className:"user-detail-tx-date",children:$.created_at?new Date($.created_at).toLocaleString():""})]},`wd-${$.id}`))]})]}):e.jsx("p",{className:"user-detail-empty",children:"No transactions yet"})]}),e.jsxs("div",{className:"user-detail-actions",children:[e.jsx("button",{className:"admin-action-btn tier",onClick:()=>j(a.id,a.tier),children:a.tier==="pro"?"Downgrade to Free":"Upgrade to Pro"}),e.jsx("button",{className:`admin-action-btn ${a.is_active?"suspend":"activate"}`,onClick:()=>p(a.id,a.is_active),children:a.is_active?"Suspend User":"Activate User"})]})]})]})}function ta(a){if(a<60)return"Just now";if(a<3600)return`${Math.floor(a/60)}m`;const t=Math.floor(a/3600),j=Math.floor(a%3600/60);return j>0?`${t}h ${j}m`:`${t}h`}function na(){const{getAuthHeaders:a,staffRole:t}=fe(),[j,p]=s.useState([]),[E,h]=s.useState(0),[f,o]=s.useState(!0),[v,_]=s.useState(null),C=s.useCallback(async()=>{try{const y=await T.get("/api/admin/active-users?detailed=true",{headers:a()});p(y.data.active_users||[]),h(y.data.count||0)}catch{}o(!1)},[a]);s.useEffect(()=>{C();const y=setInterval(C,3e3);return()=>clearInterval(y)},[C]);const x=async y=>{try{const z=await T.get(`/api/admin/users/${y}`,{headers:a()});_(z.data)}catch{}},F=async(y,z)=>{try{await T.post(`/api/admin/users/${y}/set-tier`,{tier:z==="pro"?"free":"pro"},{headers:a()}),x(y)}catch{}},q=async(y,z)=>{try{await T.post(`/api/admin/users/${y}/toggle-active`,{is_active:z?0:1},{headers:a()}),x(y)}catch{}};return f?e.jsx("div",{className:"admin-loading",children:"Loading online users..."}):e.jsxs("div",{className:"admin-tab-content",children:[e.jsxs("div",{className:"admin-online-header-bar",children:[e.jsxs("h3",{children:[e.jsx("span",{className:"online-dot-pulse"}),E," User",E!==1?"s":""," Currently Online"]}),e.jsx("span",{className:"admin-online-refresh-note",children:"Auto-refreshes every 3s"})]}),j.length===0?e.jsx("div",{className:"admin-empty-row",style:{textAlign:"center",padding:"40px 0"},children:e.jsx("p",{style:{fontSize:"16px",color:"#94a3b8"},children:"No users currently online."})}):e.jsxs("div",{className:"admin-online-detailed-list",children:[e.jsxs("div",{className:"admin-online-table-header",children:[e.jsx("span",{className:"col-avatar"}),e.jsx("span",{className:"col-name",children:"User"}),e.jsx("span",{className:"col-email",children:"Email"}),e.jsx("span",{className:"col-tier",children:"Plan"}),e.jsx("span",{className:"col-status",children:"Session"}),e.jsx("span",{className:"col-joined",children:"Activity"}),e.jsx("span",{className:"col-actions",children:"Actions"})]}),j.map(y=>e.jsxs("div",{className:"admin-online-table-row",children:[e.jsx("span",{className:"col-avatar",children:y.avatar_url?e.jsx("img",{src:y.avatar_url,alt:"",className:"admin-user-avatar",style:{width:32,height:32,borderRadius:"50%"}}):e.jsx("span",{className:"admin-user-avatar",style:{background:y.avatar_color||"#6c5ce7"},children:(y.display_name||"?")[0].toUpperCase()})}),e.jsxs("span",{className:"col-name",children:[e.jsx("strong",{children:y.display_name}),y.full_name&&e.jsx("small",{className:"admin-real-name",children:y.full_name}),e.jsxs("small",{children:["@",y.username]})]}),e.jsx("span",{className:"col-email",children:y.email||"-"}),e.jsx("span",{className:"col-tier",children:y.subscription?e.jsxs("div",{className:"online-plan-info",children:[e.jsx("span",{className:"tier-tag pro",children:y.subscription.plan?.replace("_"," ").toUpperCase()}),e.jsxs("small",{children:[y.subscription.days_remaining,"d left"]})]}):e.jsx("span",{className:`tier-tag ${y.tier||"free"}`,children:(y.tier||"free").toUpperCase()})}),e.jsx("span",{className:"col-status",children:e.jsxs("div",{className:"online-session-info",children:[e.jsx("span",{className:"online-duration",children:ta(y.online_duration)}),e.jsx("small",{className:"online-label",children:"online"})]})}),e.jsxs("span",{className:"col-joined",children:[e.jsx("span",{className:"online-last-active",children:y.last_seen<10?"Active now":`${y.last_seen}s ago`}),y.login_count>0&&e.jsxs("small",{children:[y.login_count," logins"]})]}),e.jsx("span",{className:"col-actions",children:e.jsx("button",{className:"admin-action-btn view-detail",onClick:()=>x(y.user_id),children:"View Profile"})})]},y.user_id))]}),j.length>0&&e.jsxs("div",{className:"admin-online-summary",children:[e.jsx("h4",{children:"Online Users Summary"}),e.jsxs("div",{className:"admin-stats-grid",children:[e.jsx(Q,{label:"Online Now",value:E,color:"#22c55e"}),e.jsx(Q,{label:"Pro Users",value:j.filter(y=>y.tier==="pro"||y.subscription).length,color:"#fdcb6e"}),e.jsx(Q,{label:"Free Users",value:j.filter(y=>y.tier!=="pro"&&!y.subscription).length,color:"#74b9ff"})]})]}),v&&e.jsx("div",{className:"admin-modal-overlay",onClick:()=>_(null),children:e.jsx("div",{className:"user-detail-modal",onClick:y=>y.stopPropagation(),children:e.jsx(us,{userProfile:v,onBack:()=>_(null),onTierChange:F,onToggleActive:q,staffRole:t,getAuthHeaders:a,onRefresh:x})})})]})}const ia=[{key:"community_guidelines",label:"Community Guidelines Violation",desc:"Harassment, threats, or abusive behavior"},{key:"fraudulent_activity",label:"Fraudulent Activity",desc:"Misleading predictions, metric manipulation"},{key:"spam_misleading",label:"Spam or Misleading Content",desc:"Posting spam or false information"},{key:"multiple_accounts",label:"Multiple Accounts",desc:"Operating more than one account"},{key:"payment_abuse",label:"Payment/Earnings Abuse",desc:"Gaming referral or payment system"},{key:"unauthorized_access",label:"Unauthorized Access",desc:"Hacking, scraping, or exploiting vulnerabilities"},{key:"prohibited_content",label:"Prohibited Content",desc:"Promoting illegal services, sharing premium content"},{key:"other",label:"Other",desc:"Custom reason (note required)"}];function ra(){const{getAuthHeaders:a,staffRole:t}=fe(),[j,p]=s.useState([]),[E,h]=s.useState(!0),[f,o]=s.useState(""),[v,_]=s.useState("all"),[C,x]=s.useState("all"),[F,q]=s.useState("all"),[y,z]=s.useState(null),[G,g]=s.useState(""),[H,I]=s.useState(!1),[N,P]=s.useState(""),[K,U]=s.useState(null),[u,J]=s.useState(null),[b,c]=s.useState(""),[n,D]=s.useState(""),[k,$]=s.useState(!1),[ie,Z]=s.useState(""),w=async m=>{try{const r=await T.get(`/api/admin/users/${m}`,{headers:a()});U(r.data)}catch{}},B=async(m,r)=>{try{await T.post(`/api/admin/users/${m}/set-tier`,{tier:r==="pro"?"free":"pro"},{headers:a()}),w(m),W()}catch{}},X=async(m,r)=>{if(r){const Y=j.find(se=>se.id===m)||K;Y&&J(Y)}else try{await T.post(`/api/admin/users/${m}/toggle-active`,{is_active:!0},{headers:a()}),w(m),W()}catch{}},W=s.useCallback(async()=>{h(!0);try{const m=await T.get("/api/admin/users",{headers:a()});p(m.data.users||[])}catch{}h(!1)},[a]);s.useEffect(()=>{W()},[W]);const ee=async(m,r)=>{if(r){const Y=j.find(se=>se.id===m);Y&&J(Y)}else try{await T.post(`/api/admin/users/${m}/toggle-active`,{is_active:!0},{headers:a()}),W()}catch{alert("Failed to activate user")}},M=async()=>{if(!b){Z("Please select a suspension reason");return}if(b==="other"&&!n.trim()){Z("Please provide a note explaining the reason");return}$(!0),Z("");try{await T.post(`/api/admin/users/${u.id}/toggle-active`,{is_active:!1,reason:b,custom_note:n.trim()||void 0},{headers:a()}),Z("User suspended successfully. Suspension email sent."),W(),K&&K.id===u.id&&w(u.id),setTimeout(()=>{J(null),c(""),D(""),Z("")},1500)}catch(m){Z(m.response?.data?.detail||"Failed to suspend user")}$(!1)},ae=async(m,r)=>{try{await T.post(`/api/admin/users/${m}/set-tier`,{tier:r},{headers:a()}),W()}catch{alert("Failed to update tier")}},A=async()=>{if(!G||G.length<8){P("Password must be at least 8 characters");return}I(!0),P("");try{const m=await T.post(`/api/admin/users/${y.id}/reset-password`,{new_password:G},{headers:a()});P(m.data.message||"Password reset successfully"),g(""),setTimeout(()=>{z(null),P("")},1500)}catch(m){P(m.response?.data?.detail||"Failed to reset password")}I(!1)},S=j.filter(m=>{const r=f.toLowerCase(),Y=!f||(m.email||"").toLowerCase().includes(r)||(m.username||"").toLowerCase().includes(r)||(m.display_name||"").toLowerCase().includes(r)||(m.full_name||"").toLowerCase().includes(r)||(m.country||"").toLowerCase().includes(r)||(m.country_ip||"").toLowerCase().includes(r),se=v==="all"||m.tier===v,V=C==="all"||(m.device_type||"").toLowerCase()===C,l=F==="all"||(F==="other"?!["Direct","Google","YouTube","TikTok","X (Twitter)","Facebook","Instagram"].includes(m.source||"Direct"):(m.source||"Direct")===F);return Y&&se&&V&&l});return E?e.jsx("div",{className:"admin-loading",children:"Loading users..."}):e.jsxs("div",{className:"admin-tab-content",children:[e.jsxs("div",{className:"admin-users-toolbar",children:[e.jsx("input",{type:"text",placeholder:"Search by email, name, or country...",value:f,onChange:m=>o(m.target.value),className:"admin-search-input"}),e.jsxs("select",{value:v,onChange:m=>_(m.target.value),className:"admin-filter-select",children:[e.jsx("option",{value:"all",children:"All Tiers"}),e.jsx("option",{value:"free",children:"Free"}),e.jsx("option",{value:"pro",children:"Pro"})]}),e.jsxs("select",{value:C,onChange:m=>x(m.target.value),className:"admin-filter-select",children:[e.jsx("option",{value:"all",children:"All Devices"}),e.jsx("option",{value:"mobile",children:"Mobile"}),e.jsx("option",{value:"tablet",children:"Tablet"}),e.jsx("option",{value:"desktop",children:"Desktop"})]}),e.jsxs("select",{value:F,onChange:m=>q(m.target.value),className:"admin-filter-select",children:[e.jsx("option",{value:"all",children:"All Sources"}),e.jsx("option",{value:"Direct",children:"Direct"}),e.jsx("option",{value:"Google",children:"Google"}),e.jsx("option",{value:"YouTube",children:"YouTube"}),e.jsx("option",{value:"TikTok",children:"TikTok"}),e.jsx("option",{value:"X (Twitter)",children:"X (Twitter)"}),e.jsx("option",{value:"Facebook",children:"Facebook"}),e.jsx("option",{value:"Instagram",children:"Instagram"}),e.jsx("option",{value:"other",children:"Other"})]}),e.jsxs("span",{className:"admin-user-count",children:[S.length," users"]})]}),e.jsxs("div",{className:"admin-users-table admin-users-table-wide",children:[e.jsxs("div",{className:"admin-table-header",children:[e.jsx("span",{className:"col-avatar"}),e.jsx("span",{className:"col-name",children:"User"}),e.jsx("span",{className:"col-country",children:"Country"}),e.jsx("span",{className:"col-ip",children:"IP Address"}),e.jsx("span",{className:"col-device",children:"Device"}),e.jsx("span",{className:"col-browser-os",children:"Browser / OS"}),e.jsx("span",{className:"col-source",children:"Source"}),e.jsx("span",{className:"col-tier",children:"Tier"}),e.jsx("span",{className:"col-status",children:"Status"}),e.jsx("span",{className:"col-joined",children:"Joined"}),e.jsx("span",{className:"col-actions",children:"Actions"})]}),S.map(m=>{const r=m.country_ip||m.country||"-",Y=m.device_type==="mobile"?"Phone":m.device_type==="tablet"?"Tablet":m.device_type==="desktop"?"Desktop":"-",se=m.device_type||"unknown",V=m.browser&&m.os?`${m.browser} / ${m.os}`:m.browser||m.os||"-",l=m.source||"Direct";return e.jsxs("div",{className:`admin-table-row ${m.is_active?"":"suspended"}`,children:[e.jsx("span",{className:"col-avatar",children:e.jsx("span",{className:"admin-user-avatar",style:{background:m.avatar_color||"#6c5ce7"},children:(m.display_name||m.username||"?")[0].toUpperCase()})}),e.jsxs("span",{className:"col-name",children:[e.jsx("strong",{children:m.display_name||"No Name"}),m.full_name&&e.jsx("small",{className:"admin-real-name",children:m.full_name}),e.jsxs("small",{children:["@",m.username]})]}),e.jsx("span",{className:"col-country",children:r}),e.jsx("span",{className:"col-ip",children:m.ip_address||"-"}),e.jsx("span",{className:"col-device",children:e.jsx("span",{className:`device-badge ${se}`,children:Y})}),e.jsx("span",{className:"col-browser-os",children:V}),e.jsx("span",{className:"col-source",children:e.jsx("span",{className:`source-badge source-${l.toLowerCase().replace(/[\s()]/g,"")}`,children:l})}),e.jsx("span",{className:"col-tier",children:e.jsx("span",{className:`tier-tag ${m.tier}`,children:m.tier?.toUpperCase()})}),e.jsxs("span",{className:"col-status",children:[e.jsx("span",{className:`status-dot ${m.is_active?"active":"suspended"}`}),m.is_active?"Active":"Suspended"]}),e.jsx("span",{className:"col-joined",children:m.created_at?new Date(m.created_at).toLocaleDateString():"-"}),e.jsxs("span",{className:"col-actions",children:[e.jsx("button",{className:"admin-action-btn view-detail",onClick:()=>w(m.id),children:"View"}),e.jsx("button",{className:`admin-action-btn ${m.tier==="pro"?"downgrade":"upgrade"}`,onClick:()=>ae(m.id,m.tier==="pro"?"free":"pro"),children:m.tier==="pro"?"Downgrade":"Upgrade"}),e.jsx("button",{className:`admin-action-btn ${m.is_active?"suspend":"activate"}`,onClick:()=>ee(m.id,m.is_active),children:m.is_active?"Suspend":"Activate"}),e.jsx("button",{className:"admin-action-btn reset-pw",onClick:()=>{z(m),g(""),P("")},children:"Reset PW"})]})]},m.id)}),S.length===0&&e.jsx("div",{className:"admin-empty-row",children:"No users found"})]}),y&&e.jsx("div",{className:"admin-modal-overlay",onClick:()=>z(null),children:e.jsxs("div",{className:"admin-modal",onClick:m=>m.stopPropagation(),children:[e.jsx("h3",{children:"Reset Password"}),e.jsxs("p",{className:"admin-modal-user",children:[y.display_name||y.username," (",y.email,")"]}),e.jsx("input",{type:"text",value:G,onChange:m=>g(m.target.value),placeholder:"New password (min 8 chars)",className:"admin-modal-input",autoFocus:!0}),N&&e.jsx("div",{className:`admin-modal-msg ${N.includes("success")?"success":"error"}`,children:N}),e.jsxs("div",{className:"admin-modal-actions",children:[e.jsx("button",{className:"admin-modal-cancel",onClick:()=>z(null),children:"Cancel"}),e.jsx("button",{className:"admin-modal-confirm",onClick:A,disabled:H,children:H?"Resetting...":"Reset Password"})]})]})}),u&&e.jsx("div",{className:"admin-modal-overlay",onClick:()=>{k||(J(null),c(""),D(""),Z(""))},children:e.jsxs("div",{className:"admin-modal suspend-modal",onClick:m=>m.stopPropagation(),children:[e.jsx("h3",{children:"Suspend User"}),e.jsxs("p",{className:"admin-modal-user",children:[u.display_name||u.username," (",u.email,")"]}),e.jsx("label",{className:"suspend-label",children:"Reason for Suspension *"}),e.jsxs("select",{value:b,onChange:m=>{c(m.target.value),Z("")},className:"admin-modal-input suspend-reason-select",children:[e.jsx("option",{value:"",children:"-- Select a reason --"}),ia.map(m=>e.jsxs("option",{value:m.key,children:[m.label," â€” ",m.desc]},m.key))]}),e.jsxs("label",{className:"suspend-label",children:["Additional Note ",b==="other"?"*":"(optional)"]}),e.jsx("textarea",{value:n,onChange:m=>{D(m.target.value),Z("")},placeholder:b==="other"?"Describe the specific reason...":"Optional note to include in the suspension email...",className:"admin-modal-input suspend-note-textarea",rows:3}),e.jsx("div",{className:"suspend-warning",children:"This will immediately log the user out, hide their predictions, refund all purchases to buyers, and send a suspension notification email."}),ie&&e.jsx("div",{className:`admin-modal-msg ${ie.includes("success")?"success":"error"}`,children:ie}),e.jsxs("div",{className:"admin-modal-actions",children:[e.jsx("button",{className:"admin-modal-cancel",onClick:()=>{J(null),c(""),D(""),Z("")},disabled:k,children:"Cancel"}),e.jsx("button",{className:"admin-modal-confirm suspend-confirm-btn",onClick:M,disabled:k,children:k?"Suspending...":"Confirm Suspension"})]})]})}),K&&e.jsx("div",{className:"admin-modal-overlay",onClick:()=>U(null),children:e.jsx("div",{className:"user-detail-modal",onClick:m=>m.stopPropagation(),children:e.jsx(us,{userProfile:K,onBack:()=>U(null),onTierChange:B,onToggleActive:X,staffRole:t,getAuthHeaders:a,onRefresh:w})})})]})}function la(){const{getAuthHeaders:a}=fe(),[t,j]=s.useState([]),[p,E]=s.useState(!0),h=s.useCallback(async()=>{E(!0);try{const v=((await T.get("/api/admin/users",{headers:a()})).data.users||[]).filter(_=>_.tier==="pro");j(v)}catch{}E(!1)},[a]);s.useEffect(()=>{h()},[h]);const f=async o=>{if(confirm("Downgrade this user to free tier?"))try{await T.post(`/api/admin/users/${o}/set-tier`,{tier:"free"},{headers:a()}),h()}catch{alert("Failed to downgrade user")}};return p?e.jsx("div",{className:"admin-loading",children:"Loading subscriptions..."}):e.jsxs("div",{className:"admin-tab-content",children:[e.jsxs("h3",{children:["Pro Users (",t.length,")"]}),t.length===0?e.jsx("p",{className:"admin-empty-row",children:"No pro users yet."}):e.jsxs("div",{className:"admin-users-table",children:[e.jsxs("div",{className:"admin-table-header",children:[e.jsx("span",{className:"col-avatar"}),e.jsx("span",{className:"col-name",children:"User"}),e.jsx("span",{className:"col-email",children:"Email"}),e.jsx("span",{className:"col-joined",children:"Joined"}),e.jsx("span",{className:"col-actions",children:"Actions"})]}),t.map(o=>e.jsxs("div",{className:"admin-table-row",children:[e.jsx("span",{className:"col-avatar",children:e.jsx("span",{className:"admin-user-avatar",style:{background:o.avatar_color||"#6c5ce7"},children:(o.display_name||o.username||"?")[0].toUpperCase()})}),e.jsxs("span",{className:"col-name",children:[e.jsx("strong",{children:o.display_name||"No Name"}),e.jsxs("small",{children:["@",o.username]})]}),e.jsx("span",{className:"col-email",children:o.email}),e.jsx("span",{className:"col-joined",children:o.created_at?new Date(o.created_at).toLocaleDateString():"-"}),e.jsx("span",{className:"col-actions",children:e.jsx("button",{className:"admin-action-btn downgrade",onClick:()=>f(o.id),children:"Downgrade"})})]},o.id))]})]})}const ca=[{key:"batch",label:"Batch Disbursements",icon:"ðŸ“¦"},{key:"pending",label:"Individual Requests",icon:"â³"},{key:"options",label:"Withdrawal Methods",icon:"ðŸ’³"},{key:"history",label:"History",icon:"ðŸ“‹"}],ns={pending:"warning",approved:"info",processing:"info",completed:"success",partially_completed:"warning",failed:"danger",cancelled:"neutral",rejected:"danger",sent:"success"};function oa(){const{getAuthHeaders:a}=fe(),[t,j]=s.useState("batch"),[p,E]=s.useState(null),[h,f]=s.useState([]),[o,v]=s.useState(!1),[_,C]=s.useState(!1),[x,F]=s.useState(!1),[q,y]=s.useState(!1),[z,G]=s.useState([]),[g,H]=s.useState(!1),[I,N]=s.useState([]),[P,K]=s.useState(!1),[U,u]=s.useState([]),[J,b]=s.useState(!1),[c,n]=s.useState(null),[D,k]=s.useState(""),[$,ie]=s.useState(""),Z=s.useCallback(async()=>{v(!0);try{const l=await T.get("/api/admin/disbursements/pending",{headers:a()});E(l.data.batch||null),f(l.data.items||[])}catch{}v(!1)},[a]),w=s.useCallback(async()=>{H(!0);try{const l=await T.get("/api/admin/withdrawals/pending",{headers:a()});G(l.data.withdrawals||[])}catch{}H(!1)},[a]),B=s.useCallback(async()=>{K(!0);try{const l=await T.get("/api/admin/withdrawal-options",{headers:a()});N(l.data.options||[])}catch{}K(!1)},[a]),X=s.useCallback(async()=>{b(!0);try{const l=await T.get("/api/admin/disbursements/history?limit=30",{headers:a()});u(l.data.batches||[])}catch{}b(!1)},[a]);s.useEffect(()=>{t==="batch"?Z():t==="pending"?w():t==="options"?B():t==="history"&&X()},[t,Z,w,B,X]);const W=async()=>{C(!0),ie(""),k("");try{const l=await T.post("/api/admin/disbursements/generate",{},{headers:a()});k(`Batch #${l.data.batch_id} generated: ${l.data.total_users} users, $${l.data.total_amount_usd?.toFixed(2)} (M-Pesa: ${l.data.mpesa_users||0}, Whop: ${l.data.whop_users||0})`),Z()}catch(l){ie(l.response?.data?.detail||"Failed to generate batch")}C(!1)},ee=async()=>{if(p){F(!0),ie("");try{const l=await T.post(`/api/admin/disbursements/${p.id}/approve`,{},{headers:a()});k(`Batch approved & executed: ${l.data.sent} sent, ${l.data.failed} failed`),y(!1),Z()}catch(l){ie(l.response?.data?.detail||"Approval failed")}F(!1)}},M=async()=>{if(p){ie("");try{await T.post(`/api/admin/disbursements/${p.id}/cancel`,{},{headers:a()}),k("Batch cancelled"),E(null),f([])}catch(l){ie(l.response?.data?.detail||"Cancel failed")}}},ae=async l=>{ie("");try{await T.post(`/api/admin/disbursements/items/${l}/retry`,{},{headers:a()}),k("Retry initiated"),Z()}catch(re){ie(re.response?.data?.detail||"Retry failed")}},A=async(l,re)=>{try{await T.post(`/api/admin/withdrawals/${l}/${re}`,{},{headers:a()}),w()}catch(Se){alert(Se.response?.data?.detail||`Failed to ${re}`)}},S=async l=>{try{await T.post(`/api/admin/withdrawals/${l}/retry-whop`,{},{headers:a()}),w()}catch(re){alert(re.response?.data?.detail||"Retry failed")}},m=()=>o?e.jsx("div",{className:"admin-loading",children:"Loading batch data..."}):e.jsxs("div",{className:"wd-section",children:[e.jsxs("div",{className:"wd-batch-actions",children:[e.jsx("button",{className:"admin-btn admin-btn-primary",onClick:W,disabled:_||!!p,children:_?"Generating...":"Generate Weekly Batch"}),p&&p.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"admin-btn admin-btn-success",onClick:()=>y(!0),disabled:x,children:"Approve & Execute"}),e.jsx("button",{className:"admin-btn admin-btn-danger",onClick:M,children:"Cancel Batch"})]}),e.jsx("button",{className:"admin-btn admin-btn-outline",onClick:Z,children:"Refresh"})]}),p?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"admin-stats-grid",style:{marginTop:0},children:[e.jsxs("div",{className:"admin-stat-card",children:[e.jsx("span",{className:"admin-stat-icon",children:"ðŸ‘¥"}),e.jsxs("div",{children:[e.jsx("div",{className:"admin-stat-value",children:p.total_users}),e.jsx("div",{className:"admin-stat-label",children:"Total Users"})]})]}),e.jsxs("div",{className:"admin-stat-card",children:[e.jsx("span",{className:"admin-stat-icon",children:"ðŸ“±"}),e.jsxs("div",{children:[e.jsx("div",{className:"admin-stat-value",children:p.total_mpesa_users||0}),e.jsx("div",{className:"admin-stat-label",children:"M-Pesa Users"})]})]}),e.jsxs("div",{className:"admin-stat-card",children:[e.jsx("span",{className:"admin-stat-icon",children:"ðŸ’œ"}),e.jsxs("div",{children:[e.jsx("div",{className:"admin-stat-value",children:p.total_whop_users||0}),e.jsx("div",{className:"admin-stat-label",children:"Whop Users"})]})]}),e.jsxs("div",{className:"admin-stat-card",children:[e.jsx("span",{className:"admin-stat-icon",children:"ðŸ’°"}),e.jsxs("div",{children:[e.jsxs("div",{className:"admin-stat-value",children:["$",p.total_amount_usd?.toFixed(2)]}),e.jsx("div",{className:"admin-stat-label",children:"Total USD"}),e.jsxs("div",{className:"admin-stat-sub",children:["KES ",p.total_amount_kes?.toFixed(0)," @ ",p.exchange_rate?.toFixed(2)]})]})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,margin:"16px 0 8px"},children:[e.jsxs("h4",{style:{margin:0,fontWeight:600},children:["Batch Items (",h.length,")"]}),e.jsx("span",{className:`admin-badge admin-badge-${ns[p.status]||"neutral"}`,children:p.status})]}),e.jsx("div",{className:"admin-table-wrap",children:e.jsxs("table",{className:"admin-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"User"}),e.jsx("th",{children:"Method"}),e.jsx("th",{children:"Amount (USD)"}),e.jsx("th",{children:"Amount (KES)"}),e.jsx("th",{children:"Fee"}),e.jsx("th",{children:"Phone / ID"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:h.map(l=>e.jsxs("tr",{children:[e.jsx("td",{children:l.display_name||l.username||`#${l.user_id}`}),e.jsx("td",{children:e.jsx("span",{className:`admin-badge ${l.withdrawal_method==="whop"?"admin-badge-info":"admin-badge-success"}`,children:l.withdrawal_method==="whop"?"Whop":"M-Pesa"})}),e.jsxs("td",{children:["$",l.amount_usd?.toFixed(2)]}),e.jsx("td",{children:l.amount_kes?`KES ${l.amount_kes.toFixed(0)}`:"-"}),e.jsx("td",{style:{fontSize:12,color:"var(--admin-text-muted)"},children:l.fee_kes?`KES ${l.fee_kes}`:l.fee_usd?`$${l.fee_usd.toFixed(2)}`:"-"}),e.jsx("td",{style:{fontFamily:"monospace",fontSize:12},children:l.withdrawal_method==="whop"?l.whop_user_id||"-":l.phone_masked||l.phone||"-"}),e.jsx("td",{children:e.jsx("span",{className:`admin-badge admin-badge-${ns[l.status]||"neutral"}`,children:l.status})}),e.jsx("td",{children:(l.status==="failed"||l.status==="timeout")&&(l.retry_count||0)<3&&e.jsx("button",{className:"admin-btn admin-btn-sm admin-btn-warning",onClick:()=>ae(l.id),children:"Retry"})})]},l.id))})]})})]}):e.jsxs("div",{className:"admin-empty",children:[e.jsx("div",{className:"admin-empty-icon",children:"ðŸ“¦"}),e.jsx("div",{className:"admin-empty-title",children:"No Pending Batch"}),e.jsx("p",{style:{color:"var(--admin-text-muted)",fontSize:13},children:"Generate a new batch to start the weekly disbursement process. Only users with verified, active withdrawal methods past their 48h cooldown will be included."})]})]}),r=()=>g?e.jsx("div",{className:"admin-loading",children:"Loading withdrawal requests..."}):e.jsxs("div",{className:"wd-section",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:16},children:[e.jsxs("h4",{style:{margin:0},children:["Pending Requests (",z.length,")"]}),e.jsx("button",{className:"admin-btn admin-btn-sm admin-btn-outline",onClick:w,children:"Refresh"})]}),z.length===0?e.jsxs("div",{className:"admin-empty",children:[e.jsx("div",{className:"admin-empty-icon",children:"âœ…"}),e.jsx("div",{className:"admin-empty-title",children:"All Clear"}),e.jsx("p",{style:{color:"var(--admin-text-muted)",fontSize:13},children:"No pending individual withdrawal requests."})]}):e.jsx("div",{className:"admin-withdrawal-list",children:z.map(l=>{const re=l.withdrawal_method==="whop";return e.jsxs("div",{className:"admin-withdrawal-card",children:[e.jsxs("div",{className:"admin-withdrawal-header",children:[e.jsxs("span",{className:"admin-withdrawal-user",children:[l.display_name||l.username||`User #${l.user_id}`,e.jsx("span",{style:{display:"inline-block",marginLeft:8,padding:"2px 8px",borderRadius:4,fontSize:11,fontWeight:600,background:re?"rgba(139, 92, 246, 0.15)":"rgba(34, 197, 94, 0.15)",color:re?"#a78bfa":"#22c55e"},children:re?"Whop (USD)":"M-Pesa"})]}),e.jsxs("span",{className:"admin-withdrawal-amount",children:["$",l.amount_usd.toFixed(2)]})]}),e.jsxs("div",{className:"admin-withdrawal-details",children:[re?e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:["Whop ID: ",l.whop_user_id||"N/A"]}),l.whop_transfer_id&&e.jsxs("span",{children:["Transfer: ",l.whop_transfer_id]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:["~KES ",(l.amount_kes||0).toFixed(0)]}),e.jsxs("span",{children:["M-Pesa: ",l.phone_number]})]}),e.jsx("span",{children:new Date(l.created_at).toLocaleString()}),e.jsx("span",{className:`withdrawal-status-badge ${l.status}`,children:l.status})]}),l.admin_notes&&e.jsxs("div",{style:{fontSize:12,color:"#94a3b8",padding:"4px 0",fontStyle:"italic"},children:["Note: ",l.admin_notes]}),e.jsxs("div",{className:"admin-withdrawal-actions",children:[l.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"admin-approve-btn",onClick:()=>A(l.id,"approve"),children:re?"Approve & Transfer":"Approve"}),e.jsx("button",{className:"admin-reject-btn",onClick:()=>A(l.id,"reject"),children:"Reject"})]}),l.status==="approved"&&!re&&e.jsx("button",{className:"admin-complete-btn",onClick:()=>A(l.id,"complete"),children:"Mark Completed"}),l.status==="approved"&&re&&e.jsx("button",{className:"admin-complete-btn",onClick:()=>S(l.id),style:{background:"#8b5cf6"},children:"Retry Whop Transfer"})]})]},l.id)})})]}),Y=()=>P?e.jsx("div",{className:"admin-loading",children:"Loading withdrawal methods..."}):e.jsxs("div",{className:"wd-section",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:16},children:[e.jsxs("h4",{style:{margin:0},children:["User Withdrawal Methods (",I.length,")"]}),e.jsx("button",{className:"admin-btn admin-btn-sm admin-btn-outline",onClick:B,children:"Refresh"})]}),I.length===0?e.jsxs("div",{className:"admin-empty",children:[e.jsx("div",{className:"admin-empty-icon",children:"ðŸ’³"}),e.jsx("div",{className:"admin-empty-title",children:"No Withdrawal Methods"}),e.jsx("p",{style:{color:"var(--admin-text-muted)",fontSize:13},children:"No users have set up withdrawal methods yet."})]}):e.jsx("div",{className:"admin-table-wrap",children:e.jsxs("table",{className:"admin-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"User"}),e.jsx("th",{children:"Method"}),e.jsx("th",{children:"Details"}),e.jsx("th",{children:"Verified"}),e.jsx("th",{children:"Cooldown"}),e.jsx("th",{children:"Primary"}),e.jsx("th",{children:"Added"})]})}),e.jsx("tbody",{children:I.map(l=>e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsx("div",{style:{fontWeight:500},children:l.display_name||l.username||`User #${l.user_id}`}),e.jsxs("div",{style:{fontSize:11,color:"var(--admin-text-muted)"},children:["ID: ",l.user_id]})]}),e.jsx("td",{children:e.jsx("span",{className:`admin-badge ${l.method==="whop"?"admin-badge-info":"admin-badge-success"}`,children:l.method==="whop"?"Whop (USD)":"M-Pesa (KES)"})}),e.jsx("td",{style:{fontFamily:"monospace",fontSize:12},children:l.method==="mpesa"?l.mpesa_phone_masked||"-":l.whop_linked?"Linked":"-"}),e.jsx("td",{children:l.method==="mpesa"?l.mpesa_phone_verified?e.jsx("span",{className:"admin-badge admin-badge-success",children:"Verified"}):e.jsx("span",{className:"admin-badge admin-badge-warning",children:"Unverified"}):l.whop_linked?e.jsx("span",{className:"admin-badge admin-badge-success",children:"Linked"}):e.jsx("span",{className:"admin-badge admin-badge-warning",children:"Not Linked"})}),e.jsx("td",{children:l.cooldown_active?e.jsxs("span",{className:"admin-badge admin-badge-danger",children:[l.cooldown_remaining_hours,"h left"]}):e.jsx("span",{className:"admin-badge admin-badge-neutral",children:"Clear"})}),e.jsx("td",{style:{textAlign:"center"},children:l.is_primary?e.jsx("span",{style:{color:"var(--admin-success)",fontWeight:600},children:"âœ“"}):e.jsx("span",{style:{color:"var(--admin-text-muted)"},children:"-"})}),e.jsx("td",{style:{fontSize:12,color:"var(--admin-text-muted)"},children:new Date(l.created_at).toLocaleDateString()})]},l.id))})]})})]}),se=()=>J?e.jsx("div",{className:"admin-loading",children:"Loading history..."}):e.jsxs("div",{className:"wd-section",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:16},children:[e.jsxs("h4",{style:{margin:0},children:["Disbursement History (",U.length,")"]}),e.jsx("button",{className:"admin-btn admin-btn-sm admin-btn-outline",onClick:X,children:"Refresh"})]}),U.length===0?e.jsxs("div",{className:"admin-empty",children:[e.jsx("div",{className:"admin-empty-icon",children:"ðŸ“‹"}),e.jsx("div",{className:"admin-empty-title",children:"No History Yet"}),e.jsx("p",{style:{color:"var(--admin-text-muted)",fontSize:13},children:"Past disbursement batches will appear here after processing."})]}):e.jsx("div",{className:"wd-history-list",children:U.map(l=>{const re=c===l.id;return e.jsxs("div",{className:"admin-card",children:[e.jsxs("div",{className:"admin-card-header",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[e.jsxs("span",{className:"admin-card-title",children:["Batch #",l.id]}),e.jsx("span",{className:`admin-badge admin-badge-${ns[l.status]||"neutral"}`,children:l.status})]}),e.jsx("span",{style:{fontSize:12,color:"var(--admin-text-muted)"},children:l.batch_date||new Date(l.created_at).toLocaleDateString()})]}),e.jsxs("div",{className:"wd-history-stats",children:[e.jsxs("span",{children:["ðŸ‘¥"," ",l.total_users," users"]}),e.jsxs("span",{children:["ðŸ’µ"," $",l.total_amount_usd?.toFixed(2)]}),e.jsxs("span",{children:["ðŸ’±"," KES ",l.total_amount_kes?.toFixed(0)]}),e.jsxs("span",{children:["Rate: ",l.exchange_rate?.toFixed(2)]}),l.total_mpesa_users>0&&e.jsxs("span",{children:["ðŸ“±"," ",l.total_mpesa_users," M-Pesa"]}),l.total_whop_users>0&&e.jsxs("span",{children:["ðŸ’œ"," ",l.total_whop_users," Whop"]})]}),e.jsx("button",{className:"admin-btn admin-btn-sm admin-btn-outline",style:{marginTop:10},onClick:()=>n(re?null:l.id),children:re?"Hide Details":"Show Details"}),re&&e.jsx("div",{className:"wd-batch-detail",children:e.jsxs("dl",{className:"wd-batch-detail-grid",children:[e.jsxs("div",{children:[e.jsx("dt",{children:"Created"}),e.jsx("dd",{children:new Date(l.created_at).toLocaleString()})]}),l.approved_at&&e.jsxs("div",{children:[e.jsx("dt",{children:"Approved"}),e.jsx("dd",{children:new Date(l.approved_at).toLocaleString()})]}),l.completed_at&&e.jsxs("div",{children:[e.jsx("dt",{children:"Completed"}),e.jsx("dd",{children:new Date(l.completed_at).toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("dt",{children:"Exchange Rate"}),e.jsxs("dd",{children:["1 USD = ",l.exchange_rate?.toFixed(2)," KES"]})]}),l.admin_notes&&e.jsxs("div",{style:{gridColumn:"1 / -1"},children:[e.jsx("dt",{children:"Admin Notes"}),e.jsx("dd",{style:{fontStyle:"italic"},children:l.admin_notes})]})]})})]},l.id)})})]}),V=()=>e.jsx("div",{className:"admin-confirm-overlay",onClick:()=>y(!1),children:e.jsxs("div",{className:"admin-confirm-dialog",onClick:l=>l.stopPropagation(),children:[e.jsx("h3",{children:"Confirm Batch Approval"}),e.jsxs("p",{children:["This will execute ",e.jsx("strong",{children:p.total_users})," disbursements totaling"," ",e.jsxs("strong",{children:["$",p.total_amount_usd?.toFixed(2)]})," ","(KES ",p.total_amount_kes?.toFixed(0),")."]}),e.jsxs("p",{style:{fontSize:12,color:"var(--admin-text-muted)"},children:["M-Pesa: ",p.total_mpesa_users||0," users | Whop: ",p.total_whop_users||0," users",e.jsx("br",{}),"This action cannot be undone."]}),e.jsxs("div",{className:"admin-confirm-actions",children:[e.jsx("button",{className:"admin-btn admin-btn-outline",onClick:()=>y(!1),children:"Cancel"}),e.jsx("button",{className:"admin-btn admin-btn-success",onClick:ee,disabled:x,children:x?"Processing...":"Approve & Execute"})]})]})});return e.jsxs("div",{className:"admin-tab-content",children:[e.jsx("h2",{style:{margin:"0 0 4px",fontSize:24,fontWeight:700},children:"Withdrawal Management"}),e.jsx("p",{style:{color:"var(--admin-text-muted)",fontSize:14,margin:"0 0 20px"},children:"Manage batch disbursements, individual requests, and user withdrawal methods"}),e.jsx("div",{className:"wd-subtab-bar",children:ca.map(l=>e.jsxs("button",{className:`wd-subtab-btn ${t===l.key?"active":""}`,onClick:()=>{j(l.key),k(""),ie("")},children:[e.jsx("span",{className:"wd-subtab-icon",children:l.icon}),l.label]},l.key))}),D&&e.jsx("div",{className:"wd-status-msg success",children:D}),$&&e.jsx("div",{className:"wd-status-msg error",children:$}),t==="batch"&&m(),t==="pending"&&r(),t==="options"&&Y(),t==="history"&&se(),q&&p&&V()]})}function da(){const{getAuthHeaders:a}=fe(),[t,j]=s.useState([]),[p,E]=s.useState(!0),[h,f]=s.useState(1),[o,v]=s.useState(1),_=s.useCallback(async(x=1)=>{E(!0);try{const F=await T.get(`/api/community/predictions?page=${x}&per_page=20`);j(F.data.predictions||[]),v(F.data.total_pages||1),f(x)}catch{}E(!1)},[]);s.useEffect(()=>{_()},[_]);const C=async x=>{if(confirm("Delete this prediction? This cannot be undone."))try{await T.delete(`/api/admin/community/${x}`,{headers:a()}),_(h)}catch{alert("Failed to delete prediction")}};return p?e.jsx("div",{className:"admin-loading",children:"Loading predictions..."}):e.jsxs("div",{className:"admin-tab-content",children:[e.jsxs("h3",{children:["Community Predictions (",t.length,")"]}),e.jsxs("div",{className:"admin-community-list",children:[t.map(x=>e.jsxs("div",{className:"admin-community-item",children:[e.jsxs("div",{className:"admin-community-item-header",children:[e.jsxs("span",{className:"admin-pred-user",children:[e.jsx("span",{className:"admin-user-avatar-sm",style:{background:x.avatar_color},children:(x.display_name||"?")[0].toUpperCase()}),e.jsx("strong",{children:x.display_name}),e.jsxs("small",{children:["@",x.username]})]}),e.jsx("span",{className:"admin-pred-date",children:new Date(x.created_at).toLocaleString()})]}),e.jsxs("div",{className:"admin-community-item-body",children:[e.jsxs("span",{className:"admin-pred-match",children:[x.team_a_name," vs ",x.team_b_name]}),e.jsxs("span",{className:"admin-pred-pick",children:["Pick: ",x.predicted_result," (",Math.round(x.predicted_result_prob||0),"%)"]}),x.analysis_summary&&e.jsx("p",{className:"admin-pred-summary",children:x.analysis_summary})]}),e.jsxs("div",{className:"admin-community-item-footer",children:[e.jsxs("span",{children:["Ratings: ",x.rating_count," | Comments: ",x.comment_count," | Avg: ",x.avg_rating||"-"]}),e.jsx("button",{className:"admin-delete-btn",onClick:()=>C(x.id),children:"Delete"})]})]},x.id)),t.length===0&&e.jsx("p",{className:"admin-empty-row",children:"No community predictions yet."})]}),o>1&&e.jsxs("div",{className:"admin-pagination",children:[e.jsx("button",{disabled:h<=1,onClick:()=>_(h-1),children:"Prev"}),e.jsxs("span",{children:["Page ",h," of ",o]}),e.jsx("button",{disabled:h>=o,onClick:()=>_(h+1),children:"Next"})]})]})}function ma(){const{getAuthHeaders:a}=fe(),[t,j]=s.useState([]),[p,E]=s.useState(!0),h=s.useCallback(async()=>{E(!0);try{const f=await T.get("/api/admin/referral-stats",{headers:a()});j(f.data.referrals||[])}catch{}E(!1)},[a]);return s.useEffect(()=>{h()},[h]),p?e.jsx("div",{className:"admin-loading",children:"Loading referral data..."}):e.jsxs("div",{className:"admin-tab-content",children:[e.jsx("h3",{children:"Referral Leaderboard"}),t.length===0?e.jsx("p",{className:"admin-empty-row",children:"No referrals yet."}):e.jsxs("div",{className:"admin-users-table",children:[e.jsxs("div",{className:"admin-referral-header",children:[e.jsx("span",{className:"col-avatar"}),e.jsx("span",{children:"User"}),e.jsx("span",{children:"Code"}),e.jsx("span",{children:"Referrals"}),e.jsx("span",{children:"Pro Converts"})]}),t.map(f=>e.jsxs("div",{className:"admin-referral-row",children:[e.jsx("span",{className:"col-avatar",children:e.jsx("span",{className:"admin-user-avatar",style:{background:f.avatar_color||"#6c5ce7"},children:(f.display_name||"?")[0].toUpperCase()})}),e.jsxs("span",{className:"col-name",children:[e.jsx("strong",{children:f.display_name}),e.jsxs("small",{children:["@",f.username]})]}),e.jsx("span",{className:"referral-code-cell",children:f.referral_code}),e.jsx("span",{className:"referral-count-cell",children:f.referral_count}),e.jsx("span",{className:"referral-pro-cell",children:f.pro_referrals})]},f.user_id))]})]})}function ua(){const{getAuthHeaders:a}=fe(),[t,j]=s.useState([]),[p,E]=s.useState(30),[h,f]=s.useState(""),[o,v]=s.useState(null),[_,C]=s.useState(!1),x=s.useCallback(async()=>{try{const g=await T.get("/api/admin/codes",{headers:a()});j(g.data.codes||[])}catch{}},[a]);s.useEffect(()=>{x()},[x]);const F=async()=>{C(!0),v(null);try{const g=await T.post("/api/admin/codes/create",{days_valid:p,label:h},{headers:a()});v(g.data),f(""),x()}catch{alert("Failed to create code")}C(!1)},q=async g=>{if(confirm(`Revoke code ${g}?`))try{await T.delete(`/api/admin/codes/${g}`,{headers:a()}),x()}catch{alert("Failed to revoke code")}},y=g=>navigator.clipboard.writeText(g),z=t.filter(g=>g.status==="active"),G=t.filter(g=>g.status!=="active");return e.jsxs("div",{className:"admin-tab-content",children:[e.jsx("h3",{children:"Generate New Code"}),e.jsx("div",{className:"create-code-form",children:e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"User/Label"}),e.jsx("input",{type:"text",value:h,onChange:g=>f(g.target.value),placeholder:"e.g. John Discord"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Days Valid"}),e.jsxs("select",{value:p,onChange:g=>E(parseInt(g.target.value)),children:[e.jsx("option",{value:7,children:"7 days"}),e.jsx("option",{value:14,children:"14 days"}),e.jsx("option",{value:30,children:"30 days"}),e.jsx("option",{value:90,children:"90 days"}),e.jsx("option",{value:365,children:"365 days"})]})]}),e.jsx("button",{className:"create-code-btn",onClick:F,disabled:_,children:_?"Creating...":"Generate Code"})]})}),o&&e.jsxs("div",{className:"created-code-display",children:[e.jsx("div",{className:"created-code-value",children:o.code}),e.jsx("button",{className:"copy-btn",onClick:()=>y(o.code),children:"Copy Code"}),e.jsxs("p",{className:"created-code-info",children:["Valid for ",o.days_valid," days (expires ",new Date(o.expires_at).toLocaleDateString(),")"]})]}),e.jsxs("h3",{children:["Active Codes (",z.length,")"]}),e.jsxs("div",{className:"codes-table",children:[e.jsxs("div",{className:"codes-header",children:[e.jsx("span",{children:"Code"}),e.jsx("span",{children:"Label"}),e.jsx("span",{children:"Expires"}),e.jsx("span",{children:"Days Left"}),e.jsx("span",{children:"Uses"}),e.jsx("span",{children:"Actions"})]}),z.map(g=>e.jsxs("div",{className:"code-row active",children:[e.jsx("span",{className:"code-value",children:g.code}),e.jsx("span",{children:g.label||"-"}),e.jsx("span",{children:new Date(g.expires_at).toLocaleDateString()}),e.jsxs("span",{className:"days-remaining",children:[g.days_remaining,"d"]}),e.jsx("span",{children:g.use_count}),e.jsxs("span",{className:"code-actions",children:[e.jsx("button",{className:"copy-small-btn",onClick:()=>y(g.code),children:"Copy"}),e.jsx("button",{className:"revoke-btn",onClick:()=>q(g.code),children:"Revoke"})]})]},g.code)),z.length===0&&e.jsx("div",{className:"no-codes",children:"No active codes."})]}),G.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("h3",{children:["Expired / Revoked (",G.length,")"]}),e.jsxs("div",{className:"codes-table",children:[e.jsxs("div",{className:"codes-header",children:[e.jsx("span",{children:"Code"}),e.jsx("span",{children:"Label"}),e.jsx("span",{children:"Status"}),e.jsx("span",{children:"Expired"}),e.jsx("span",{children:"Uses"}),e.jsx("span",{})]}),G.map(g=>e.jsxs("div",{className:"code-row inactive",children:[e.jsx("span",{className:"code-value",children:g.code}),e.jsx("span",{children:g.label||"-"}),e.jsx("span",{className:`status-badge ${g.status}`,children:g.status}),e.jsx("span",{children:new Date(g.expires_at).toLocaleDateString()}),e.jsx("span",{children:g.use_count}),e.jsx("span",{})]},g.code))]})]})]})}const Re={payment:{label:"Payment",color:"#e74c3c"},subscription:{label:"Subscription",color:"#3498db"},predictions:{label:"Ads / Predictions",color:"#2ecc71"},general:{label:"General",color:"#95a5a6"}},ha=[".jpg",".jpeg",".png",".gif",".webp"];function pa(a){const t=a.match(/^\[FILE:(.+?)\]\((.+?)\)$/);if(!t)return null;const j=t[1],p=t[2],E=j.substring(j.lastIndexOf(".")).toLowerCase(),h=ha.includes(E);return{name:j,url:p,isImage:h}}function xa({promptedAt:a}){const[t,j]=s.useState(180);s.useEffect(()=>{const h=a&&!a.endsWith("Z")&&!a.includes("+")?a+"Z":a,f=new Date(h).getTime(),o=()=>{const _=Math.floor((Date.now()-f)/1e3);j(Math.max(0,180-_))};o();const v=setInterval(o,1e3);return()=>clearInterval(v)},[a]);const p=Math.floor(t/60),E=t%60;return e.jsxs("span",{className:`keepalive-timer ${t<=30?"urgent":""}`,children:[p,":",E.toString().padStart(2,"0")]})}function ga(){const{getAuthHeaders:a,staffRole:t}=fe(),[j,p]=s.useState([]),[E,h]=s.useState(!0),[f,o]=s.useState(null),[v,_]=s.useState([]),[C,x]=s.useState(""),[F,q]=s.useState(!1),[y,z]=s.useState(null),[G,g]=s.useState(!1),[H,I]=s.useState(!1),[N,P]=s.useState([]),[K,U]=s.useState([]),[u,J]=s.useState(!1),[b,c]=s.useState([]),n=s.useRef(null),D=s.useRef(null),k=s.useCallback(r=>{r&&r.scrollIntoView({behavior:"smooth"})},[v]),$=s.useCallback(async()=>{try{const Y=(await T.get("/api/admin/support/conversations",{headers:a()})).data.conversations||[];p(Y),o(se=>se&&(Y.find(l=>l.user_id===se.user_id)||se))}catch{}h(!1)},[a]),ie=s.useCallback(async()=>{try{const r=await T.get("/api/admin/support/keepalive-prompts",{headers:a()});c(r.data.prompts||[])}catch{}},[a]),Z=async(r,Y)=>{try{await T.post(`/api/admin/support/keepalive/${r}?keep_open=${Y}`,{},{headers:a()}),ie(),$()}catch{}};s.useEffect(()=>{$(),ie()},[$,ie]),s.useEffect(()=>{const r=setInterval(()=>{$(),ie()},3e3);return()=>clearInterval(r)},[$,ie]);const w=async r=>{o(r),D.current=r,g(!1),I(!1);try{const Y=await T.get(`/api/admin/support/messages/${r.user_id}`,{headers:a()});_(Y.data.messages||[])}catch{}};s.useEffect(()=>{if(!f)return;const Y=setInterval(async()=>{const se=D.current;if(se)try{const V=await T.get(`/api/admin/support/messages/${se.user_id}`,{headers:a()});_(V.data.messages||[])}catch{}},2e3);return()=>clearInterval(Y)},[f,a]);const B=async r=>{if(r.preventDefault(),!(!C.trim()||!f||F)){q(!0);try{await T.post(`/api/admin/support/send/${f.user_id}`,{content:C.trim()},{headers:a()}),x("");const Y=await T.get(`/api/admin/support/messages/${f.user_id}`,{headers:a()});_(Y.data.messages||[]),$()}catch{}q(!1)}},X=async()=>{if(f&&confirm("End this chat? The user will be prompted to rate the conversation."))try{await T.post(`/api/admin/support/close/${f.user_id}`,{},{headers:a()});const r=await T.get(`/api/admin/support/messages/${f.user_id}`,{headers:a()});_(r.data.messages||[]),$()}catch{alert("Failed to end chat")}},W=async r=>{const Y=r.target.files?.[0];if(!(!Y||!f)){if(r.target.value="",Y.size>10*1024*1024){alert("File too large. Maximum size is 10MB.");return}J(!0);try{const se=new FormData;se.append("file",Y),await T.post(`/api/admin/support/upload/${f.user_id}`,se,{headers:{...a(),"Content-Type":"multipart/form-data"}});const V=await T.get(`/api/admin/support/messages/${f.user_id}`,{headers:a()});_(V.data.messages||[])}catch(se){alert(se.response?.data?.detail||"Failed to upload file")}J(!1)}},ee=async r=>{try{const Y=await T.get(`/api/admin/users/${r}`,{headers:a()});z(Y.data),g(!0)}catch{}},M=async(r,Y)=>{const se=Y==="pro"?"free":"pro";try{await T.post(`/api/admin/users/${r}/set-tier`,{tier:se},{headers:a()}),ee(r)}catch{}},ae=async(r,Y)=>{try{await T.post(`/api/admin/users/${r}/toggle-active`,{is_active:Y?0:1},{headers:a()}),ee(r)}catch{}},A=async()=>{try{const r=await T.get("/api/admin/support/ratings",{headers:a()});P(r.data.ratings||[]),U(r.data.recent||[]),I(!0),o(null)}catch{alert("Unable to load ratings")}},S=r=>{const Y=r&&!r.endsWith("Z")&&!r.includes("+")?r+"Z":r,se=Date.now()-new Date(Y).getTime(),V=Math.floor(se/6e4);if(V<1)return"Now";if(V<60)return`${V}m`;const l=Math.floor(V/60);return l<24?`${l}h`:`${Math.floor(l/24)}d`},m=f&&(f.conv_status==="active"||!f.conv_status);return E?e.jsx("div",{className:"admin-loading",children:"Loading support conversations..."}):e.jsx("div",{className:"admin-tab-content",children:e.jsxs("div",{className:"admin-support-layout",children:[e.jsxs("div",{className:"admin-support-sidebar",children:[e.jsxs("div",{className:"admin-support-sidebar-header",children:[e.jsxs("h3",{children:["Conversations (",j.length,")"]}),e.jsx("button",{className:"admin-support-ratings-btn",onClick:A,title:"View agent ratings",children:"Ratings"})]}),j.length===0?e.jsx("p",{className:"admin-empty-row",children:"No support messages yet."}):j.map(r=>e.jsxs("div",{className:`admin-support-conv-item ${f?.user_id===r.user_id?"active":""} ${r.unread_count>0?"unread":""}`,onClick:()=>w(r),children:[e.jsx("span",{className:"admin-user-avatar-sm",style:{background:r.avatar_color},children:(r.display_name||"?")[0].toUpperCase()}),e.jsxs("div",{className:"admin-support-conv-info",children:[e.jsxs("div",{className:"admin-support-conv-top",children:[e.jsx("strong",{children:r.display_name}),e.jsx("span",{className:"admin-support-conv-time",children:S(r.last_message_at)})]}),e.jsxs("div",{className:"admin-support-conv-meta",children:[r.category&&Re[r.category]&&e.jsx("span",{className:"admin-support-cat-tag",style:{background:Re[r.category].color},children:Re[r.category].label}),r.conv_status==="closed"&&e.jsx("span",{className:"admin-support-status-tag closed",children:"Closed"}),r.assigned_agent_name&&e.jsx("span",{className:"admin-support-agent-tag",children:r.assigned_agent_name}),r.rating&&e.jsxs("span",{className:"admin-support-rating-tag",children:["â˜…".repeat(r.rating),"â˜†".repeat(5-r.rating)]})]}),e.jsxs("p",{className:"admin-support-conv-preview",children:[r.last_sender==="admin"&&e.jsx("span",{className:"admin-support-you",children:"You: "}),r.last_message.length>40?r.last_message.slice(0,40)+"...":r.last_message]})]}),r.unread_count>0&&e.jsx("span",{className:"admin-support-badge",children:r.unread_count})]},r.user_id))]}),e.jsx("div",{className:"admin-support-chat",children:H?e.jsxs("div",{className:"admin-support-ratings",children:[e.jsxs("div",{className:"admin-support-ratings-header",children:[e.jsxs("button",{className:"admin-support-profile-back",onClick:()=>I(!1),children:[e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("polyline",{points:"15 18 9 12 15 6"})}),"Back"]}),e.jsx("h3",{children:"Agent Ratings"})]}),N.length===0?e.jsx("p",{className:"admin-empty-row",children:"No ratings yet."}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"admin-ratings-list",children:[e.jsx("h4",{className:"admin-ratings-section-title",children:"Agent Summary"}),N.map(r=>e.jsxs("div",{className:"admin-rating-item",children:[e.jsxs("div",{className:"admin-rating-item-top",children:[e.jsx("strong",{children:r.agent_name}),e.jsxs("span",{className:"admin-rating-stars",children:["â˜…".repeat(Math.round(r.avg_rating)),"â˜†".repeat(5-Math.round(r.avg_rating))," ",Number(r.avg_rating).toFixed(1),"/5"]})]}),e.jsxs("small",{children:[r.total_ratings," rating",r.total_ratings!==1?"s":""]})]},r.agent_id))]}),K.length>0&&e.jsxs("div",{className:"admin-ratings-list",style:{marginTop:16},children:[e.jsx("h4",{className:"admin-ratings-section-title",children:"Recent Ratings"}),K.map((r,Y)=>e.jsxs("div",{className:"admin-rating-item admin-rating-recent",children:[e.jsxs("div",{className:"admin-rating-item-top",children:[e.jsxs("span",{children:[e.jsx("strong",{children:r.display_name}),e.jsxs("span",{className:"admin-rating-username",children:[" @",r.username]})]}),e.jsxs("span",{className:"admin-rating-stars",children:["â˜…".repeat(r.rating),"â˜†".repeat(5-r.rating)]})]}),e.jsxs("div",{className:"admin-rating-item-meta",children:[e.jsxs("span",{children:["Agent: ",r.agent_name]}),e.jsx("span",{children:S(r.created_at)})]}),r.comment&&e.jsx("p",{className:"admin-rating-comment",children:r.comment})]},Y))]})]})]}):f?G&&y?e.jsx(us,{userProfile:y,onBack:()=>g(!1),onTierChange:M,onToggleActive:ae,staffRole:t,getAuthHeaders:a,onRefresh:ee}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"admin-support-chat-header",children:[e.jsx("span",{className:"admin-user-avatar-sm",style:{background:f.avatar_color},children:(f.display_name||"?")[0].toUpperCase()}),e.jsxs("div",{children:[e.jsx("strong",{children:f.display_name}),e.jsxs("small",{children:["@",f.username]})]}),f.category&&Re[f.category]&&e.jsx("span",{className:"admin-support-cat-tag",style:{background:Re[f.category].color,marginLeft:8},children:Re[f.category].label}),f.conv_status==="closed"&&e.jsx("span",{className:"admin-support-status-tag closed",style:{marginLeft:8},children:"Closed"}),e.jsxs("div",{className:"admin-support-header-actions",children:[e.jsx("button",{className:"admin-support-view-profile",onClick:()=>ee(f.user_id),children:"View Profile"}),m&&e.jsx("button",{className:"admin-support-end-chat",onClick:X,children:"End Chat"})]})]}),b.length>0&&e.jsx("div",{className:"keepalive-banner-container",children:b.map(r=>e.jsxs("div",{className:"keepalive-banner",children:[e.jsx("div",{className:"keepalive-banner-icon",children:"â°"}),e.jsxs("div",{className:"keepalive-banner-text",children:[e.jsx("strong",{children:"Chat idle for 30 minutes"}),e.jsxs("span",{children:["Chat with ",r.display_name," (@",r.username,") â€” Keep open?"]})]}),e.jsxs("div",{className:"keepalive-banner-actions",children:[e.jsx("button",{className:"keepalive-keep-btn",onClick:()=>Z(r.conversation_id,!0),children:"Keep Open"}),e.jsx("button",{className:"keepalive-close-btn",onClick:()=>Z(r.conversation_id,!1),children:"End Chat"})]}),e.jsx(xa,{promptedAt:r.prompted_at})]},r.id))}),e.jsxs("div",{className:"admin-support-chat-messages",children:[v.map((r,Y)=>e.jsxs("div",{className:`admin-support-bubble ${r.sender}`,children:[r.sender==="admin"&&r.agent_name&&(Y===0||v[Y-1]?.sender!=="admin"||v[Y-1]?.agent_name!==r.agent_name)&&e.jsxs("span",{className:"admin-support-agent-label",children:["Agent: ",r.agent_name]}),Y===0&&r.category&&Re[r.category]&&e.jsx("span",{className:"admin-support-cat-tag",style:{background:Re[r.category].color},children:Re[r.category].label}),(()=>{const se=pa(r.content);return se?se.isImage?e.jsxs("a",{href:se.url,target:"_blank",rel:"noopener noreferrer",className:"support-file-link",children:[e.jsx("img",{src:se.url,alt:se.name,className:"support-file-image"}),e.jsx("span",{className:"support-file-name",children:se.name})]}):e.jsxs("a",{href:se.url,target:"_blank",rel:"noopener noreferrer",className:"support-file-link",children:[e.jsx("span",{className:"support-file-icon",children:"ðŸ“Ž"}),e.jsx("span",{className:"support-file-name",children:se.name})]}):e.jsx("p",{children:r.content})})(),e.jsx("span",{className:"admin-support-bubble-time",children:S(r.created_at)})]},r.id)),e.jsx("div",{ref:k})]}),m?e.jsxs("form",{className:"admin-support-chat-input",onSubmit:B,children:[e.jsx("input",{type:"file",ref:n,style:{display:"none"},onChange:W,accept:".jpg,.jpeg,.png,.gif,.webp,.pdf,.doc,.docx,.txt,.csv,.xls,.xlsx"}),e.jsx("button",{type:"button",className:"support-attach-btn",onClick:()=>n.current?.click(),disabled:u,title:"Attach file",children:u?"...":"ðŸ“Ž"}),e.jsx("textarea",{value:C,onChange:r=>{x(r.target.value),r.target.style.height="auto",r.target.style.height=Math.min(r.target.scrollHeight,120)+"px"},onKeyDown:r=>{r.key==="Enter"&&!r.shiftKey&&(r.preventDefault(),C.trim()&&!F&&B(r))},placeholder:"Type a reply...",maxLength:2e3,rows:1}),e.jsx("button",{type:"submit",disabled:!C.trim()||F,children:"Send"})]}):e.jsx("div",{className:"admin-support-chat-closed-bar",children:"This conversation has been closed."})]}):e.jsx("div",{className:"admin-support-chat-empty",children:e.jsx("p",{children:"Select a conversation to start replying"})})})]})})}const js={owner:"#e74c3c",general_manager:"#e67e22",sales_hod:"#2ecc71",customer_care_hod:"#3498db",marketing_hod:"#9b59b6",predictions_hod:"#1abc9c",sales_agent:"#27ae60",customer_support_agent:"#2980b9",prediction_analyst:"#16a085",technical_hod:"#e84393",technical_support_agent:"#d63031",super_admin:"#e74c3c",customer_care:"#3498db",technical_support:"#9b59b6",accounting:"#e67e22"},Je={dashboard:"Dashboard",users:"Users",employees:"Employees",sales:"Sales",predictions:"Predictions",support:"Support",activity_logs:"Activity Logs",security:"Security",settings:"Settings",community:"Community",referrals:"Referrals",access_codes:"Access Codes",withdrawals:"Withdrawals",subscriptions:"Subscriptions",online_users:"Online Users",finance:"Finance",technical:"Technical",bots:"Bots"},Qe=["read","write","edit","delete","export","approve"];function ba(){const{getAuthHeaders:a,hasPermission:t}=fe();t("employees","write");const j=t("employees","edit");t("employees","delete");const[p,E]=s.useState([]),[h,f]=s.useState(!0),[o,v]=s.useState(""),[_,C]=s.useState([]),[x,F]=s.useState(!1),[q,y]=s.useState(null),[z,G]=s.useState(""),[g,H]=s.useState(!1),[I,N]=s.useState(""),[P,K]=s.useState(""),[U,u]=s.useState(""),[J,b]=s.useState("customer_support_agent"),[c,n]=s.useState(!1),[D,k]=s.useState(""),[$,ie]=s.useState(""),[Z,w]=s.useState(null),[B,X]=s.useState(null),[W,ee]=s.useState({}),[M,ae]=s.useState(!1),[A,S]=s.useState(""),m=s.useCallback(async()=>{try{const R=await T.get("/api/admin/staff",{headers:a()});E(R.data.staff||[])}catch{}f(!1)},[a]);s.useEffect(()=>{m()},[m]),s.useEffect(()=>{(async()=>{try{const le=await T.get("/api/admin/roles/permissions",{headers:a()});w(le.data)}catch{}})()},[a]);const r=async()=>{if(o.trim()){F(!0);try{const le=(await T.get("/api/admin/users",{headers:a()})).data.users||[],me=o.toLowerCase();C(le.filter(de=>(de.email||"").toLowerCase().includes(me)||(de.username||"").toLowerCase().includes(me)||(de.display_name||"").toLowerCase().includes(me)).slice(0,10))}catch{}F(!1)}},Y=async()=>{if(q)try{await T.post(`/api/admin/staff/${q.id}/set-role`,{role:z||null},{headers:a()}),y(null),G(""),C([]),v(""),m()}catch(R){alert(R.response?.data?.detail||"Failed to update role")}},se=async R=>{if(confirm("Remove this staff member's role?"))try{await T.post(`/api/admin/staff/${R}/set-role`,{role:null},{headers:a()}),m()}catch{alert("Failed to remove role")}},V=async R=>{if(R.preventDefault(),k(""),ie(""),!I.trim()||!P||!U.trim()){k("All fields are required");return}n(!0);try{const le=await T.post("/api/admin/staff/create",{email:I.trim(),password:P,display_name:U.trim(),role:J},{headers:a()});le.data.success&&(ie(`Staff account created for ${le.data.user.display_name} (@${le.data.user.username})`),N(""),K(""),u(""),b("customer_support_agent"),m(),setTimeout(()=>ie(""),5e3))}catch(le){k(le.response?.data?.detail||"Failed to create staff account")}n(!1)},l=async R=>{try{const le=await T.get(`/api/admin/staff/${R.id}/permissions`,{headers:a()}),{role:me,role_permissions:de,custom_overrides:ue,effective:he}=le.data;X({user:R,role:me,rolePerms:de,customOverrides:ue,effective:he}),ee(JSON.parse(JSON.stringify(ue||{}))),S("")}catch(le){alert(le.response?.data?.detail||"Failed to load permissions")}},re=(R,le)=>{ee(me=>{const de={...me};de[R]?de[R]={...de[R]}:de[R]={can_read:-1,can_write:-1,can_edit:-1,can_delete:-1,can_export:-1,can_approve:-1};const ue=de[R][le]??-1;return ue===-1?de[R][le]=1:ue===1?de[R][le]=0:de[R][le]=-1,de})},Se=async()=>{if(B){ae(!0),S("");try{await T.post(`/api/admin/staff/${B.user.id}/permissions`,{permissions:W},{headers:a()}),S("Permissions saved successfully!");const R=await T.get(`/api/admin/staff/${B.user.id}/permissions`,{headers:a()}),{role:le,role_permissions:me,custom_overrides:de,effective:ue}=R.data;X(he=>({...he,role:le,rolePerms:me,customOverrides:de,effective:ue})),ee(JSON.parse(JSON.stringify(de||{}))),setTimeout(()=>S(""),3e3)}catch(R){S(R.response?.data?.detail||"Failed to save permissions")}ae(!1)}},ve=async()=>{if(B&&confirm("Reset all custom permissions to role defaults?")){ae(!0),S("");try{await T.post(`/api/admin/staff/${B.user.id}/reset-permissions`,{},{headers:a()}),S("Permissions reset to role defaults!"),ee({});const R=await T.get(`/api/admin/staff/${B.user.id}/permissions`,{headers:a()}),{role:le,role_permissions:me,custom_overrides:de,effective:ue}=R.data;X(he=>({...he,role:le,rolePerms:me,customOverrides:de,effective:ue})),setTimeout(()=>S(""),3e3)}catch(R){S(R.response?.data?.detail||"Failed to reset permissions")}ae(!1)}},Ce=(R,le)=>{if(!B?.rolePerms)return 0;const me=B.rolePerms[R];return me&&me[le]||0},Ae=(R,le)=>W[R]?.[le]??-1,ke=R=>R.role_display_name?R.role_display_name:{super_admin:"Super Admin",customer_care:"Customer Care",technical_support:"Technical Support",accounting:"Accounting"}[R.staff_role]||R.staff_role||"Unknown",ye=R=>js[R.role_name||R.staff_role]||"#636e72",Te=R=>{if(!Z||!Z[R])return null;const le=Z[R],me=le.permissions||{},de=Object.keys(me);return de.length===0?e.jsx("p",{className:"perm-preview-empty",children:"No permissions defined for this role."}):e.jsxs("div",{className:"perm-preview",children:[e.jsx("p",{className:"perm-preview-desc",children:le.description}),e.jsxs("div",{className:"perm-preview-grid",children:[e.jsxs("div",{className:"perm-preview-header",children:[e.jsx("span",{className:"perm-preview-module-label",children:"Module"}),Qe.map(ue=>e.jsx("span",{className:"perm-preview-action-label",children:ue.charAt(0).toUpperCase()},ue))]}),de.map(ue=>e.jsxs("div",{className:"perm-preview-row",children:[e.jsx("span",{className:"perm-preview-module-label",children:Je[ue]||ue}),Qe.map(he=>{const L=me[ue]?.[he]||0;return e.jsx("span",{className:`perm-preview-cell ${L?"granted":"denied"}`,children:L?"âœ“":"âœ•"},he)})]},ue))]})]})},$e=()=>{let R=0;for(const le of Object.keys(W))for(const me of Object.values(W[le]||{}))me!==-1&&R++;return R};return h?e.jsx("div",{className:"admin-loading",children:"Loading staff..."}):e.jsxs("div",{className:"admin-tab-content",children:[e.jsxs("div",{className:"admin-staff-section-header",children:[e.jsx("h3",{children:"Create Staff Account"}),e.jsx("button",{className:`admin-action-btn ${g?"suspend":"upgrade"}`,onClick:()=>{H(!g),k(""),ie("")},children:g?"Cancel":"+ New Account"})]}),g&&e.jsxs("div",{className:"admin-create-staff-form",children:[D&&e.jsx("div",{className:"admin-create-staff-error",children:D}),$&&e.jsx("div",{className:"admin-create-staff-success",children:$}),e.jsxs("form",{onSubmit:V,children:[e.jsxs("div",{className:"admin-create-staff-grid",children:[e.jsxs("div",{className:"admin-create-staff-field",children:[e.jsx("label",{children:"Full Name"}),e.jsx("input",{type:"text",value:U,onChange:R=>u(R.target.value),placeholder:"e.g. John Smith",maxLength:100,required:!0})]}),e.jsxs("div",{className:"admin-create-staff-field",children:[e.jsx("label",{children:"Email"}),e.jsx("input",{type:"email",value:I,onChange:R=>N(R.target.value),placeholder:"staff@example.com",required:!0})]}),e.jsxs("div",{className:"admin-create-staff-field",children:[e.jsx("label",{children:"Password"}),e.jsx("input",{type:"text",value:P,onChange:R=>K(R.target.value),placeholder:"Min 6 characters",minLength:6,required:!0})]}),e.jsxs("div",{className:"admin-create-staff-field",children:[e.jsx("label",{children:"Role"}),e.jsxs("select",{value:J,onChange:R=>b(R.target.value),children:[e.jsxs("optgroup",{label:"Management",children:[e.jsx("option",{value:"owner",children:"Owner"}),e.jsx("option",{value:"general_manager",children:"General Manager"})]}),e.jsxs("optgroup",{label:"Heads of Department",children:[e.jsx("option",{value:"sales_hod",children:"Sales HOD"}),e.jsx("option",{value:"customer_care_hod",children:"Customer Care HOD"}),e.jsx("option",{value:"marketing_hod",children:"Marketing HOD"}),e.jsx("option",{value:"predictions_hod",children:"Predictions HOD"}),e.jsx("option",{value:"technical_hod",children:"Technical HOD"})]}),e.jsxs("optgroup",{label:"Agents",children:[e.jsx("option",{value:"customer_support_agent",children:"Customer Support Agent"}),e.jsx("option",{value:"sales_agent",children:"Sales Agent"}),e.jsx("option",{value:"prediction_analyst",children:"Prediction Analyst"}),e.jsx("option",{value:"technical_support_agent",children:"Technical Support Agent"})]})]})]})]}),e.jsx("p",{className:"admin-create-staff-note",children:"Staff accounts bypass email verification and access codes. The staff member can log in immediately and will be redirected to the Employee Portal based on their assigned role."}),e.jsx("button",{type:"submit",className:"admin-create-staff-submit",disabled:c,children:c?"Creating...":"Create Staff Account"})]})]}),e.jsx("h3",{style:{marginTop:24},children:"Assign Role to Existing User"}),e.jsxs("div",{className:"admin-staff-search",children:[e.jsxs("div",{className:"admin-staff-search-row",children:[e.jsx("input",{type:"text",value:o,onChange:R=>v(R.target.value),onKeyDown:R=>R.key==="Enter"&&r(),placeholder:"Search by email, username, or name...",className:"admin-search-input"}),e.jsx("button",{className:"admin-action-btn upgrade",onClick:r,disabled:x,children:x?"Searching...":"Search"})]}),_.length>0&&e.jsx("div",{className:"admin-staff-search-results",children:_.map(R=>e.jsxs("div",{className:"admin-staff-search-item",children:[e.jsx("span",{className:"admin-user-avatar-sm",style:{background:R.avatar_color||"#6c5ce7"},children:(R.display_name||"?")[0].toUpperCase()}),e.jsxs("div",{className:"admin-staff-search-info",children:[e.jsx("strong",{children:R.display_name||"No Name"}),e.jsx("small",{children:R.email})]}),R.staff_role?e.jsx("span",{className:"admin-staff-role-tag",style:{background:ye(R)},children:ke(R)}):e.jsx("button",{className:"admin-action-btn upgrade",onClick:()=>{y(R),G("customer_support_agent")},children:"Assign Role"})]},R.id))})]}),e.jsxs("h3",{style:{marginTop:24},children:["Current Staff (",p.length,")"]}),p.length===0?e.jsx("p",{className:"admin-empty-row",children:"No staff members assigned yet."}):e.jsx("div",{className:"admin-staff-list",children:p.map(R=>e.jsxs("div",{className:"admin-staff-item",children:[e.jsx("span",{className:"admin-user-avatar-sm",style:{background:R.avatar_color||"#6c5ce7"},children:(R.display_name||"?")[0].toUpperCase()}),e.jsxs("div",{className:"admin-staff-item-info",children:[e.jsx("strong",{children:R.display_name||"No Name"}),e.jsxs("small",{children:["@",R.username," Â· ",R.email]})]}),e.jsx("span",{className:"admin-staff-role-tag",style:{background:ye(R)},children:ke(R)}),e.jsx("button",{className:"admin-action-btn suspend",onClick:()=>se(R.id),children:"Remove"}),e.jsx("button",{className:"admin-action-btn reset-pw",onClick:()=>{y(R),G(R.role_name||R.staff_role||"customer_support_agent")},children:"Change Role"}),j&&e.jsx("button",{className:"admin-action-btn upgrade",onClick:()=>l(R),children:"Permissions"})]},R.id))}),q&&e.jsx("div",{className:"admin-modal-overlay",onClick:()=>y(null),children:e.jsxs("div",{className:"admin-modal perm-assign-modal",onClick:R=>R.stopPropagation(),children:[e.jsx("h3",{children:"Assign Role"}),e.jsxs("p",{className:"admin-modal-user",children:[q.display_name||q.username," (",q.email,")"]}),e.jsxs("select",{value:z,onChange:R=>G(R.target.value),className:"admin-modal-input",children:[e.jsxs("optgroup",{label:"Management",children:[e.jsx("option",{value:"owner",children:"Owner"}),e.jsx("option",{value:"general_manager",children:"General Manager"})]}),e.jsxs("optgroup",{label:"Heads of Department",children:[e.jsx("option",{value:"sales_hod",children:"Sales HOD"}),e.jsx("option",{value:"customer_care_hod",children:"Customer Care HOD"}),e.jsx("option",{value:"marketing_hod",children:"Marketing HOD"}),e.jsx("option",{value:"predictions_hod",children:"Predictions HOD"}),e.jsx("option",{value:"technical_hod",children:"Technical HOD"})]}),e.jsxs("optgroup",{label:"Agents",children:[e.jsx("option",{value:"customer_support_agent",children:"Customer Support Agent"}),e.jsx("option",{value:"sales_agent",children:"Sales Agent"}),e.jsx("option",{value:"prediction_analyst",children:"Prediction Analyst"}),e.jsx("option",{value:"technical_support_agent",children:"Technical Support Agent"})]})]}),z&&Te(z),e.jsxs("div",{className:"admin-modal-actions",children:[e.jsx("button",{className:"admin-modal-cancel",onClick:()=>y(null),children:"Cancel"}),e.jsx("button",{className:"admin-modal-confirm",onClick:Y,children:"Assign"})]})]})}),B&&e.jsx("div",{className:"admin-modal-overlay",onClick:()=>X(null),children:e.jsxs("div",{className:"admin-modal perm-editor-modal",onClick:R=>R.stopPropagation(),children:[e.jsxs("div",{className:"perm-editor-header",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Custom Permissions"}),e.jsxs("p",{className:"perm-editor-user",children:[B.user.display_name||B.user.username,B.role&&e.jsx("span",{className:"admin-staff-role-tag",style:{background:js[B.role.name]||"#636e72",marginLeft:8},children:B.role.display_name})]})]}),e.jsx("button",{className:"perm-editor-close",onClick:()=>X(null),children:"Ã—"})]}),e.jsxs("div",{className:"perm-editor-legend",children:[e.jsxs("span",{className:"perm-legend-item",children:[e.jsx("span",{className:"perm-cell-demo inherited",children:"-"})," Inherited"]}),e.jsxs("span",{className:"perm-legend-item",children:[e.jsx("span",{className:"perm-cell-demo granted",children:"âœ“"})," Granted"]}),e.jsxs("span",{className:"perm-legend-item",children:[e.jsx("span",{className:"perm-cell-demo denied",children:"âœ•"})," Denied"]}),e.jsxs("span",{className:"perm-editor-overrides-count",children:[$e()," custom override",$e()!==1?"s":""]})]}),e.jsx("div",{className:"perm-editor-grid-wrap",children:e.jsxs("div",{className:"perm-editor-grid",children:[e.jsxs("div",{className:"perm-editor-grid-header",children:[e.jsx("span",{className:"perm-editor-module-col",children:"Module"}),Qe.map(R=>e.jsx("span",{className:"perm-editor-action-col",children:R.charAt(0).toUpperCase()+R.slice(1)},R))]}),Object.keys(Je).map(R=>e.jsxs("div",{className:"perm-editor-grid-row",children:[e.jsx("span",{className:"perm-editor-module-col",children:Je[R]}),Qe.map(le=>{const me=`can_${le}`,de=Ae(R,me),ue=Ce(R,le);let he="perm-editor-cell",L="";return de===1?(he+=" granted",L="âœ“"):de===0?(he+=" denied",L="âœ•"):(he+=" inherited",L=ue?"âœ“":"âœ•"),e.jsx("button",{className:he,onClick:()=>re(R,me),title:`${Je[R]} - ${le}: ${de===-1?"Inherited ("+(ue?"allowed":"denied")+")":de===1?"Granted (override)":"Denied (override)"}
Click to cycle`,children:L},le)})]},R))]})}),A&&e.jsx("div",{className:`perm-editor-msg ${A.includes("success")||A.includes("reset")?"success":"error"}`,children:A}),e.jsxs("div",{className:"perm-editor-actions",children:[e.jsx("button",{className:"admin-action-btn suspend",onClick:ve,disabled:M,children:"Reset to Defaults"}),e.jsx("div",{style:{flex:1}}),e.jsx("button",{className:"admin-modal-cancel",onClick:()=>X(null),children:"Cancel"}),e.jsx("button",{className:"admin-modal-confirm",onClick:Se,disabled:M,children:M?"Saving...":"Save Permissions"})]})]})})]})}const is="/api",ja=1e4,fa={read:"#2ecc71",create:"#3498db",edit:"#f1c40f",update:"#f1c40f",delete:"#e74c3c",login:"#9b59b6",logout:"#95a5a6",export:"#1abc9c"},va=[{value:"",label:"All Actions"},{value:"read",label:"Read"},{value:"create",label:"Create"},{value:"edit",label:"Edit"},{value:"update",label:"Update"},{value:"delete",label:"Delete"},{value:"login",label:"Login"},{value:"logout",label:"Logout"},{value:"export",label:"Export"}],ya=[{value:"",label:"All Modules"},{value:"dashboard",label:"Dashboard"},{value:"users",label:"Users"},{value:"subscriptions",label:"Subscriptions"},{value:"withdrawals",label:"Withdrawals"},{value:"community",label:"Community"},{value:"referrals",label:"Referrals"},{value:"access_codes",label:"Access Codes"},{value:"support",label:"Support"},{value:"employees",label:"Employees"},{value:"security",label:"Security"},{value:"predictions",label:"Predictions"},{value:"sales",label:"Sales"},{value:"settings",label:"Settings"}];function Na(a){return a?new Date(a).toLocaleString():"â€”"}function Ze(a){if(!a)return"#95a5a6";const t=a.toLowerCase();for(const[j,p]of Object.entries(fa))if(t.includes(j))return p;return"#95a5a6"}function _a(a){return a?a.split(" ").map(t=>t[0]).join("").toUpperCase().slice(0,2):"?"}function Sa(){const{getAuthHeaders:a,hasPermission:t}=fe(),[j,p]=s.useState(""),[E,h]=s.useState(""),[f,o]=s.useState(""),[v,_]=s.useState(""),[C,x]=s.useState(""),[F,q]=s.useState([]),[y,z]=s.useState(null),[G,g]=s.useState(!0),[H,I]=s.useState(null),[N,P]=s.useState(1),[K,U]=s.useState(1),[u,J]=s.useState(0),[b]=s.useState(25),[c,n]=s.useState(null),[D,k]=s.useState(!0),[$,ie]=s.useState(!1),Z=s.useRef(null),w=s.useCallback(async(M=!0)=>{try{M&&g(!0),I(null);const ae=new URLSearchParams;f&&ae.append("action",f),v&&ae.append("module",v),C&&ae.append("user_id",C),j&&ae.append("from_date",j),E&&ae.append("to_date",E),ae.append("page",N.toString()),ae.append("per_page",b.toString());const A=await fetch(`${is}/admin/activity-logs?${ae}`,{headers:a()});if(!A.ok)throw new Error(`Failed to fetch logs: ${A.status}`);const S=await A.json();q(S.logs||S.items||S.data||[]),U(S.total_pages||S.pages||Math.ceil((S.total||0)/b)||1),J(S.total||S.total_count||0)}catch(ae){I(ae.message)}finally{g(!1)}},[a,f,v,C,j,E,N,b]),B=s.useCallback(async()=>{try{const M=await fetch(`${is}/admin/activity-stats?days=7`,{headers:a()});if(M.ok){const ae=await M.json();z(ae)}}catch(M){console.error("Failed to fetch activity stats:",M)}},[a]);s.useEffect(()=>{w(!0)},[w]),s.useEffect(()=>{B()},[B]),s.useEffect(()=>(D&&(Z.current=setInterval(()=>{w(!1)},ja)),()=>{Z.current&&clearInterval(Z.current)}),[D,w]);const X=async()=>{if(t("activity_logs","export"))try{ie(!0);const M=new URLSearchParams;f&&M.append("action",f),v&&M.append("module",v),C&&M.append("user_id",C),j&&M.append("from_date",j),E&&M.append("to_date",E),M.append("page","1"),M.append("per_page","10000");const ae=await fetch(`${is}/admin/activity-logs?${M}`,{headers:a()});if(!ae.ok)throw new Error("Failed to fetch logs for export");const A=await ae.json(),S=A.logs||A.items||A.data||[];if(S.length===0){alert("No logs to export.");return}const m=["Timestamp","User","Action","Module","Target","IP Address","Details"],r=S.map(re=>[re.timestamp||re.created_at||"",re.user_name||re.user||"",re.action||"",re.module||"",re.target||re.resource||"",re.ip_address||re.ip||"",re.details||""]),Y=[m,...r].map(re=>re.map(Se=>`"${String(Se).replace(/"/g,'""')}"`).join(",")).join(`
`),se=new Blob([Y],{type:"text/csv"}),V=URL.createObjectURL(se),l=document.createElement("a");l.href=V,l.download=`activity-logs-${new Date().toISOString().split("T")[0]}.csv`,l.click(),URL.revokeObjectURL(V)}catch(M){alert("Export failed: "+M.message)}finally{ie(!1)}},W=()=>{p(""),h(""),o(""),_(""),x(""),P(1)},ee=M=>{n(ae=>ae===M?null:M)};return e.jsxs("div",{className:"admin-tab-content",children:[e.jsxs("div",{className:"admin-tab-header",children:[e.jsx("h2",{children:"Activity Logs"}),e.jsxs("div",{className:"admin-tab-header-actions",children:[e.jsxs("label",{className:"admin-toggle-label",children:[e.jsx("input",{type:"checkbox",checked:D,onChange:M=>k(M.target.checked)}),"Auto-refresh"]}),t("activity_logs","export")&&e.jsx("button",{className:"admin-btn admin-btn-secondary",onClick:X,disabled:$,children:$?"Exporting...":"Export CSV"})]})]}),e.jsxs("div",{className:"admin-stats-grid",children:[e.jsx(Q,{label:"Total Actions",value:y?.total_actions??u,icon:"ðŸ“Š",color:"#3498db"}),e.jsx(Q,{label:"Actions Today",value:y?.actions_today??"â€”",icon:"ðŸ“…",color:"#2ecc71"}),e.jsx(Q,{label:"Failed Logins (7d)",value:y?.failed_logins_7d??y?.failed_logins??"â€”",icon:"ðŸš«",color:"#e74c3c"}),e.jsx(Q,{label:"Active Staff",value:y?.active_staff??y?.unique_users??"â€”",icon:"ðŸ‘¥",color:"#9b59b6"})]}),e.jsxs("div",{className:"admin-filter-bar",children:[e.jsxs("div",{className:"admin-filter-group",children:[e.jsx("label",{children:"From"}),e.jsx("input",{type:"date",className:"admin-input",value:j,onChange:M=>{p(M.target.value),P(1)}})]}),e.jsxs("div",{className:"admin-filter-group",children:[e.jsx("label",{children:"To"}),e.jsx("input",{type:"date",className:"admin-input",value:E,onChange:M=>{h(M.target.value),P(1)}})]}),e.jsxs("div",{className:"admin-filter-group",children:[e.jsx("label",{children:"Action"}),e.jsx("select",{className:"admin-select",value:f,onChange:M=>{o(M.target.value),P(1)},children:va.map(M=>e.jsx("option",{value:M.value,children:M.label},M.value))})]}),e.jsxs("div",{className:"admin-filter-group",children:[e.jsx("label",{children:"Module"}),e.jsx("select",{className:"admin-select",value:v,onChange:M=>{_(M.target.value),P(1)},children:ya.map(M=>e.jsx("option",{value:M.value,children:M.label},M.value))})]}),e.jsxs("div",{className:"admin-filter-group",children:[e.jsx("label",{children:"User"}),e.jsx("input",{type:"text",className:"admin-input",placeholder:"Search user...",value:C,onChange:M=>{x(M.target.value),P(1)}})]}),e.jsx("div",{className:"admin-filter-group admin-filter-actions",children:e.jsx("button",{className:"admin-btn admin-btn-ghost",onClick:W,children:"Clear Filters"})})]}),H&&e.jsxs("div",{className:"admin-error-banner",children:[e.jsx("span",{children:H}),e.jsx("button",{className:"admin-btn admin-btn-sm",onClick:()=>w(!0),children:"Retry"})]}),G?e.jsxs("div",{className:"admin-loading-section",children:[e.jsx("div",{className:"admin-loading-spinner"}),e.jsx("p",{children:"Loading activity logs..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"admin-table-wrapper",children:e.jsxs("table",{className:"admin-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Timestamp"}),e.jsx("th",{children:"User"}),e.jsx("th",{children:"Action"}),e.jsx("th",{children:"Module"}),e.jsx("th",{children:"Target"}),e.jsx("th",{children:"IP Address"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:F.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"admin-table-empty",children:"No activity logs found."})}):F.map((M,ae)=>{const A=M.id||ae,S=c===A;return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:"admin-table-row-clickable",onClick:()=>ee(A),children:[e.jsx("td",{className:"admin-td-timestamp",children:Na(M.timestamp||M.created_at)}),e.jsx("td",{children:e.jsxs("div",{className:"admin-user-cell",children:[e.jsx("div",{className:"admin-avatar-sm",style:{background:Ze(M.action)},children:_a(M.user_name||M.user)}),e.jsx("span",{children:M.user_name||M.user||"System"})]})}),e.jsx("td",{children:e.jsx("span",{className:"admin-badge",style:{background:Ze(M.action)+"22",color:Ze(M.action),border:`1px solid ${Ze(M.action)}44`},children:M.action||"â€”"})}),e.jsx("td",{children:M.module||"â€”"}),e.jsx("td",{className:"admin-td-target",children:M.target||M.resource||"â€”"}),e.jsx("td",{className:"admin-td-ip",children:M.ip_address||M.ip||"â€”"}),e.jsx("td",{children:e.jsx("span",{className:"admin-expand-icon",children:S?"â–²":"â–¼"})})]},A),S&&e.jsx("tr",{className:"admin-expanded-row",children:e.jsx("td",{colSpan:7,children:e.jsx("div",{className:"admin-expanded-details",children:e.jsxs("div",{className:"admin-detail-grid",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Full Timestamp:"})," ",M.timestamp||M.created_at||"â€”"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"User ID:"})," ",M.user_id||"â€”"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Device:"})," ",M.device||M.user_agent||"â€”"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Status:"})," ",M.status||"success"]}),M.details&&e.jsxs("div",{className:"admin-detail-full",children:[e.jsx("strong",{children:"Details:"}),e.jsx("pre",{className:"admin-detail-pre",children:typeof M.details=="string"?M.details:JSON.stringify(M.details,null,2)})]}),M.changes&&e.jsxs("div",{className:"admin-detail-full",children:[e.jsx("strong",{children:"Changes:"}),e.jsx("pre",{className:"admin-detail-pre",children:typeof M.changes=="string"?M.changes:JSON.stringify(M.changes,null,2)})]})]})})})},`${A}-details`)]})})})]})}),e.jsxs("div",{className:"admin-pagination",children:[e.jsxs("span",{className:"admin-pagination-info",children:["Page ",N," of ",K," (",u," total entries)"]}),e.jsxs("div",{className:"admin-pagination-controls",children:[e.jsx("button",{className:"admin-btn admin-btn-sm",disabled:N<=1,onClick:()=>P(1),children:"First"}),e.jsx("button",{className:"admin-btn admin-btn-sm",disabled:N<=1,onClick:()=>P(M=>Math.max(1,M-1)),children:"Prev"}),e.jsx("button",{className:"admin-btn admin-btn-sm",disabled:N>=K,onClick:()=>P(M=>Math.min(K,M+1)),children:"Next"}),e.jsx("button",{className:"admin-btn admin-btn-sm",disabled:N>=K,onClick:()=>P(K),children:"Last"})]})]})]})]})}const rs="/api",wa=5e3;function ka(a){if(!a&&a!==0)return"â€”";const t=Math.floor(a/3600),j=Math.floor(a%3600/60);return t>0?`${t}h ${j}m`:`${j}m`}function Xe(a){return a?new Date(a).toLocaleString():"â€”"}function Ca(a){if(!a)return"â€”";const t=Date.now()-new Date(a).getTime(),j=Math.floor(t/6e4);if(j<1)return"Just now";if(j<60)return`${j}m ago`;const p=Math.floor(j/60);return p<24?`${p}h ago`:`${Math.floor(p/24)}d ago`}function ls(a){return a?a.split(" ").map(t=>t[0]).join("").toUpperCase().slice(0,2):"?"}const Ie={owner:"#e74c3c",general_manager:"#3498db",sales_hod:"#2ecc71",customer_care_hod:"#e67e22",marketing_hod:"#9b59b6",predictions_hod:"#1abc9c",sales_agent:"#27ae60",customer_support_agent:"#f39c12",prediction_analyst:"#16a085"};function Aa(){const{getAuthHeaders:a,hasPermission:t,authMode:j}=fe(),[p,E]=s.useState([]),[h,f]=s.useState([]),[o,v]=s.useState(null),[_,C]=s.useState([]),[x,F]=s.useState(!0),[q,y]=s.useState(!1),[z,G]=s.useState(null),[g,H]=s.useState(null),[I,N]=s.useState("sessions"),P=s.useRef(null),K=j==="password",U=s.useCallback(async(n=!0)=>{try{n&&F(!0),G(null);const D=await fetch(`${rs}/admin/staff/sessions`,{headers:a()});if(!D.ok)throw new Error(`Failed to fetch sessions: ${D.status}`);const k=await D.json();E(k.sessions||k||[]),k.login_history&&f(k.login_history)}catch(D){G(D.message)}finally{F(!1)}},[a]),u=s.useCallback(async n=>{try{y(!0);const D=await fetch(`${rs}/admin/staff/${n}/login-history`,{headers:a()});if(!D.ok)throw new Error(`Failed to fetch login history: ${D.status}`);const k=await D.json();C(k.history||k.logins||k||[]),v(n)}catch(D){alert("Failed to load login history: "+D.message)}finally{y(!1)}},[a]),J=s.useCallback(async n=>{if(confirm("Are you sure you want to force logout this user?"))try{H(n);const D=await fetch(`${rs}/admin/staff/${n}/terminate-session`,{method:"POST",headers:a()});if(!D.ok)throw new Error(`Failed to terminate session: ${D.status}`);await U(!1)}catch(D){alert("Failed to terminate session: "+D.message)}finally{H(null)}},[a,U]);s.useEffect(()=>{U(!0)},[U]),s.useEffect(()=>(P.current=setInterval(()=>{U(!1)},wa),()=>{P.current&&clearInterval(P.current)}),[U]);const b=h.filter(n=>n.success===!1||n.status==="failed"),c=p.filter(n=>n.password_expired||n.password_expiry_status==="expired");return!K&&!t("security","read")?e.jsx("div",{className:"admin-tab-content",children:e.jsxs("div",{className:"admin-no-permission",children:[e.jsx("h3",{children:"Access Denied"}),e.jsx("p",{children:"You do not have permission to view security settings. This section is restricted to the owner."})]})}):e.jsxs("div",{className:"admin-tab-content",children:[e.jsxs("div",{className:"admin-tab-header",children:[e.jsx("h2",{children:"Security Management"}),e.jsx("span",{className:"admin-badge admin-badge-owner",children:"Owner Only"})]}),e.jsxs("div",{className:"admin-stats-grid",children:[e.jsx(Q,{label:"Active Sessions",value:p.length,icon:"ðŸŸ¢",color:"#2ecc71"}),e.jsx(Q,{label:"Failed Logins (Recent)",value:b.length,icon:"ðŸš«",color:"#e74c3c"}),e.jsx(Q,{label:"Expired Passwords",value:c.length,icon:"ðŸ”‘",color:"#f39c12"}),e.jsx(Q,{label:"Auto-Refresh",value:"5s",icon:"ðŸ”„",color:"#3498db",sub:"Sessions refresh every 5 seconds"})]}),e.jsxs("div",{className:"admin-section-tabs",children:[e.jsx("button",{className:`admin-section-tab ${I==="sessions"?"active":""}`,onClick:()=>N("sessions"),children:"Active Sessions"}),e.jsx("button",{className:`admin-section-tab ${I==="history"?"active":""}`,onClick:()=>N("history"),children:"Login History"}),e.jsxs("button",{className:`admin-section-tab ${I==="alerts"?"active":""}`,onClick:()=>N("alerts"),children:["Failed Login Alerts",b.length>0&&e.jsx("span",{className:"admin-badge-count",children:b.length})]}),e.jsx("button",{className:`admin-section-tab ${I==="passwords"?"active":""}`,onClick:()=>N("passwords"),children:"Password Status"})]}),z&&e.jsxs("div",{className:"admin-error-banner",children:[e.jsx("span",{children:z}),e.jsx("button",{className:"admin-btn admin-btn-sm",onClick:()=>U(!0),children:"Retry"})]}),x?e.jsxs("div",{className:"admin-loading-section",children:[e.jsx("div",{className:"admin-loading-spinner"}),e.jsx("p",{children:"Loading security data..."})]}):e.jsxs(e.Fragment,{children:[I==="sessions"&&e.jsxs("div",{className:"admin-section",children:[e.jsx("h3",{className:"admin-section-title",children:"Active Sessions"}),e.jsx("div",{className:"admin-table-wrapper",children:e.jsxs("table",{className:"admin-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"User"}),e.jsx("th",{children:"Role"}),e.jsx("th",{children:"IP Address"}),e.jsx("th",{children:"Device"}),e.jsx("th",{children:"Duration"}),e.jsx("th",{children:"Last Activity"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:p.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"admin-table-empty",children:"No active sessions found."})}):p.map((n,D)=>{const k=n.user_id||n.id||D;return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:"admin-user-cell",children:[e.jsx("div",{className:"admin-avatar-sm",style:{background:Ie[n.role||n.staff_role]||"#6c5ce7"},children:ls(n.user_name||n.name)}),e.jsxs("div",{children:[e.jsx("div",{className:"admin-user-name",children:n.user_name||n.name||"Unknown"}),e.jsx("div",{className:"admin-user-email",children:n.email||""})]})]})}),e.jsx("td",{children:e.jsx("span",{className:"admin-badge",style:{background:(Ie[n.role||n.staff_role]||"#6c5ce7")+"22",color:Ie[n.role||n.staff_role]||"#6c5ce7"},children:n.role_display||n.role||n.staff_role||"â€”"})}),e.jsx("td",{className:"admin-td-ip",children:n.ip_address||n.ip||"â€”"}),e.jsx("td",{className:"admin-td-device",children:n.device||n.user_agent||"â€”"}),e.jsx("td",{children:ka(n.session_duration||n.duration)}),e.jsx("td",{children:Ca(n.last_activity||n.last_seen)}),e.jsx("td",{children:e.jsxs("div",{className:"admin-action-buttons",children:[e.jsx("button",{className:"admin-btn admin-btn-sm admin-btn-info",onClick:()=>u(k),disabled:q,children:"History"}),e.jsx("button",{className:"admin-btn admin-btn-sm admin-btn-danger",onClick:()=>J(k),disabled:g===k,children:g===k?"Logging out...":"Force Logout"})]})})]},k)})})]})})]}),I==="history"&&e.jsxs("div",{className:"admin-section",children:[e.jsx("h3",{className:"admin-section-title",children:"Login History"}),o&&_.length>0&&e.jsxs("div",{className:"admin-card admin-card-highlight",style:{marginBottom:"1rem"},children:[e.jsxs("div",{className:"admin-card-header",children:[e.jsxs("h4",{children:["Login History for User #",o]}),e.jsx("button",{className:"admin-btn admin-btn-sm admin-btn-ghost",onClick:()=>{v(null),C([])},children:"Close"})]}),e.jsx("div",{className:"admin-table-wrapper",children:e.jsxs("table",{className:"admin-table admin-table-compact",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Time"}),e.jsx("th",{children:"IP Address"}),e.jsx("th",{children:"Device"}),e.jsx("th",{children:"Status"})]})}),e.jsx("tbody",{children:_.map((n,D)=>e.jsxs("tr",{children:[e.jsx("td",{children:Xe(n.timestamp||n.created_at)}),e.jsx("td",{className:"admin-td-ip",children:n.ip_address||n.ip||"â€”"}),e.jsx("td",{className:"admin-td-device",children:n.device||n.user_agent||"â€”"}),e.jsx("td",{children:e.jsx("span",{className:`admin-badge ${n.success===!1||n.status==="failed"?"admin-badge-danger":"admin-badge-success"}`,children:n.success===!1||n.status==="failed"?"Failed":"Success"})})]},D))})]})})]}),e.jsx("div",{className:"admin-table-wrapper",children:e.jsxs("table",{className:"admin-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Time"}),e.jsx("th",{children:"User"}),e.jsx("th",{children:"IP Address"}),e.jsx("th",{children:"Device"}),e.jsx("th",{children:"Status"})]})}),e.jsx("tbody",{children:h.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"admin-table-empty",children:"No login history available. Login history will appear when staff log in."})}):h.map((n,D)=>e.jsxs("tr",{className:n.success===!1||n.status==="failed"?"admin-row-danger":"",children:[e.jsx("td",{children:Xe(n.timestamp||n.created_at)}),e.jsx("td",{children:e.jsxs("div",{className:"admin-user-cell",children:[e.jsx("div",{className:"admin-avatar-sm",style:{background:"#6c5ce7"},children:ls(n.user_name||n.user)}),e.jsx("span",{children:n.user_name||n.user||"Unknown"})]})}),e.jsx("td",{className:"admin-td-ip",children:n.ip_address||n.ip||"â€”"}),e.jsx("td",{className:"admin-td-device",children:n.device||n.user_agent||"â€”"}),e.jsx("td",{children:e.jsx("span",{className:`admin-badge ${n.success===!1||n.status==="failed"?"admin-badge-danger":"admin-badge-success"}`,children:n.success===!1||n.status==="failed"?"Failed":"Success"})})]},D))})]})})]}),I==="alerts"&&e.jsxs("div",{className:"admin-section",children:[e.jsx("h3",{className:"admin-section-title",children:"Failed Login Alerts"}),b.length===0?e.jsxs("div",{className:"admin-empty-state",children:[e.jsx("div",{className:"admin-empty-icon",children:"âœ“"}),e.jsx("h4",{children:"No Failed Login Attempts"}),e.jsx("p",{children:"No recent failed login attempts detected. All clear!"})]}):e.jsx("div",{className:"admin-alert-list",children:b.map((n,D)=>e.jsxs("div",{className:"admin-alert-card admin-alert-danger",children:[e.jsx("div",{className:"admin-alert-icon",children:"âš "}),e.jsxs("div",{className:"admin-alert-content",children:[e.jsxs("div",{className:"admin-alert-title",children:["Failed login attempt by"," ",e.jsx("strong",{children:n.user_name||n.user||"Unknown"})]}),e.jsxs("div",{className:"admin-alert-meta",children:[e.jsxs("span",{children:["IP: ",n.ip_address||n.ip||"â€”"]}),e.jsxs("span",{children:["Device: ",n.device||n.user_agent||"â€”"]}),e.jsx("span",{children:Xe(n.timestamp||n.created_at)})]}),n.reason&&e.jsxs("div",{className:"admin-alert-reason",children:["Reason: ",n.reason]})]})]},D))})]}),I==="passwords"&&e.jsxs("div",{className:"admin-section",children:[e.jsx("h3",{className:"admin-section-title",children:"Password Expiry Status"}),e.jsx("div",{className:"admin-table-wrapper",children:e.jsxs("table",{className:"admin-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"User"}),e.jsx("th",{children:"Role"}),e.jsx("th",{children:"Last Password Change"}),e.jsx("th",{children:"Status"})]})}),e.jsx("tbody",{children:p.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"admin-table-empty",children:"No staff data available."})}):p.map((n,D)=>{const k=n.password_expired||n.password_expiry_status==="expired";return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:"admin-user-cell",children:[e.jsx("div",{className:"admin-avatar-sm",style:{background:Ie[n.role||n.staff_role]||"#6c5ce7"},children:ls(n.user_name||n.name)}),e.jsx("span",{children:n.user_name||n.name||"Unknown"})]})}),e.jsx("td",{children:e.jsx("span",{className:"admin-badge",style:{background:(Ie[n.role||n.staff_role]||"#6c5ce7")+"22",color:Ie[n.role||n.staff_role]||"#6c5ce7"},children:n.role_display||n.role||"â€”"})}),e.jsx("td",{children:Xe(n.last_password_change||n.password_changed_at)}),e.jsx("td",{children:k?e.jsx("span",{className:"admin-badge admin-badge-danger",children:"Expired"}):e.jsx("span",{className:"admin-badge admin-badge-success",children:"Active"})})]},n.user_id||D)})})]})})]})]})]})}const cs="/api";function fs(a){return a?new Date(a).toLocaleDateString():"â€”"}function $a(){const{getAuthHeaders:a,hasPermission:t}=fe(),[j,p]=s.useState(null),[E,h]=s.useState([]),[f,o]=s.useState([]),[v,_]=s.useState(!0),[C,x]=s.useState(null),[F,q]=s.useState("overview"),[y,z]=s.useState(null),G=s.useCallback(async()=>{try{const u=await fetch(`${cs}/predictions/accuracy`,{headers:a()});if(u.ok){const J=await u.json();p(J)}}catch(u){console.error("Failed to fetch prediction accuracy:",u)}},[a]),g=s.useCallback(async()=>{try{_(!0),x(null);const u=await fetch(`${cs}/predictions?limit=50`,{headers:a()});if(!u.ok)throw new Error(`Failed to fetch predictions: ${u.status}`);const J=await u.json(),b=J.predictions||J.items||J||[];h(b);const c=b.filter(n=>n.shared||n.is_community||n.community);o(c)}catch(u){x(u.message)}finally{_(!1)}},[a]),H=s.useCallback(async u=>{if(confirm("Are you sure you want to delete this community prediction?"))try{z(u);const J=await fetch(`${cs}/predictions/${u}`,{method:"DELETE",headers:a()});if(!J.ok)throw new Error(`Failed to delete prediction: ${J.status}`);o(b=>b.filter(c=>(c.id||c._id)!==u)),h(b=>b.filter(c=>(c.id||c._id)!==u))}catch(J){alert("Failed to delete prediction: "+J.message)}finally{z(null)}},[a]);s.useEffect(()=>{G(),g()},[G,g]);const I=j?.total_predictions||j?.total||E.length,N=j?.result_accuracy||{},P=N.percentage!=null?N.percentage.toFixed(1):j?.accuracy!=null?(j.accuracy*100).toFixed(1):"â€”",K=N.correct||j?.correct||0,U=N.total!=null&&N.correct!=null?N.total-N.correct:j?.incorrect||0;return e.jsxs("div",{className:"admin-tab-content",children:[e.jsx("div",{className:"admin-tab-header",children:e.jsx("h2",{children:"Predictions Management"})}),e.jsxs("div",{className:"admin-stats-grid",children:[e.jsx(Q,{label:"Total Predictions",value:I,icon:"âš½",color:"#3498db"}),e.jsx(Q,{label:"Accuracy",value:P!=="â€”"?`${P}%`:"â€”",icon:"ðŸŽ¯",color:"#2ecc71"}),e.jsx(Q,{label:"Correct",value:K,icon:"âœ“",color:"#27ae60",sub:"Winning predictions"}),e.jsx(Q,{label:"Incorrect",value:U,icon:"âœ—",color:"#e74c3c",sub:"Lost predictions"})]}),e.jsxs("div",{className:"admin-section-tabs",children:[e.jsx("button",{className:`admin-section-tab ${F==="overview"?"active":""}`,onClick:()=>q("overview"),children:"Recent Predictions"}),e.jsxs("button",{className:`admin-section-tab ${F==="community"?"active":""}`,onClick:()=>q("community"),children:["Community Predictions",f.length>0&&e.jsx("span",{className:"admin-badge-count",children:f.length})]}),e.jsx("button",{className:`admin-section-tab ${F==="analysts"?"active":""}`,onClick:()=>q("analysts"),children:"Analyst Performance"}),e.jsx("button",{className:`admin-section-tab ${F==="review"?"active":""}`,onClick:()=>q("review"),children:"Review Queue"})]}),C&&e.jsxs("div",{className:"admin-error-banner",children:[e.jsx("span",{children:C}),e.jsx("button",{className:"admin-btn admin-btn-sm",onClick:g,children:"Retry"})]}),v?e.jsxs("div",{className:"admin-loading-section",children:[e.jsx("div",{className:"admin-loading-spinner"}),e.jsx("p",{children:"Loading predictions data..."})]}):e.jsxs(e.Fragment,{children:[F==="overview"&&e.jsxs("div",{className:"admin-section",children:[e.jsx("h3",{className:"admin-section-title",children:"Recent Predictions"}),e.jsx("div",{className:"admin-table-wrapper",children:e.jsxs("table",{className:"admin-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"User"}),e.jsx("th",{children:"Match"}),e.jsx("th",{children:"Predicted Outcome"}),e.jsx("th",{children:"Actual Result"}),e.jsx("th",{children:"Status"})]})}),e.jsx("tbody",{children:E.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"admin-table-empty",children:"No predictions tracked yet."})}):E.map((u,J)=>{const b=u.id||u._id||J,c=u.correct===!0||u.status==="correct"||u.result==="win",n=u.correct===!1||u.status==="incorrect"||u.result==="loss",D=!c&&!n,k=u.user_name||u.user||"System";return e.jsxs("tr",{children:[e.jsx("td",{children:fs(u.date||u.match_date||u.created_at)}),e.jsx("td",{children:e.jsxs("div",{className:"admin-user-cell",children:[e.jsx("div",{className:"admin-avatar-sm",style:{background:k==="System"?"#8b8d97":"#6c5ce7"},children:k.charAt(0).toUpperCase()}),e.jsx("span",{children:k})]})}),e.jsx("td",{children:e.jsxs("div",{className:"admin-match-cell",children:[e.jsx("strong",{children:u.match||u.match_name||`${u.home_team||"?"} vs ${u.away_team||"?"}`}),u.league&&e.jsx("span",{className:"admin-match-league",children:u.league})]})}),e.jsx("td",{children:e.jsx("span",{className:"admin-badge admin-badge-info",children:u.predicted_outcome||u.prediction||u.predicted||"â€”"})}),e.jsx("td",{children:u.actual_result||u.actual||u.score||"â€”"}),e.jsx("td",{children:D?e.jsx("span",{className:"admin-badge admin-badge-pending",children:"Pending"}):c?e.jsx("span",{className:"admin-badge admin-badge-success",children:"Correct"}):e.jsx("span",{className:"admin-badge admin-badge-danger",children:"Incorrect"})})]},b)})})]})})]}),F==="community"&&e.jsxs("div",{className:"admin-section",children:[e.jsx("h3",{className:"admin-section-title",children:"Community Predictions"}),e.jsx("p",{className:"admin-section-desc",children:"Shared predictions from the community. Use moderation controls to remove inappropriate content."}),e.jsx("div",{className:"admin-table-wrapper",children:e.jsxs("table",{className:"admin-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"User"}),e.jsx("th",{children:"Match"}),e.jsx("th",{children:"Prediction"}),e.jsx("th",{children:"Status"}),t("predictions","delete")&&e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:f.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:t("predictions","delete")?6:5,className:"admin-table-empty",children:"No community predictions found."})}):f.map((u,J)=>{const b=u.id||u._id||J,c=u.correct===!0||u.status==="correct"||u.result==="win",n=u.correct===!1||u.status==="incorrect"||u.result==="loss",D=!c&&!n;return e.jsxs("tr",{children:[e.jsx("td",{children:fs(u.date||u.match_date||u.created_at)}),e.jsx("td",{children:e.jsxs("div",{className:"admin-user-cell",children:[e.jsx("div",{className:"admin-avatar-sm",style:{background:"#6c5ce7"},children:(u.user_name||u.user||"?").charAt(0).toUpperCase()}),e.jsx("span",{children:u.user_name||u.user||"Anonymous"})]})}),e.jsx("td",{children:u.match||u.match_name||`${u.home_team||"?"} vs ${u.away_team||"?"}`}),e.jsx("td",{children:e.jsx("span",{className:"admin-badge admin-badge-info",children:u.predicted_outcome||u.prediction||u.predicted||"â€”"})}),e.jsx("td",{children:D?e.jsx("span",{className:"admin-badge admin-badge-pending",children:"Pending"}):c?e.jsx("span",{className:"admin-badge admin-badge-success",children:"Correct"}):e.jsx("span",{className:"admin-badge admin-badge-danger",children:"Incorrect"})}),t("predictions","delete")&&e.jsx("td",{children:e.jsx("button",{className:"admin-btn admin-btn-sm admin-btn-danger",onClick:()=>H(b),disabled:y===b,children:y===b?"Deleting...":"Delete"})})]},b)})})]})})]}),F==="analysts"&&e.jsx("div",{className:"admin-section",children:e.jsxs("div",{className:"admin-coming-soon",children:[e.jsx("div",{className:"admin-coming-soon-icon",children:"ðŸ“ˆ"}),e.jsx("h3",{children:"Analyst Performance"}),e.jsx("p",{children:"Track and compare prediction accuracy across analysts. See individual win rates, streaks, and specialization by league or market type."}),e.jsx("span",{className:"admin-badge admin-badge-pending",children:"Coming Soon"})]})}),F==="review"&&e.jsx("div",{className:"admin-section",children:e.jsxs("div",{className:"admin-coming-soon",children:[e.jsx("div",{className:"admin-coming-soon-icon",children:"ðŸ“‹"}),e.jsx("h3",{children:"Prediction Review Queue"}),e.jsx("p",{children:"Review and approve predictions before they are published. Set quality standards, add notes, and track review turnaround times."}),e.jsx("span",{className:"admin-badge admin-badge-pending",children:"Coming Soon"})]})})]})]})}function La(){const{getAuthHeaders:a,hasPermission:t}=fe(),[j,p]=s.useState(null),[E,h]=s.useState([]),[f,o]=s.useState(!0),[v,_]=s.useState("all"),C=t("sales","export"),x=s.useCallback(async()=>{o(!0);try{const[g,H]=await Promise.all([T.get("/api/admin/dashboard-stats",{headers:a()}),T.get("/api/admin/subscriptions",{headers:a()})]);p(g.data),h(H.data.subscriptions||[])}catch{}o(!1)},[a]);s.useEffect(()=>{x()},[x]);const F=()=>{if(!C)return;const g=[["User","Email","Plan","Price","Currency","Status","Expires","Days Left"].join(","),...E.map(P=>[P.display_name||P.username,P.email,P.plan,P.price_amount,P.price_currency,P.status,P.expires_at||"",P.days_remaining||0].join(","))].join(`
`),H=new Blob([g],{type:"text/csv"}),I=URL.createObjectURL(H),N=document.createElement("a");N.href=I,N.download=`sales-report-${new Date().toISOString().split("T")[0]}.csv`,N.click(),URL.revokeObjectURL(I)};if(f)return e.jsx("div",{className:"admin-loading",children:"Loading sales data..."});const q=j?.subscriptions||{},y=j?.balance_adjustments||{},z=E.filter(g=>v==="all"?!0:g.plan===v),G={};return E.forEach(g=>{const H=g.plan||"unknown";G[H]=(G[H]||0)+1}),e.jsxs("div",{className:"admin-tab-content",children:[e.jsxs("div",{className:"admin-section-header",children:[e.jsx("h3",{children:"Sales & Revenue Dashboard"}),C&&e.jsx("button",{className:"admin-action-btn upgrade",onClick:F,children:"Export CSV"})]}),e.jsxs("div",{className:"admin-stats-grid",children:[e.jsx(Q,{label:"Active Subscriptions",value:q.active||0,color:"#00b894"}),e.jsx(Q,{label:"Total Subscriptions",value:q.total_subscriptions||E.length,color:"#6c5ce7"}),e.jsx(Q,{label:"Revenue (USD)",value:`$${q.revenue_usd||0}`,color:"#fdcb6e"}),e.jsx(Q,{label:"Revenue (KES)",value:`KES ${q.revenue_kes||0}`,color:"#55efc4"}),e.jsx(Q,{label:"Cancelled",value:q.cancelled||0,color:"#e17055"}),e.jsx(Q,{label:"Expired",value:q.expired||0,color:"#636e72"})]}),Object.keys(G).length>0&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{style:{marginTop:24},children:"Plan Breakdown"}),e.jsx("div",{className:"admin-stats-grid",children:Object.entries(G).map(([g,H])=>e.jsx(Q,{label:g.replace(/_/g," ").toUpperCase(),value:H,color:"#74b9ff"},g))})]}),y&&y.total_adjustments>0&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{style:{marginTop:24},children:"Balance Adjustments"}),e.jsxs("div",{className:"admin-stats-grid",children:[e.jsx(Q,{label:"Total Adjustments",value:y.total_adjustments,color:"#a78bfa"}),e.jsx(Q,{label:"Credited (USD)",value:`$${y.total_credited_usd}`,color:"#22c55e"}),e.jsx(Q,{label:"Debited (USD)",value:`$${y.total_debited_usd}`,color:"#ef4444"}),e.jsx(Q,{label:"Credited (KES)",value:`KES ${y.total_credited_kes}`,color:"#22c55e"}),e.jsx(Q,{label:"Debited (KES)",value:`KES ${y.total_debited_kes}`,color:"#ef4444"})]})]}),e.jsx("h3",{style:{marginTop:24},children:"Active Subscribers"}),e.jsxs("div",{className:"admin-users-toolbar",children:[e.jsxs("select",{value:v,onChange:g=>_(g.target.value),className:"admin-filter-select",children:[e.jsx("option",{value:"all",children:"All Plans"}),Object.keys(G).map(g=>e.jsx("option",{value:g,children:g.replace(/_/g," ").toUpperCase()},g))]}),e.jsxs("span",{className:"admin-user-count",children:[z.length," subscribers"]})]}),e.jsxs("div",{className:"admin-users-table",children:[e.jsxs("div",{className:"admin-table-header",children:[e.jsx("span",{className:"col-avatar"}),e.jsx("span",{className:"col-name",children:"User"}),e.jsx("span",{className:"col-email",children:"Plan"}),e.jsx("span",{className:"col-tier",children:"Price"}),e.jsx("span",{className:"col-status",children:"Status"}),e.jsx("span",{className:"col-joined",children:"Expires"}),e.jsx("span",{className:"col-logins",children:"Days Left"})]}),z.map(g=>e.jsxs("div",{className:"admin-table-row",children:[e.jsx("span",{className:"col-avatar",children:e.jsx("span",{className:"admin-user-avatar",style:{background:g.avatar_color||"#6c5ce7"},children:(g.display_name||g.username||"?")[0].toUpperCase()})}),e.jsxs("span",{className:"col-name",children:[e.jsx("strong",{children:g.display_name||"No Name"}),e.jsxs("small",{children:["@",g.username]})]}),e.jsx("span",{className:"col-email",children:e.jsx("span",{className:"tier-tag pro",children:(g.plan||"").replace(/_/g," ").toUpperCase()})}),e.jsxs("span",{className:"col-tier",children:[g.price_currency," ",g.price_amount]}),e.jsxs("span",{className:"col-status",children:[e.jsx("span",{className:`status-dot ${g.status==="active"?"active":"suspended"}`}),g.status]}),e.jsx("span",{className:"col-joined",children:g.expires_at?new Date(g.expires_at).toLocaleDateString():"-"}),e.jsxs("span",{className:"col-logins",children:[g.days_remaining||0,"d"]})]},g.id||g.user_id)),z.length===0&&e.jsx("div",{className:"admin-empty-row",children:"No subscribers found"})]})]})}function Ta(){const{getAuthHeaders:a}=fe(),[t,j]=s.useState(null),[p,E]=s.useState(!0),[h,f]=s.useState(""),o=s.useCallback(async()=>{E(!0);try{const _=await T.get("/api/admin/dashboard-stats",{headers:a()});j(_.data)}catch{}E(!1)},[a]);s.useEffect(()=>{o()},[o]);const v=async()=>{try{const _=await T.post("/api/admin/activity-logs/cleanup",{retention_days:90},{headers:a()});f(`Cleaned up ${_.data.deleted||0} old log entries`),setTimeout(()=>f(""),3e3)}catch{f("Failed to clean up logs"),setTimeout(()=>f(""),3e3)}};return p?e.jsx("div",{className:"admin-loading",children:"Loading settings..."}):e.jsxs("div",{className:"admin-tab-content",children:[e.jsx("h3",{children:"System Settings"}),h&&e.jsx("div",{style:{padding:"10px 16px",borderRadius:8,marginBottom:16,background:h.includes("Failed")?"rgba(231,76,60,0.15)":"rgba(46,204,113,0.15)",color:h.includes("Failed")?"#e74c3c":"#2ecc71",border:`1px solid ${h.includes("Failed")?"rgba(231,76,60,0.3)":"rgba(46,204,113,0.3)"}`},children:h}),e.jsxs("div",{className:"admin-settings-section",children:[e.jsx("h4",{children:"Platform Overview"}),e.jsxs("div",{className:"admin-stats-grid",children:[e.jsx(Q,{label:"Total Users",value:t?.users?.total_users||0,color:"#6c5ce7"}),e.jsx(Q,{label:"Pro Users",value:t?.users?.pro_users||0,color:"#fdcb6e"}),e.jsx(Q,{label:"Active Subs",value:t?.subscriptions?.active||0,color:"#00b894"}),e.jsx(Q,{label:"New Today",value:t?.users?.new_today||0,color:"#55efc4"})]})]}),e.jsxs("div",{className:"admin-settings-section",children:[e.jsx("h4",{children:"API Configuration"}),e.jsxs("div",{className:"admin-settings-card",children:[e.jsxs("div",{className:"admin-settings-row",children:[e.jsx("span",{children:"API-Football (api-sports.io)"}),e.jsxs("span",{className:"admin-settings-value",children:[e.jsx("span",{className:"status-dot active"}),"Free Tier - 100 requests/day"]})]}),e.jsxs("div",{className:"admin-settings-row",children:[e.jsx("span",{children:"The Odds API"}),e.jsxs("span",{className:"admin-settings-value",children:[e.jsx("span",{className:"status-dot active"}),"Connected"]})]}),e.jsxs("div",{className:"admin-settings-row",children:[e.jsx("span",{children:"Database"}),e.jsxs("span",{className:"admin-settings-value",children:[e.jsx("span",{className:"status-dot active"}),"SQLite (Local)"]})]})]})]}),e.jsxs("div",{className:"admin-settings-section",children:[e.jsx("h4",{children:"Cache Configuration"}),e.jsxs("div",{className:"admin-settings-card",children:[e.jsxs("div",{className:"admin-settings-row",children:[e.jsx("span",{children:"Today Fixtures"}),e.jsx("span",{className:"admin-settings-value",children:"2 minutes"})]}),e.jsxs("div",{className:"admin-settings-row",children:[e.jsx("span",{children:"Live Matches"}),e.jsx("span",{className:"admin-settings-value",children:"30 seconds"})]}),e.jsxs("div",{className:"admin-settings-row",children:[e.jsx("span",{children:"Injuries Data"}),e.jsx("span",{className:"admin-settings-value",children:"12 hours"})]}),e.jsxs("div",{className:"admin-settings-row",children:[e.jsx("span",{children:"Coach Data"}),e.jsx("span",{className:"admin-settings-value",children:"24 hours"})]}),e.jsxs("div",{className:"admin-settings-row",children:[e.jsx("span",{children:"Standings"}),e.jsx("span",{className:"admin-settings-value",children:"6 hours"})]})]})]}),e.jsxs("div",{className:"admin-settings-section",children:[e.jsx("h4",{children:"Maintenance"}),e.jsx("div",{className:"admin-settings-card",children:e.jsxs("div",{className:"admin-settings-row",children:[e.jsxs("div",{children:[e.jsx("span",{children:"Clean Up Activity Logs"}),e.jsx("small",{style:{display:"block",color:"#94a3b8",fontSize:12},children:"Remove activity logs older than 90 days"})]}),e.jsx("button",{className:"admin-action-btn suspend",onClick:v,children:"Run Cleanup"})]})})]}),e.jsxs("div",{className:"admin-settings-section",children:[e.jsx("h4",{children:"Subscription Plans"}),e.jsxs("div",{className:"admin-settings-card",children:[e.jsxs("div",{className:"admin-settings-row",children:[e.jsx("span",{children:"Free Tier"}),e.jsx("span",{className:"admin-settings-value",children:"3 analyses/day, basic predictions"})]}),e.jsxs("div",{className:"admin-settings-row",children:[e.jsx("span",{children:"Pro Weekly"}),e.jsx("span",{className:"admin-settings-value",children:"$2.99 / KES 450"})]}),e.jsxs("div",{className:"admin-settings-row",children:[e.jsx("span",{children:"Pro Monthly"}),e.jsx("span",{className:"admin-settings-value",children:"$7.99 / KES 1,200"})]}),e.jsxs("div",{className:"admin-settings-row",children:[e.jsx("span",{children:"Pro 3-Month"}),e.jsx("span",{className:"admin-settings-value",children:"$19.99 / KES 3,000"})]})]})]})]})}function Pa(){const{getAuthHeaders:a,roleInfo:t}=fe(),[j,p]=s.useState([]),[E,h]=s.useState(!0),[f,o]=s.useState(""),[v,_]=s.useState(""),[C,x]=s.useState(!1),[F,q]=s.useState(""),[y,z]=s.useState("all"),[G,g]=s.useState(null),[H,I]=s.useState(""),N=t?.level<=1||t?.name==="owner",P=s.useCallback(async()=>{try{const c=y!=="all"?`?status=${y}`:"",n=await T.get(`/api/admin/broadcasts${c}`,{headers:a()});p(n.data.broadcasts||[])}catch{}h(!1)},[a,y]);s.useEffect(()=>{P()},[P]);const K=async c=>{if(c.preventDefault(),!(!f.trim()||!v.trim()||C)){x(!0),q("");try{const n=await T.post("/api/admin/broadcast",{title:f.trim(),message:v.trim()},{headers:a()});n.data.success&&(n.data.status==="pending_approval"?q("Broadcast submitted for super admin approval."):q(`Broadcast sent to ${n.data.recipient_count} users!`),o(""),_(""),P())}catch(n){q(n.response?.data?.detail||"Failed to create broadcast")}x(!1)}},U=async c=>{try{const n=await T.post(`/api/admin/broadcast/${c}/approve`,{},{headers:a()});n.data.success&&(q(`Broadcast approved and sent to ${n.data.recipient_count} users!`),P())}catch(n){q(n.response?.data?.detail||"Failed to approve")}},u=async c=>{try{await T.post(`/api/admin/broadcast/${c}/reject`,{reason:H},{headers:a()}),q("Broadcast rejected."),g(null),I(""),P()}catch(n){q(n.response?.data?.detail||"Failed to reject")}},J=c=>{if(!c)return"";const n=c&&!c.endsWith("Z")&&!c.includes("+")?c+"Z":c,D=Date.now()-new Date(n).getTime(),k=Math.floor(D/6e4);if(k<1)return"Just now";if(k<60)return`${k}m ago`;const $=Math.floor(k/60);return $<24?`${$}h ago`:`${Math.floor($/24)}d ago`},b={pending_approval:{label:"Pending Approval",color:"#f59e0b",bg:"rgba(245,158,11,0.15)"},approved:{label:"Approved",color:"#22c55e",bg:"rgba(34,197,94,0.15)"},sent:{label:"Sent",color:"#3b82f6",bg:"rgba(59,130,246,0.15)"},rejected:{label:"Rejected",color:"#ef4444",bg:"rgba(239,68,68,0.15)"}};return E?e.jsx("div",{className:"admin-loading",children:"Loading broadcasts..."}):e.jsxs("div",{className:"admin-tab-content",children:[e.jsx("h2",{className:"admin-tab-title",children:"Broadcast Messages"}),e.jsx("p",{className:"admin-tab-subtitle",children:"Send announcements to all users at once"}),e.jsxs("div",{className:"broadcast-compose",children:[e.jsx("h3",{className:"broadcast-section-title",children:"Compose Broadcast"}),!N&&e.jsx("p",{className:"broadcast-approval-note",children:"Your broadcast will be submitted for super admin approval before being sent."}),e.jsxs("form",{onSubmit:K,className:"broadcast-form",children:[e.jsx("input",{type:"text",placeholder:"Broadcast title...",value:f,onChange:c=>o(c.target.value),className:"broadcast-title-input",maxLength:100}),e.jsx("textarea",{placeholder:"Write your message to all users...",value:v,onChange:c=>_(c.target.value),className:"broadcast-message-input",maxLength:1e3,rows:4}),e.jsxs("div",{className:"broadcast-form-footer",children:[e.jsxs("span",{className:"broadcast-char-count",children:[v.length,"/1000"]}),e.jsx("button",{type:"submit",className:"broadcast-send-btn",disabled:!f.trim()||!v.trim()||C,children:C?"Sending...":N?"Send to All Users":"Submit for Approval"})]})]}),F&&e.jsx("p",{className:"broadcast-status-msg",children:F})]}),e.jsxs("div",{className:"broadcast-history",children:[e.jsxs("div",{className:"broadcast-history-header",children:[e.jsx("h3",{className:"broadcast-section-title",children:"Broadcast History"}),e.jsx("div",{className:"broadcast-filter-tabs",children:["all","pending_approval","sent","rejected"].map(c=>e.jsx("button",{className:`broadcast-filter-btn ${y===c?"active":""}`,onClick:()=>z(c),children:c==="all"?"All":c==="pending_approval"?"Pending":c.charAt(0).toUpperCase()+c.slice(1)},c))})]}),j.length===0?e.jsx("p",{className:"admin-empty-row",children:"No broadcasts found."}):e.jsx("div",{className:"broadcast-list",children:j.map(c=>{const n=b[c.status]||b.sent;return e.jsxs("div",{className:"broadcast-item",children:[e.jsxs("div",{className:"broadcast-item-header",children:[e.jsx("strong",{className:"broadcast-item-title",children:c.title}),e.jsx("span",{className:"broadcast-status-badge",style:{color:n.color,background:n.bg},children:n.label})]}),e.jsx("p",{className:"broadcast-item-message",children:c.message}),e.jsxs("div",{className:"broadcast-item-meta",children:[e.jsxs("span",{children:["By: ",c.sender_name]}),e.jsx("span",{children:J(c.created_at)}),c.status==="sent"&&e.jsxs("span",{children:[c.recipient_count," recipients"]}),c.approved_by_name&&e.jsxs("span",{children:["Approved by: ",c.approved_by_name]}),c.rejected_reason&&e.jsxs("span",{children:["Reason: ",c.rejected_reason]})]}),c.status==="pending_approval"&&N&&e.jsx("div",{className:"broadcast-approval-actions",children:G===c.id?e.jsxs("div",{className:"broadcast-reject-form",children:[e.jsx("input",{type:"text",placeholder:"Rejection reason (optional)...",value:H,onChange:D=>I(D.target.value),className:"broadcast-reject-input"}),e.jsx("button",{className:"broadcast-reject-confirm-btn",onClick:()=>u(c.id),children:"Confirm Reject"}),e.jsx("button",{className:"broadcast-reject-cancel-btn",onClick:()=>{g(null),I("")},children:"Cancel"})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"broadcast-approve-btn",onClick:()=>U(c.id),children:"Approve & Send"}),e.jsx("button",{className:"broadcast-reject-btn",onClick:()=>g(c.id),children:"Reject"})]})})]},c.id)})})]})]})}const es={LIVE:{label:"LIVE",className:"bot-chat-badge-live"},HT:{label:"HT",className:"bot-chat-badge-ht"},FT:{label:"FT",className:"bot-chat-badge-ft"},NS:{label:"NS",className:"bot-chat-badge-ns"}};function os(a){if(!a)return"#888";let t=0;for(let p=0;p<a.length;p++)t=a.charCodeAt(p)+((t<<5)-t);return`hsl(${Math.abs(t)%360}, 55%, 45%)`}function Ea(a){if(!a)return"";const t=new Date(a),j=t.getHours().toString().padStart(2,"0"),p=t.getMinutes().toString().padStart(2,"0");return`${j}:${p}`}function Ra({getAuthHeaders:a}){const[t,j]=s.useState([]),[p,E]=s.useState(!1),[h,f]=s.useState(""),[o,v]=s.useState(null),[_,C]=s.useState([]),[x,F]=s.useState(!1),[q,y]=s.useState(""),[z,G]=s.useState(!1),g=s.useRef(0),H=s.useRef(null),I=s.useRef(null),N=s.useRef(!0),[P,K]=s.useState([]),[U,u]=s.useState(null),[J,b]=s.useState(!1),[c,n]=s.useState(""),D=s.useRef(null),k=s.useCallback(async()=>{try{E(!0);const A=await T.get("/api/admin/bots/live-matches",{headers:a()});j(A.data.matches||A.data||[])}catch(A){console.error("Failed to fetch live matches:",A)}finally{E(!1)}},[a]);s.useEffect(()=>{k();const A=setInterval(k,3e4);return()=>clearInterval(A)},[k]);const $=s.useCallback(async()=>{try{const A=await T.get("/api/admin/bots",{params:{is_active:1,per_page:100},headers:a()}),S=A.data?.bots||A.data||[];K(S),S.length>0&&!U&&u(S[0])}catch(A){console.error("Failed to fetch bots:",A)}},[a,U]);s.useEffect(()=>{$()},[$]),s.useEffect(()=>{function A(S){D.current&&!D.current.contains(S.target)&&(b(!1),n(""))}return document.addEventListener("mousedown",A),()=>document.removeEventListener("mousedown",A)},[]),s.useEffect(()=>{C([]),g.current=0,N.current=!0},[o]);const ie=s.useCallback(async()=>{if(o)try{F(r=>_.length===0?!0:r);const A=o.match_key||o.id,S=await T.get(`/api/admin/bots/match-chat/${A}`,{params:{since_id:g.current},headers:a()}),m=S.data?.messages||S.data||[];if(m.length>0){C(Y=>{const se=new Set(Y.map(l=>l.id)),V=m.filter(l=>!se.has(l.id));return V.length===0?Y:[...Y,...V]});const r=Math.max(...m.map(Y=>Y.id));r>g.current&&(g.current=r)}}catch(A){console.error("Failed to fetch chat messages:",A)}finally{F(!1)}},[o,a,_.length]);s.useEffect(()=>{if(!o)return;ie();const A=setInterval(ie,3e3);return()=>clearInterval(A)},[o,ie]);const Z=s.useCallback(()=>{const A=I.current;if(!A)return;const{scrollTop:S,scrollHeight:m,clientHeight:r}=A;N.current=m-S-r<60},[]);s.useEffect(()=>{N.current&&H.current&&H.current.scrollIntoView({behavior:"smooth"})},[_]);const w=s.useCallback(async()=>{if(!U||!o||!q.trim()||z)return;const A=o.match_key||o.id,S=q.trim();y(""),G(!0);try{await T.post("/api/admin/bots/action",{bot_id:U.id,action:"match_chat",target_id:A,message:S},{headers:a()}),setTimeout(()=>ie(),500)}catch(m){console.error("Failed to send message:",m),y(S)}finally{G(!1)}},[U,o,q,z,a,ie]),B=s.useCallback(A=>{A.key==="Enter"&&!A.shiftKey&&(A.preventDefault(),w())},[w]),X=s.useCallback(A=>{v(S=>{const m=S?.match_key||S?.id,r=A?.match_key||A?.id;return m===r?S:A})},[]),W=t.filter(A=>{if(!h.trim())return!0;const S=h.toLowerCase(),m=(A.home_team||"").toLowerCase(),r=(A.away_team||"").toLowerCase(),Y=(A.league||"").toLowerCase();return m.includes(S)||r.includes(S)||Y.includes(S)}),ee=P.filter(A=>c.trim()?(A.display_name||"").toLowerCase().includes(c.toLowerCase()):!0);function M(A){const S=(A||"").toUpperCase();return S.includes("LIVE")||S==="1H"||S==="2H"||S==="ET"?es.LIVE:S==="HT"?es.HT:S==="FT"||S==="AET"||S==="PEN"?es.FT:S==="NS"||S==="TBD"?es.NS:{label:S||"?",className:"bot-chat-badge-default"}}const ae=o?.match_key||o?.id;return e.jsxs("div",{className:"bot-chat-panel",children:[e.jsxs("div",{className:"bot-chat-left",children:[e.jsxs("div",{className:"bot-chat-left-header",children:[e.jsx("h3",{className:"bot-chat-left-title",children:"Live Matches"}),e.jsx("input",{type:"text",className:"bot-chat-search",placeholder:"Search matches...",value:h,onChange:A=>f(A.target.value)})]}),e.jsxs("div",{className:"bot-chat-match-list",children:[p&&t.length===0&&e.jsx("div",{className:"bot-chat-loading",children:"Loading matches..."}),!p&&W.length===0&&e.jsx("div",{className:"bot-chat-empty",children:h?"No matches found":"No live matches"}),W.map(A=>{const S=A.match_key||A.id,m=ae===S,r=M(A.status);return e.jsxs("div",{className:`bot-chat-match-item ${m?"bot-chat-match-item-selected":""}`,onClick:()=>X(A),children:[e.jsxs("div",{className:"bot-chat-match-top",children:[e.jsxs("span",{className:"bot-chat-match-teams",children:[A.home_team," vs ",A.away_team]}),e.jsx("span",{className:`bot-chat-badge ${r.className}`,children:r.label})]}),e.jsxs("div",{className:"bot-chat-match-bottom",children:[e.jsx("span",{className:"bot-chat-match-score",children:A.score!==void 0&&A.score!==null?A.score:"-"}),e.jsx("span",{className:"bot-chat-match-league",children:A.league||""})]})]},S)})]})]}),e.jsx("div",{className:"bot-chat-right",children:o?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bot-chat-header",children:e.jsxs("div",{className:"bot-chat-header-info",children:[e.jsxs("span",{className:"bot-chat-header-match",children:[o.home_team," vs ",o.away_team]}),e.jsx("span",{className:`bot-chat-badge ${M(o.status).className}`,children:M(o.status).label}),o.score!==void 0&&o.score!==null&&e.jsx("span",{className:"bot-chat-header-score",children:o.score})]})}),e.jsxs("div",{className:"bot-chat-messages",ref:I,onScroll:Z,children:[x&&_.length===0&&e.jsx("div",{className:"bot-chat-loading",children:"Loading messages..."}),!x&&_.length===0&&e.jsx("div",{className:"bot-chat-empty",children:"No messages yet"}),_.map(A=>{const S=os(A.display_name),m=(A.display_name||"?")[0].toUpperCase(),r=A.is_bot===!0||A.is_bot===1;return e.jsxs("div",{className:"bot-chat-message",children:[e.jsx("div",{className:"bot-chat-avatar",style:{backgroundColor:S},children:m}),e.jsxs("div",{className:"bot-chat-message-content",children:[e.jsxs("div",{className:"bot-chat-message-header",children:[e.jsx("span",{className:"bot-chat-message-name",children:A.display_name}),r&&e.jsx("span",{className:"bot-chat-bot-badge",children:"BOT"}),e.jsx("span",{className:"bot-chat-message-time",children:Ea(A.created_at||A.timestamp)})]}),e.jsx("div",{className:"bot-chat-message-text",children:A.message||A.text})]})]},A.id)}),e.jsx("div",{ref:H})]}),e.jsxs("div",{className:"bot-chat-input-area",children:[e.jsxs("div",{className:"bot-chat-bot-selector",ref:D,children:[e.jsxs("button",{type:"button",className:"bot-chat-bot-selector-btn",onClick:()=>{b(A=>!A),n("")},children:[U?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"bot-chat-bot-avatar-small",style:{backgroundColor:os(U.display_name)},children:(U.display_name||"?")[0].toUpperCase()}),e.jsx("span",{className:"bot-chat-bot-selector-name",children:U.display_name})]}):e.jsx("span",{className:"bot-chat-bot-selector-name",children:"Select bot"}),e.jsx("span",{className:"bot-chat-bot-selector-arrow",children:J?"â–²":"â–¼"})]}),J&&e.jsxs("div",{className:"bot-chat-bot-dropdown",children:[e.jsx("input",{type:"text",className:"bot-chat-bot-dropdown-search",placeholder:"Search bots...",value:c,onChange:A=>n(A.target.value),autoFocus:!0}),e.jsxs("div",{className:"bot-chat-bot-dropdown-list",children:[ee.length===0&&e.jsx("div",{className:"bot-chat-bot-dropdown-empty",children:"No bots found"}),ee.map(A=>e.jsxs("div",{className:`bot-chat-bot-dropdown-item ${U?.id===A.id?"bot-chat-bot-dropdown-item-selected":""}`,onClick:()=>{u(A),b(!1),n("")},children:[e.jsx("span",{className:"bot-chat-bot-avatar-small",style:{backgroundColor:os(A.display_name)},children:(A.display_name||"?")[0].toUpperCase()}),e.jsx("span",{className:"bot-chat-bot-dropdown-item-name",children:A.display_name})]},A.id))]})]})]}),e.jsxs("div",{className:"bot-chat-input-wrapper",children:[e.jsx("input",{type:"text",className:"bot-chat-input",placeholder:U?`Chat as ${U.display_name}...`:"Select a bot first...",value:q,onChange:A=>y(A.target.value),onKeyDown:B,disabled:!U||z}),e.jsx("button",{type:"button",className:"bot-chat-send-btn",onClick:w,disabled:!U||!q.trim()||z,children:z?"Sending...":"Send"})]})]})]}):e.jsxs("div",{className:"bot-chat-placeholder",children:[e.jsx("div",{className:"bot-chat-placeholder-icon",children:e.jsx("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"})})}),e.jsx("p",{className:"bot-chat-placeholder-text",children:"Select a match to view chat"})]})})]})}const Da=["âš½","ðŸ¥…","ðŸ†","ðŸ”¥","ðŸ’ª","ðŸ‘","ðŸŽ¯","ðŸ‘","ðŸ‘Ž","ðŸ˜‚","ðŸ˜­","ðŸ™","â¤ï¸","ðŸ’¯","ðŸ¤”","ðŸ˜","ðŸ¤£","ðŸ’€","ðŸ˜¤","ðŸ«¡","ðŸŽ‰","ðŸ˜Ž","ðŸ¤","ðŸ’°","â­","ðŸš€","ðŸ˜±"];function ds({onSelect:a}){return e.jsx("div",{className:"bot-emoji-picker",onClick:t=>t.stopPropagation(),children:e.jsx("div",{className:"bot-emoji-picker-grid",children:Da.map(t=>e.jsx("button",{className:"bot-emoji-picker-btn",onClick:()=>a(t),type:"button",children:t},t))})})}function ms({onSelect:a,onClose:t}){const[j,p]=s.useState(""),[E,h]=s.useState([]),[f,o]=s.useState(!1),[v,_]=s.useState(!1);s.useRef(null);const C=s.useCallback(async x=>{},[]);return s.useEffect(()=>{C("")},[C]),e.jsx("div",{className:"bot-gif-picker",onClick:x=>x.stopPropagation(),children:e.jsx("div",{style:{padding:"20px",textAlign:"center",color:"#666",fontSize:13},children:"GIF search is not configured"})})}const vs=[{value:"match_chat",label:"Live Chat",icon:"âš½"},{value:"prediction_chat",label:"Prediction Chat",icon:"ðŸ’¬"},{value:"comment",label:"Comment on Prediction",icon:"ðŸ“"}];function Ma({getAuthHeaders:a,selectedBotIds:t}){const[j,p]=s.useState("match_chat"),[E,h]=s.useState(""),[f,o]=s.useState(""),[v,_]=s.useState("same"),[C,x]=s.useState(!1),[F,q]=s.useState(["",""]),[y,z]=s.useState(""),[G,g]=s.useState(30),[H,I]=s.useState(40),[N,P]=s.useState(!1),[K,U]=s.useState(""),[u,J]=s.useState(""),[b,c]=s.useState(!1),[n,D]=s.useState(!1),[k,$]=s.useState("same"),ie=s.useRef(null),Z=s.useRef(null),w=s.useRef({}),B=d=>{k==="same"?(o(O=>O+d),ie.current?.focus()):k==="bulk"?(z(O=>O+d),Z.current?.focus()):typeof k=="number"&&(Ee(k,F[k]+d),w.current[k]?.focus()),c(!1)},X=d=>{const O=`[gif]${d}[/gif]`;k==="same"?o(te=>te?te+`
`+O:O):k==="bulk"?z(te=>te?te+`
`+O:O):typeof k=="number"&&Ee(k,F[k]?F[k]+`
`+O:O),D(!1),c(!1)},[W,ee]=s.useState([]),[M,ae]=s.useState(!1),[A,S]=s.useState([]),[m,r]=s.useState(""),[Y,se]=s.useState(!1),V=A.length>0?A:t||[],[l,re]=s.useState([]),[Se,ve]=s.useState(!1),[Ce,Ae]=s.useState([]),[ke,ye]=s.useState(!1),[Te,$e]=s.useState(1),[R,le]=s.useState(1),[me,de]=s.useState([]),[ue,he]=s.useState(!1),[L,oe]=s.useState({}),ge=s.useRef(null),je=s.useRef(null);s.useEffect(()=>{(async()=>{ae(!0);try{const O=await T.get("/api/admin/bots",{headers:a()});ee((O.data.bots||[]).filter(te=>te.is_active!==!1))}catch{ee([])}ae(!1)})()},[]),s.useEffect(()=>{t?.length>0&&A.length===0&&S(t)},[t]),s.useEffect(()=>{h(""),j==="match_chat"?be():Ne(1)},[j]),s.useEffect(()=>(Le(),ge.current=setInterval(Le,5e3),()=>{ge.current&&clearInterval(ge.current)}),[]),s.useEffect(()=>{je.current&&clearInterval(je.current);const d=me.filter(te=>te.status==="running");if(d.length===0)return;const O=async()=>{const te={};for(const xe of d)try{const we=await T.get(`/api/admin/bots/queue-status/${xe.batch_id}`,{headers:a()});te[xe.batch_id]=we.data}catch{}oe(xe=>({...xe,...te}))};return O(),je.current=setInterval(O,5e3),()=>{je.current&&clearInterval(je.current)}},[me]),s.useEffect(()=>{if(!u)return;const d=setTimeout(()=>J(""),5e3);return()=>clearTimeout(d)},[u]);const be=async()=>{ve(!0);try{const d=await T.get("/api/admin/bots/live-matches",{headers:a()});re(d.data.matches||[])}catch{re([])}ve(!1)},Ne=async(d=1)=>{ye(!0);try{const O=await T.get("/api/admin/bots/predictions",{headers:a(),params:{page:d}});Ae(O.data.predictions||[]),$e(O.data.page||1),le(O.data.total_pages||1)}catch{Ae([])}ye(!1)},Le=async()=>{try{const d=await T.get("/api/admin/bots/active-queues",{headers:a()});de(d.data.queues||d.data||[])}catch{}},ze=async d=>{try{await T.post(`/api/admin/bots/queue-cancel/${d}`,{},{headers:a()}),Le()}catch{}},De=d=>{h(String(d.match_key||d.id))},Me=d=>{h(String(d.id))},Pe=()=>{F.length>=10||q(d=>[...d,""])},Ge=d=>{F.length<=2||q(O=>O.filter((te,xe)=>xe!==d))},Ee=(d,O)=>{q(te=>{const xe=[...te];return xe[d]=O,xe})},ss=async()=>{if(U(""),J(""),!V||V.length===0){U("No bots selected. Select bots from the bot selector above.");return}if(!E.trim()){U("Please select a target.");return}let d=[],O="";if(v==="bulk"){const te=y.split(`
`).filter(xe=>xe.trim());if(te.length===0){U("Please enter at least one message (one per line).");return}if(te.length<V.length){U(`You have ${V.length} bots but only ${te.length} messages. Add more messages or select fewer bots.`);return}d=te.slice(0,V.length).map(xe=>xe.trim())}else if(v==="varied"){const te=F.filter(xe=>xe.trim());if(te.length===0){U("Please enter at least one message.");return}d=te}else{if(!f.trim()){U("Please enter a message.");return}O=f.trim()}if(G<0||H<0){U("Delay values must be positive.");return}if(G>H){U("Min delay cannot be greater than max delay.");return}P(!0);try{const te={bot_ids:V,action:j,target_id:E.trim(),message:O,delay_min:Number(G),delay_max:Number(H),messages_list:d};await T.post("/api/admin/bots/staggered-batch",te,{headers:a()}),J(`Queue started with ${V.length} bots! You can start another batch now â€” select different bots, action, or target below.`),o(""),q(["",""]),z(""),h(""),Le()}catch(te){U(te.response?.data?.detail||"Failed to start queue.")}P(!1)},Oe=d=>{const O=L[d.batch_id];return O||d},as=d=>!d||d<=0?"Done":d<60?`${Math.round(d)}s`:d<3600?`${Math.floor(d/60)}m ${Math.round(d%60)}s`:`${Math.floor(d/3600)}h ${Math.floor(d%3600/60)}m`,We=d=>d==="running"?{background:"rgba(241,196,15,0.15)",color:"#f1c40f",border:"rgba(241,196,15,0.3)",text:"Running"}:d==="completed"?{background:"rgba(46,204,113,0.15)",color:"#2ecc71",border:"rgba(46,204,113,0.3)",text:"Completed"}:d==="cancelled"?{background:"rgba(231,76,60,0.15)",color:"#e74c3c",border:"rgba(231,76,60,0.3)",text:"Cancelled"}:{background:"rgba(149,165,166,0.15)",color:"#95a5a6",border:"rgba(149,165,166,0.3)",text:d||"Unknown"};return e.jsxs("div",{className:"bot-queue-panel",children:[e.jsxs("div",{className:"bot-queue-section",children:[e.jsxs("h3",{className:"bot-queue-section-title",children:["Create Staggered Queue",me.filter(d=>d.status==="running").length>0&&e.jsxs("span",{className:"bot-queue-running-badge",children:[me.filter(d=>d.status==="running").length," running"]})]}),K&&e.jsx("div",{className:"bot-queue-error",children:K}),u&&e.jsx("div",{className:"bot-queue-success",children:u}),e.jsxs("div",{className:"bot-queue-field",children:[e.jsx("label",{className:"bot-queue-label",children:"Action Type"}),e.jsx("div",{className:"bot-queue-action-buttons",children:vs.map(d=>e.jsxs("button",{onClick:()=>p(d.value),className:`bot-queue-action-btn ${j===d.value?"bot-queue-action-btn-active":""}`,children:[d.icon," ",d.label]},d.value))})]}),e.jsxs("div",{className:"bot-queue-field",children:[e.jsx("label",{className:"bot-queue-label",children:"Select Bots"}),e.jsxs("div",{className:"bot-queue-bot-selector",children:[e.jsxs("div",{className:"bot-queue-bot-selector-header",onClick:()=>se(!Y),children:[e.jsxs("span",{children:[V.length," bot",V.length!==1?"s":""," selected"]}),e.jsx("span",{style:{fontSize:"12px"},children:Y?"â–²":"â–¼"})]}),Y&&e.jsxs("div",{className:"bot-queue-bot-selector-dropdown",children:[e.jsx("input",{type:"text",placeholder:"Search bots...",value:m,onChange:d=>r(d.target.value),className:"bot-queue-bot-search"}),e.jsxs("div",{className:"bot-queue-bot-selector-actions",children:[e.jsxs("button",{onClick:()=>{const d=W.filter(O=>!m||O.username?.toLowerCase().includes(m.toLowerCase()));S(O=>{const te=new Set(O);return d.forEach(xe=>te.add(xe.id)),[...te]})},className:"bot-queue-bot-select-action",children:["Select All",m?" filtered":""]}),e.jsxs("button",{onClick:()=>{if(m){const d=W.filter(te=>te.username?.toLowerCase().includes(m.toLowerCase())),O=new Set(d.map(te=>te.id));S(te=>te.filter(xe=>!O.has(xe)))}else S([])},className:"bot-queue-bot-select-action",children:["Deselect All",m?" filtered":""]})]}),e.jsx("div",{className:"bot-queue-bot-list",children:M?e.jsx("div",{className:"bot-queue-loading-text",children:"Loading bots..."}):W.filter(d=>!m||d.username?.toLowerCase().includes(m.toLowerCase())).map(d=>e.jsxs("label",{className:"bot-queue-bot-item",children:[e.jsx("input",{type:"checkbox",checked:A.includes(d.id),onChange:()=>{S(O=>O.includes(d.id)?O.filter(te=>te!==d.id):[...O,d.id])}}),e.jsx("span",{className:"bot-queue-bot-name",children:d.username})]},d.id))})]})]})]}),j==="match_chat"&&e.jsxs("div",{className:"bot-queue-field",children:[e.jsx("label",{className:"bot-queue-label",children:"Select a Match"}),Se?e.jsx("div",{className:"bot-queue-loading-text",children:"Loading matches..."}):l.length===0?e.jsxs("div",{className:"bot-queue-empty-list",children:["No live or scheduled matches available.",e.jsx("button",{onClick:be,className:"bot-queue-refresh-btn",children:"Refresh"})]}):e.jsx("div",{className:"bot-queue-target-list",children:l.map(d=>{const O=String(d.match_key||d.id),te=E===O,xe=["1H","2H","HT","ET","LIVE"].includes(d.status);return e.jsxs("div",{onClick:()=>De(d),className:`bot-queue-target-item ${te?"bot-queue-target-item-selected":""}`,children:[e.jsxs("div",{className:"bot-queue-target-item-main",children:[e.jsxs("div",{className:"bot-queue-match-teams",children:[d.home_team," vs ",d.away_team]}),e.jsxs("div",{className:"bot-queue-match-details",children:[d.league,d.score&&d.score!=="0-0"?` | ${d.score}`:"",d.minute?` | ${d.minute}'`:""]})]}),e.jsx("span",{className:`bot-queue-match-status ${xe?"bot-queue-match-live":"bot-queue-match-scheduled"}`,children:xe?"LIVE":d.status||"Scheduled"})]},d.id||d.match_key)})}),e.jsx("button",{onClick:be,className:"bot-queue-refresh-btn",style:{marginTop:4},children:"Refresh matches"})]}),(j==="prediction_chat"||j==="comment")&&e.jsxs("div",{className:"bot-queue-field",children:[e.jsx("label",{className:"bot-queue-label",children:"Select a Prediction"}),ke?e.jsx("div",{className:"bot-queue-loading-text",children:"Loading predictions..."}):Ce.length===0?e.jsx("div",{className:"bot-queue-empty-list",children:"No predictions found."}):e.jsx("div",{className:"bot-queue-target-list",children:Ce.map(d=>{const O=E===String(d.id);return e.jsxs("div",{onClick:()=>Me(d),className:`bot-queue-target-item ${O?"bot-queue-target-item-selected":""}`,children:[e.jsxs("div",{className:"bot-queue-prediction-header",children:[e.jsx("span",{className:"admin-user-avatar-sm",style:{background:d.avatar_color||"#6c5ce7",width:24,height:24,fontSize:10},children:(d.display_name||"?")[0].toUpperCase()}),e.jsx("strong",{className:"bot-queue-prediction-author",children:d.display_name}),e.jsxs("span",{className:"bot-queue-prediction-username",children:["@",d.username]})]}),e.jsx("div",{className:"bot-queue-prediction-match",children:d.match_description||"Match prediction"}),e.jsxs("div",{className:"bot-queue-prediction-text",children:["â€œ",d.prediction_text?.substring(0,100),d.prediction_text?.length>100?"...":"","â€"]}),e.jsxs("div",{className:"bot-queue-prediction-stats",children:[e.jsxs("span",{style:{color:"#2ecc71"},children:["ðŸ‘"," ",d.likes||0]}),e.jsxs("span",{style:{color:"#e74c3c"},children:["ðŸ‘Ž"," ",d.dislikes||0]}),e.jsxs("span",{style:{color:"#888"},children:["ðŸ’¬"," ",d.comment_count||0]})]})]},d.id)})}),R>1&&e.jsxs("div",{className:"bot-queue-pagination",children:[e.jsx("button",{onClick:()=>Ne(Te-1),disabled:Te<=1||ke,className:"bot-queue-page-btn",children:"Prev"}),e.jsxs("span",{className:"bot-queue-page-info",children:[Te," / ",R]}),e.jsx("button",{onClick:()=>Ne(Te+1),disabled:Te>=R||ke,className:"bot-queue-page-btn",children:"Next"})]})]}),E&&e.jsxs("div",{className:"bot-queue-selected-target",children:["Selected target: ",e.jsx("strong",{children:E}),e.jsx("button",{onClick:()=>h(""),className:"bot-queue-clear-target",children:"Clear"})]}),e.jsxs("div",{className:"bot-queue-field",children:[e.jsx("label",{className:"bot-queue-label",children:"Message Mode"}),e.jsxs("div",{className:"bot-queue-action-buttons",children:[e.jsx("button",{onClick:()=>{_("same"),x(!1)},className:`bot-queue-action-btn ${v==="same"?"bot-queue-action-btn-active":""}`,children:"Same Message"}),e.jsx("button",{onClick:()=>{_("varied"),x(!0)},className:`bot-queue-action-btn ${v==="varied"?"bot-queue-action-btn-active":""}`,children:"Varied (Cycle)"}),e.jsx("button",{onClick:()=>{_("bulk"),x(!1)},className:`bot-queue-action-btn ${v==="bulk"?"bot-queue-action-btn-active":""}`,children:"Bulk Paste"})]}),e.jsxs("div",{className:"bot-queue-toggle-hint",children:[v==="same"&&"All bots send the same message.",v==="varied"&&"Each bot sends a different message, cycling through the list below.",v==="bulk"&&"Paste one message per line. Each line goes to one bot in order."]})]}),v==="bulk"?e.jsxs("div",{className:"bot-queue-field",children:[e.jsxs("label",{className:"bot-queue-label",children:["Messages â€” one per line",e.jsxs("span",{className:"bot-queue-bulk-counter",style:{marginLeft:8,fontSize:12,color:y.split(`
`).filter(d=>d.trim()).length===(V?.length||0)?"#2ecc71":y.split(`
`).filter(d=>d.trim()).length<(V?.length||0)?"#e74c3c":"#f39c12"},children:[y.split(`
`).filter(d=>d.trim()).length," / ",V?.length||0," messages"]})]}),e.jsxs("div",{className:"bot-queue-textarea-wrap",children:[e.jsx("textarea",{ref:Z,value:y,onChange:d=>z(d.target.value),onFocus:()=>$("bulk"),className:"bot-queue-textarea bot-queue-bulk-textarea",placeholder:`Paste ${V?.length||"your"} messages here, one per line:
Great match so far! âš½
This team is on fire ðŸ”¥
Come on boys! ðŸ’ª
...`,rows:Math.min(Math.max(V?.length||5,5),20)}),e.jsxs("div",{className:"bot-queue-textarea-actions",children:[e.jsx("button",{type:"button",className:"bot-queue-emoji-btn",onClick:()=>{$("bulk"),c(!b),D(!1)},title:"Emojis",children:"ðŸ˜€"}),e.jsx("button",{type:"button",className:"bot-queue-gif-btn",onClick:()=>{$("bulk"),D(!n),c(!1)},title:"GIF",children:"GIF"})]}),b&&k==="bulk"&&e.jsx(ds,{onSelect:B}),n&&k==="bulk"&&e.jsx(ms,{onSelect:X,onClose:()=>D(!1)})]}),e.jsx("div",{className:"bot-queue-bulk-info",children:(()=>{const d=y.split(`
`).filter(te=>te.trim()).length,O=V?.length||0;return O===0?"Select bots first to see the message limit.":d===0?`Enter ${O} messages â€” one per line. Line 1 â†’ Bot 1, Line 2 â†’ Bot 2, etc.`:d<O?`Need ${O-d} more message${O-d>1?"s":""}. Each bot needs its own line.`:d===O?`Perfect! ${d} messages for ${O} bots.`:`${d} messages entered. Only the first ${O} will be used (one per bot).`})()})]}):v==="varied"?e.jsxs("div",{className:"bot-queue-field",children:[e.jsxs("label",{className:"bot-queue-label",children:["Messages (",F.length,"/10)"]}),F.map((d,O)=>e.jsxs("div",{className:"bot-queue-varied-message-row",children:[e.jsxs("span",{className:"bot-queue-varied-message-index",children:[O+1,"."]}),e.jsxs("div",{className:"bot-queue-textarea-wrap bot-queue-varied-wrap",children:[e.jsx("textarea",{ref:te=>{w.current[O]=te},value:d,onChange:te=>Ee(O,te.target.value),onFocus:()=>$(O),className:"bot-queue-textarea",placeholder:`Message variant ${O+1}...`,rows:2}),e.jsxs("div",{className:"bot-queue-textarea-actions",children:[e.jsx("button",{type:"button",className:"bot-queue-emoji-btn",onClick:()=>{$(O),c(!b),D(!1)},title:"Emojis",children:"ðŸ˜€"}),e.jsx("button",{type:"button",className:"bot-queue-gif-btn",onClick:()=>{$(O),D(!n),c(!1)},title:"GIF",children:"GIF"})]}),b&&k===O&&e.jsx(ds,{onSelect:B}),n&&k===O&&e.jsx(ms,{onSelect:X,onClose:()=>D(!1)})]}),F.length>2&&e.jsx("button",{onClick:()=>Ge(O),className:"bot-queue-remove-message-btn",title:"Remove this message",children:"âœ–"})]},O)),F.length<10&&e.jsx("button",{onClick:Pe,className:"bot-queue-add-message-btn",children:"+ Add another"})]}):e.jsxs("div",{className:"bot-queue-field",children:[e.jsx("label",{className:"bot-queue-label",children:"Message"}),e.jsxs("div",{className:"bot-queue-textarea-wrap",children:[e.jsx("textarea",{ref:ie,value:f,onChange:d=>o(d.target.value),onFocus:()=>$("same"),className:"bot-queue-textarea",placeholder:"Enter the message bots will send...",rows:3}),e.jsxs("div",{className:"bot-queue-textarea-actions",children:[e.jsx("button",{type:"button",className:"bot-queue-emoji-btn",onClick:()=>{$("same"),c(!b),D(!1)},title:"Emojis",children:"ðŸ˜€"}),e.jsx("button",{type:"button",className:"bot-queue-gif-btn",onClick:()=>{$("same"),D(!n),c(!1)},title:"GIF",children:"GIF"})]}),b&&k==="same"&&e.jsx(ds,{onSelect:B}),n&&k==="same"&&e.jsx(ms,{onSelect:X,onClose:()=>D(!1)})]})]}),e.jsxs("div",{className:"bot-queue-field",children:[e.jsx("label",{className:"bot-queue-label",children:"Delay Between Messages (seconds)"}),e.jsxs("div",{className:"bot-queue-delay-row",children:[e.jsxs("div",{className:"bot-queue-delay-input-group",children:[e.jsx("span",{className:"bot-queue-delay-label",children:"Min"}),e.jsx("input",{type:"number",value:G,onChange:d=>g(parseInt(d.target.value,10)||0),className:"bot-queue-delay-input",min:0})]}),e.jsx("span",{className:"bot-queue-delay-separator",children:"to"}),e.jsxs("div",{className:"bot-queue-delay-input-group",children:[e.jsx("span",{className:"bot-queue-delay-label",children:"Max"}),e.jsx("input",{type:"number",value:H,onChange:d=>I(parseInt(d.target.value,10)||0),className:"bot-queue-delay-input",min:0})]}),e.jsx("span",{className:"bot-queue-delay-hint",children:"seconds"})]})]}),e.jsxs("div",{className:"bot-queue-submit-row",children:[e.jsxs("div",{className:"bot-queue-bot-count",children:[e.jsx("span",{className:"bot-queue-bot-count-number",children:V?.length||0}),e.jsx("span",{className:"bot-queue-bot-count-label",children:"bots selected"})]}),e.jsx("button",{onClick:ss,disabled:N||!V||V.length===0,className:"bot-queue-start-btn",children:N?"Starting...":"Start Queue"})]})]}),e.jsxs("div",{className:"bot-queue-section",children:[e.jsxs("div",{className:"bot-queue-section-header",children:[e.jsx("h3",{className:"bot-queue-section-title",children:"Active Queues"}),e.jsx("button",{onClick:Le,className:"bot-queue-refresh-btn",children:"Refresh"})]}),me.length===0?e.jsx("div",{className:"bot-queue-empty-queues",children:"No active queues. Create one above to get started."}):e.jsx("div",{className:"bot-queue-cards",children:me.map(d=>{const O=Oe(d),te=O.completed||0,xe=O.total||1,we=Math.round(te/xe*100),Be=We(O.status||d.status),He=(O.status||d.status)==="running",Ke=O.estimated_duration||O.eta||0;return e.jsxs("div",{className:"bot-queue-card",children:[e.jsxs("div",{className:"bot-queue-card-header",children:[e.jsxs("div",{className:"bot-queue-card-id",children:[e.jsx("span",{className:"bot-queue-card-batch-label",children:"Batch"}),e.jsx("span",{className:"bot-queue-card-batch-id",children:(d.batch_id||"").substring(0,8)})]}),e.jsx("span",{className:"bot-queue-status-badge",style:{background:Be.background,color:Be.color,border:`1px solid ${Be.border}`},children:Be.text})]}),e.jsxs("div",{className:"bot-queue-card-info",children:[e.jsxs("div",{className:"bot-queue-card-info-row",children:[e.jsx("span",{className:"bot-queue-card-info-label",children:"Action:"}),e.jsx("span",{className:"bot-queue-card-info-value",children:vs.find(ts=>ts.value===(O.action||d.action))?.label||O.action||d.action})]}),e.jsxs("div",{className:"bot-queue-card-info-row",children:[e.jsx("span",{className:"bot-queue-card-info-label",children:"Target:"}),e.jsx("span",{className:"bot-queue-card-info-value",children:O.target_id||O.target||d.target_id||d.target||"-"})]})]}),e.jsxs("div",{className:"bot-queue-progress-container",children:[e.jsx("div",{className:"bot-queue-progress-bar",children:e.jsx("div",{className:"bot-queue-progress-fill",style:{width:`${we}%`,background:He?"#f1c40f":we===100?"#2ecc71":"#e74c3c"}})}),e.jsxs("div",{className:"bot-queue-progress-text",children:[te," / ",xe," (",we,"%)"]})]}),He&&Ke>0&&e.jsxs("div",{className:"bot-queue-eta",children:["ETA: ",as(Ke)]}),He&&e.jsx("button",{onClick:()=>ze(d.batch_id),className:"bot-queue-cancel-btn",children:"Cancel Queue"})]},d.batch_id)})})]}),e.jsx("style",{children:`
        .bot-queue-panel {
          display: flex;
          flex-direction: column;
          gap: 20px;
        }

        .bot-queue-section {
          background: #1e2130;
          border: 1px solid #2d313a;
          border-radius: 12px;
          padding: 20px;
        }

        .bot-queue-section-header {
          display: flex;
          align-items: center;
          justify-content: space-between;
          margin-bottom: 16px;
        }

        .bot-queue-section-title {
          margin: 0 0 16px 0;
          font-size: 16px;
          font-weight: 700;
          color: #e4e4e7;
        }

        .bot-queue-section-header .bot-queue-section-title {
          margin-bottom: 0;
        }

        .bot-queue-error {
          background: rgba(231,76,60,0.12);
          border: 1px solid rgba(231,76,60,0.25);
          color: #e74c3c;
          padding: 10px 14px;
          border-radius: 8px;
          margin-bottom: 14px;
          font-size: 13px;
        }

        .bot-queue-success {
          background: rgba(46,204,113,0.12);
          border: 1px solid rgba(46,204,113,0.25);
          color: #2ecc71;
          padding: 10px 14px;
          border-radius: 8px;
          margin-bottom: 14px;
          font-size: 13px;
        }

        .bot-queue-field {
          margin-bottom: 16px;
        }

        .bot-queue-label {
          display: flex;
          align-items: center;
          gap: 10px;
          margin-bottom: 6px;
          font-size: 12px;
          color: #8b8fa3;
          text-transform: uppercase;
          letter-spacing: 0.3px;
          font-weight: 600;
        }

        .bot-queue-action-buttons {
          display: flex;
          gap: 6px;
          flex-wrap: wrap;
        }

        .bot-queue-action-btn {
          padding: 7px 14px;
          border-radius: 6px;
          font-size: 12px;
          font-weight: 500;
          cursor: pointer;
          border: 1px solid #2d313a;
          background: transparent;
          color: #aaa;
          transition: all 0.15s;
        }

        .bot-queue-action-btn:hover {
          border-color: #6c5ce7;
          color: #ccc;
        }

        .bot-queue-action-btn-active {
          background: #6c5ce7;
          border-color: #6c5ce7;
          color: #fff;
        }

        .bot-queue-action-btn-active:hover {
          background: #5b4bd5;
          color: #fff;
        }

        .bot-queue-loading-text {
          text-align: center;
          padding: 20px;
          color: #888;
          font-size: 13px;
        }

        .bot-queue-empty-list {
          text-align: center;
          padding: 20px;
          color: #666;
          background: #1a1d23;
          border-radius: 8px;
          border: 1px solid #2d313a;
          font-size: 13px;
          display: flex;
          flex-direction: column;
          align-items: center;
          gap: 8px;
        }

        .bot-queue-target-list {
          max-height: 240px;
          overflow-y: auto;
          background: #1a1d23;
          border: 1px solid #2d313a;
          border-radius: 8px;
        }

        .bot-queue-target-item {
          display: flex;
          align-items: center;
          gap: 10px;
          padding: 10px 14px;
          cursor: pointer;
          border-bottom: 1px solid #2d313a;
          border-left: 3px solid transparent;
          transition: background 0.12s;
          flex-direction: column;
          align-items: stretch;
        }

        .bot-queue-target-item:last-child {
          border-bottom: none;
        }

        .bot-queue-target-item:hover {
          background: rgba(255,255,255,0.03);
        }

        .bot-queue-target-item-selected {
          background: rgba(108,92,231,0.15);
          border-left-color: #6c5ce7;
        }

        .bot-queue-target-item-selected:hover {
          background: rgba(108,92,231,0.18);
        }

        /* Match specific styles within target item */
        .bot-queue-target-item[class*="match"] {
          flex-direction: row;
          align-items: center;
        }

        .bot-queue-target-item-main {
          flex: 1;
          min-width: 0;
        }

        .bot-queue-match-teams {
          font-size: 13px;
          font-weight: 600;
          color: #e4e4e7;
        }

        .bot-queue-match-details {
          font-size: 11px;
          color: #8b8fa3;
          margin-top: 2px;
        }

        .bot-queue-match-status {
          padding: 2px 8px;
          border-radius: 4px;
          font-size: 11px;
          font-weight: 600;
          white-space: nowrap;
          flex-shrink: 0;
          align-self: center;
        }

        .bot-queue-match-live {
          background: rgba(231,76,60,0.15);
          color: #e74c3c;
        }

        .bot-queue-match-scheduled {
          background: rgba(52,152,219,0.15);
          color: #3498db;
        }

        /* Match target items should be row layout */
        .bot-queue-field .bot-queue-target-list .bot-queue-target-item:has(.bot-queue-target-item-main) {
          flex-direction: row;
          align-items: center;
        }

        .bot-queue-prediction-header {
          display: flex;
          align-items: center;
          gap: 8px;
          margin-bottom: 4px;
        }

        .bot-queue-prediction-author {
          font-size: 13px;
          color: #e4e4e7;
        }

        .bot-queue-prediction-username {
          color: #666;
          font-size: 11px;
        }

        .bot-queue-prediction-match {
          font-size: 12px;
          color: #b0b3c6;
          margin-bottom: 3px;
        }

        .bot-queue-prediction-text {
          font-size: 12px;
          color: #8b8fa3;
          font-style: italic;
          margin-bottom: 6px;
        }

        .bot-queue-prediction-stats {
          display: flex;
          align-items: center;
          gap: 12px;
          font-size: 11px;
        }

        .bot-queue-pagination {
          display: flex;
          gap: 4px;
          justify-content: center;
          margin-top: 8px;
          align-items: center;
        }

        .bot-queue-page-btn {
          background: none;
          border: 1px solid #2d313a;
          color: #aaa;
          border-radius: 4px;
          padding: 3px 10px;
          cursor: pointer;
          font-size: 12px;
        }

        .bot-queue-page-btn:disabled {
          opacity: 0.4;
          cursor: not-allowed;
        }

        .bot-queue-page-info {
          font-size: 12px;
          color: #888;
          padding: 3px 8px;
        }

        .bot-queue-refresh-btn {
          background: none;
          border: none;
          color: #6c5ce7;
          cursor: pointer;
          font-size: 12px;
          padding: 2px 4px;
        }

        .bot-queue-refresh-btn:hover {
          text-decoration: underline;
        }

        .bot-queue-selected-target {
          display: flex;
          align-items: center;
          gap: 8px;
          padding: 8px 12px;
          margin-bottom: 14px;
          background: rgba(108,92,231,0.08);
          border: 1px solid rgba(108,92,231,0.2);
          border-radius: 6px;
          font-size: 13px;
          color: #b0b3c6;
        }

        .bot-queue-selected-target strong {
          color: #a29bfe;
        }

        .bot-queue-clear-target {
          background: none;
          border: none;
          color: #e74c3c;
          cursor: pointer;
          font-size: 12px;
          margin-left: auto;
        }

        .bot-queue-toggle {
          padding: 3px 10px;
          border-radius: 12px;
          font-size: 11px;
          font-weight: 600;
          cursor: pointer;
          border: 1px solid;
          transition: all 0.15s;
        }

        .bot-queue-toggle-on {
          background: rgba(46,204,113,0.15);
          border-color: rgba(46,204,113,0.3);
          color: #2ecc71;
        }

        .bot-queue-toggle-off {
          background: rgba(149,165,166,0.1);
          border-color: #2d313a;
          color: #95a5a6;
        }

        .bot-queue-toggle-hint {
          font-size: 11px;
          color: #666;
          margin-top: 2px;
        }

        .bot-queue-textarea {
          width: 100%;
          background: #161822;
          border: 1px solid #2d313a;
          border-radius: 6px;
          color: #e4e4e7;
          padding: 10px 12px;
          font-size: 13px;
          font-family: inherit;
          resize: vertical;
          outline: none;
          box-sizing: border-box;
        }

        .bot-queue-textarea:focus {
          border-color: #6c5ce7;
        }

        .bot-queue-textarea::placeholder {
          color: #555;
        }

        .bot-queue-varied-message-row {
          display: flex;
          align-items: flex-start;
          gap: 8px;
          margin-bottom: 8px;
        }

        .bot-queue-varied-message-index {
          font-size: 12px;
          color: #8b8fa3;
          font-weight: 600;
          min-width: 20px;
          padding-top: 10px;
          text-align: right;
        }

        .bot-queue-varied-message-row .bot-queue-textarea {
          flex: 1;
        }

        .bot-queue-remove-message-btn {
          background: none;
          border: none;
          color: #e74c3c;
          cursor: pointer;
          font-size: 14px;
          padding: 8px 4px;
          line-height: 1;
          flex-shrink: 0;
        }

        .bot-queue-remove-message-btn:hover {
          color: #ff6b6b;
        }

        .bot-queue-add-message-btn {
          background: none;
          border: 1px dashed #2d313a;
          color: #6c5ce7;
          cursor: pointer;
          font-size: 12px;
          padding: 6px 14px;
          border-radius: 6px;
          width: 100%;
          transition: border-color 0.15s;
        }

        .bot-queue-add-message-btn:hover {
          border-color: #6c5ce7;
        }

        .bot-queue-delay-row {
          display: flex;
          align-items: center;
          gap: 10px;
          flex-wrap: wrap;
        }

        .bot-queue-delay-input-group {
          display: flex;
          align-items: center;
          gap: 6px;
        }

        .bot-queue-delay-label {
          font-size: 12px;
          color: #8b8fa3;
        }

        .bot-queue-delay-input {
          width: 80px;
          background: #161822;
          border: 1px solid #2d313a;
          border-radius: 6px;
          color: #e4e4e7;
          padding: 6px 10px;
          font-size: 13px;
          outline: none;
          text-align: center;
        }

        .bot-queue-delay-input:focus {
          border-color: #6c5ce7;
        }

        .bot-queue-delay-separator {
          font-size: 13px;
          color: #666;
        }

        .bot-queue-delay-hint {
          font-size: 11px;
          color: #666;
        }

        .bot-queue-submit-row {
          display: flex;
          align-items: center;
          justify-content: space-between;
          padding-top: 14px;
          border-top: 1px solid #2d313a;
          margin-top: 4px;
        }

        .bot-queue-bot-count {
          display: flex;
          align-items: center;
          gap: 6px;
        }

        .bot-queue-bot-count-number {
          font-size: 22px;
          font-weight: 700;
          color: #a29bfe;
        }

        .bot-queue-bot-count-label {
          font-size: 13px;
          color: #8b8fa3;
        }

        .bot-queue-start-btn {
          padding: 10px 28px;
          border-radius: 8px;
          font-size: 14px;
          font-weight: 600;
          cursor: pointer;
          border: none;
          background: #6c5ce7;
          color: #fff;
          transition: background 0.15s;
        }

        .bot-queue-start-btn:hover:not(:disabled) {
          background: #5b4bd5;
        }

        .bot-queue-start-btn:disabled {
          opacity: 0.4;
          cursor: not-allowed;
        }

        /* Active Queues */
        .bot-queue-empty-queues {
          text-align: center;
          padding: 30px 20px;
          color: #555;
          font-size: 13px;
        }

        .bot-queue-cards {
          display: flex;
          flex-direction: column;
          gap: 12px;
        }

        .bot-queue-card {
          background: #161822;
          border: 1px solid #2d313a;
          border-radius: 10px;
          padding: 16px;
        }

        .bot-queue-card-header {
          display: flex;
          align-items: center;
          justify-content: space-between;
          margin-bottom: 10px;
        }

        .bot-queue-card-id {
          display: flex;
          align-items: center;
          gap: 6px;
        }

        .bot-queue-card-batch-label {
          font-size: 11px;
          color: #8b8fa3;
          text-transform: uppercase;
        }

        .bot-queue-card-batch-id {
          font-size: 13px;
          font-weight: 600;
          color: #e4e4e7;
          font-family: monospace;
        }

        .bot-queue-status-badge {
          padding: 3px 10px;
          border-radius: 12px;
          font-size: 11px;
          font-weight: 600;
        }

        .bot-queue-card-info {
          margin-bottom: 12px;
        }

        .bot-queue-card-info-row {
          display: flex;
          gap: 8px;
          font-size: 12px;
          margin-bottom: 2px;
        }

        .bot-queue-card-info-label {
          color: #8b8fa3;
          min-width: 50px;
        }

        .bot-queue-card-info-value {
          color: #b0b3c6;
          font-weight: 500;
        }

        .bot-queue-progress-container {
          margin-bottom: 8px;
        }

        .bot-queue-progress-bar {
          width: 100%;
          height: 8px;
          background: #2d313a;
          border-radius: 4px;
          overflow: hidden;
          margin-bottom: 4px;
        }

        .bot-queue-progress-fill {
          height: 100%;
          border-radius: 4px;
          transition: width 0.4s ease;
        }

        .bot-queue-progress-text {
          font-size: 12px;
          color: #8b8fa3;
          text-align: right;
        }

        .bot-queue-eta {
          font-size: 12px;
          color: #f1c40f;
          margin-bottom: 8px;
        }

        .bot-queue-cancel-btn {
          padding: 5px 14px;
          border-radius: 6px;
          font-size: 12px;
          font-weight: 500;
          cursor: pointer;
          border: 1px solid rgba(231,76,60,0.3);
          background: rgba(231,76,60,0.1);
          color: #e74c3c;
          transition: all 0.15s;
        }

        .bot-queue-cancel-btn:hover {
          background: rgba(231,76,60,0.2);
          border-color: rgba(231,76,60,0.5);
        }

        /* Emoji & GIF picker styles */
        .bot-queue-textarea-wrap {
          position: relative;
        }

        .bot-queue-varied-wrap {
          flex: 1;
        }

        .bot-queue-textarea-actions {
          position: absolute;
          bottom: 8px;
          right: 10px;
          display: flex;
          gap: 4px;
          z-index: 2;
        }

        .bot-queue-emoji-btn,
        .bot-queue-gif-btn {
          width: 30px;
          height: 30px;
          border-radius: 50%;
          border: 1px solid #2d313a;
          background: #1e2130;
          cursor: pointer;
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 16px;
          transition: all 0.15s;
        }

        .bot-queue-gif-btn {
          font-size: 10px;
          font-weight: 700;
          color: #a29bfe;
          width: 34px;
        }

        .bot-queue-emoji-btn:hover,
        .bot-queue-gif-btn:hover {
          border-color: #6c5ce7;
          background: rgba(108,92,231,0.15);
        }

        .bot-emoji-picker {
          position: absolute;
          bottom: 44px;
          right: 0;
          background: #1e2130;
          border: 1px solid #2d313a;
          border-radius: 10px;
          padding: 8px;
          z-index: 50;
          box-shadow: 0 8px 24px rgba(0,0,0,0.4);
          width: 260px;
        }

        .bot-emoji-picker-grid {
          display: grid;
          grid-template-columns: repeat(9, 1fr);
          gap: 2px;
        }

        .bot-emoji-picker-btn {
          background: none;
          border: none;
          font-size: 18px;
          cursor: pointer;
          padding: 4px;
          border-radius: 6px;
          transition: background 0.12s;
        }

        .bot-emoji-picker-btn:hover {
          background: rgba(108,92,231,0.2);
        }

        .bot-gif-picker {
          position: absolute;
          bottom: 44px;
          right: 0;
          background: #1e2130;
          border: 1px solid #2d313a;
          border-radius: 10px;
          z-index: 50;
          box-shadow: 0 8px 24px rgba(0,0,0,0.4);
          width: 320px;
          height: 340px;
          display: flex;
          flex-direction: column;
          overflow: hidden;
        }

        .bot-gif-picker-header {
          display: flex;
          align-items: center;
          gap: 6px;
          padding: 8px;
          border-bottom: 1px solid #2d313a;
        }

        .bot-gif-search-input {
          flex: 1;
          background: #161822;
          border: 1px solid #2d313a;
          border-radius: 6px;
          padding: 6px 10px;
          color: #e4e4e7;
          font-size: 13px;
          outline: none;
        }

        .bot-gif-search-input:focus {
          border-color: #6c5ce7;
        }

        .bot-gif-picker-close {
          background: none;
          border: none;
          color: #8b8fa3;
          font-size: 14px;
          cursor: pointer;
          padding: 4px 6px;
          border-radius: 4px;
        }

        .bot-gif-picker-close:hover {
          color: #fff;
          background: rgba(255,255,255,0.1);
        }

        .bot-gif-picker-grid {
          display: grid;
          grid-template-columns: repeat(2, 1fr);
          gap: 4px;
          padding: 6px;
          overflow-y: auto;
          flex: 1;
          min-height: 0;
        }

        .bot-gif-picker-item {
          background: #161822;
          border: none;
          cursor: pointer;
          border-radius: 6px;
          overflow: hidden;
          padding: 0;
          height: 90px;
          position: relative;
          transition: transform 0.15s;
        }

        .bot-gif-picker-item:hover {
          transform: scale(1.03);
          box-shadow: 0 0 0 2px #6c5ce7;
        }

        .bot-gif-picker-item img {
          width: 100%;
          height: 100%;
          object-fit: cover;
          display: block;
        }

        .bot-gif-loading,
        .bot-gif-empty {
          grid-column: 1 / -1;
          text-align: center;
          color: #666;
          font-size: 13px;
          padding: 20px;
        }

        .bot-gif-picker-powered {
          text-align: center;
          font-size: 10px;
          color: #555;
          padding: 4px;
          border-top: 1px solid #2d313a;
        }

        .bot-queue-varied-message-row {
          display: flex;
          align-items: flex-start;
          gap: 8px;
          margin-bottom: 8px;
        }
      `})]})}const qa=[{value:30,label:"30 minutes"},{value:60,label:"1 hour"},{value:360,label:"6 hours"},{value:1440,label:"24 hours"}];function Fa({getAuthHeaders:a}){const[t,j]=s.useState([]),[p,E]=s.useState(!0),[h,f]=s.useState(60),[o,v]=s.useState(!0),[_,C]=s.useState(null),[x,F]=s.useState(""),[q,y]=s.useState(""),[z,G]=s.useState(!1),[g,H]=s.useState([]),[I,N]=s.useState(!1),P=s.useRef(null),K=s.useCallback(async()=>{try{const k=await T.get("/api/admin/bots/chat-activity",{headers:a(),params:{since_minutes:h,limit:200}});j(k.data.conversations||[])}catch(k){console.error("Failed to fetch bot chat activity:",k)}E(!1)},[a,h]),U=s.useCallback(async()=>{if(!I)try{const k=await T.get("/api/admin/bots",{headers:a(),params:{is_active:1,per_page:100}});H(k.data.bots||[]),N(!0)}catch(k){console.error("Failed to fetch active bots:",k)}},[a,I]);s.useEffect(()=>{E(!0),K()},[K]),s.useEffect(()=>(P.current&&(clearInterval(P.current),P.current=null),o&&(P.current=setInterval(()=>{K()},5e3)),()=>{P.current&&(clearInterval(P.current),P.current=null)}),[o,K]),s.useEffect(()=>{_&&U()},[_,U]);const u=()=>{E(!0),K()},J=(k,$)=>{C({messageId:k,matchKey:$}),F(""),y("")},b=()=>{C(null),F(""),y("")},c=async()=>{if(!(!x||!q.trim()||!_)){G(!0);try{await T.post("/api/admin/bots/action",{bot_id:parseInt(x,10),action:"match_chat",target_id:_.matchKey,message:q.trim()},{headers:a()}),b(),K()}catch(k){console.error("Failed to send bot reply:",k),alert(k.response?.data?.detail||"Failed to send reply")}G(!1)}},n=k=>{if(!k)return"";const $=new Date(k),Z=new Date-$,w=Math.floor(Z/6e4);if(w<1)return"just now";if(w<60)return`${w}m ago`;const B=Math.floor(w/60);return B<24?`${B}h ago`:$.toLocaleDateString()+" "+$.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})},D=k=>k?k.charAt(0).toUpperCase():"?";return e.jsxs("div",{className:"bot-reply-container",children:[e.jsxs("div",{className:"bot-reply-filters",children:[e.jsxs("div",{className:"bot-reply-filters-left",children:[e.jsx("label",{className:"bot-reply-filter-label",children:"Time range:"}),e.jsx("select",{className:"bot-reply-select",value:h,onChange:k=>f(parseInt(k.target.value,10)),children:qa.map(k=>e.jsx("option",{value:k.value,children:k.label},k.value))}),e.jsxs("label",{className:"bot-reply-auto-refresh-label",children:[e.jsx("input",{type:"checkbox",checked:o,onChange:k=>v(k.target.checked),className:"bot-reply-checkbox"}),"Auto-refresh"]})]}),e.jsx("button",{className:"bot-reply-refresh-btn",onClick:u,disabled:p,children:p?"Refreshing...":"Refresh"})]}),p&&t.length===0?e.jsx("div",{className:"bot-reply-loading",children:"Loading conversations..."}):t.length===0?e.jsx("div",{className:"bot-reply-empty",children:"No bot conversations found in the selected time range"}):e.jsx("div",{className:"bot-reply-conversations",children:t.map(k=>{const $=k.match_key||k.matchKey||"unknown",ie=k.messages||[];return e.jsxs("div",{className:"bot-reply-conversation-block",children:[e.jsxs("div",{className:"bot-reply-conversation-header",children:["Match: ",$]}),e.jsx("div",{className:"bot-reply-messages",children:ie.map(Z=>{const w=!!Z.is_bot,B=!!Z.is_reply_to_bot,X=Z.id||Z.message_id||`${$}-${Z.timestamp}-${Z.user_id}`;return e.jsxs("div",{children:[e.jsx("div",{className:"bot-reply-message"+(w?" bot-reply-message-bot":" bot-reply-message-human")+(B?" bot-reply-message-highlighted":""),children:e.jsxs("div",{className:"bot-reply-message-row",children:[e.jsx("span",{className:"bot-reply-avatar",style:{backgroundColor:Z.avatar_color||(w?"#6c5ce7":"#e67e22")},children:D(Z.display_name)}),e.jsxs("div",{className:"bot-reply-message-content",children:[e.jsxs("div",{className:"bot-reply-message-header",children:[w&&e.jsx("span",{className:"bot-reply-bot-badge",children:"BOT"}),e.jsx("span",{className:"bot-reply-display-name",children:Z.display_name||"Unknown"}),e.jsx("span",{className:"bot-reply-timestamp",children:n(Z.timestamp||Z.created_at)})]}),e.jsx("div",{className:"bot-reply-message-text",children:Z.message||Z.content||""})]}),!w&&e.jsx("button",{className:"bot-reply-reply-btn",onClick:()=>J(X,$),children:"Reply"})]})}),_&&_.messageId===X&&_.matchKey===$&&e.jsx("div",{className:"bot-reply-form",children:e.jsxs("div",{className:"bot-reply-form-row",children:[e.jsxs("select",{className:"bot-reply-bot-select",value:x,onChange:W=>F(W.target.value),children:[e.jsx("option",{value:"",children:"-- Select Bot --"}),g.map(W=>e.jsxs("option",{value:W.id,children:[W.display_name||W.username," (@",W.username,")"]},W.id))]}),e.jsx("input",{type:"text",className:"bot-reply-form-input",value:q,onChange:W=>y(W.target.value),placeholder:"Type a reply message...",onKeyDown:W=>{W.key==="Enter"&&!W.shiftKey&&(W.preventDefault(),c())}}),e.jsx("button",{className:"bot-reply-send-btn",onClick:c,disabled:!x||!q.trim()||z,children:z?"Sending...":"Send"}),e.jsx("button",{className:"bot-reply-cancel-btn",onClick:b,children:"Cancel"})]})})]},X)})})]},$)})}),e.jsx("style",{children:`
        .bot-reply-container {
          width: 100%;
        }

        .bot-reply-filters {
          display: flex;
          align-items: center;
          justify-content: space-between;
          gap: 12px;
          padding: 12px 16px;
          background: #1e2130;
          border: 1px solid #2d313a;
          border-radius: 10px;
          margin-bottom: 16px;
          flex-wrap: wrap;
        }

        .bot-reply-filters-left {
          display: flex;
          align-items: center;
          gap: 12px;
          flex-wrap: wrap;
        }

        .bot-reply-filter-label {
          font-size: 13px;
          color: #8b8fa3;
          font-weight: 500;
        }

        .bot-reply-select {
          background: #161822;
          border: 1px solid #2d313a;
          color: #e4e4e7;
          padding: 6px 12px;
          border-radius: 6px;
          font-size: 13px;
          cursor: pointer;
          outline: none;
        }

        .bot-reply-select:focus {
          border-color: #6c5ce7;
        }

        .bot-reply-auto-refresh-label {
          display: flex;
          align-items: center;
          gap: 6px;
          font-size: 13px;
          color: #b0b3c6;
          cursor: pointer;
          user-select: none;
        }

        .bot-reply-checkbox {
          accent-color: #6c5ce7;
          cursor: pointer;
        }

        .bot-reply-refresh-btn {
          background: #6c5ce7;
          border: none;
          color: #fff;
          padding: 6px 16px;
          border-radius: 6px;
          font-size: 13px;
          font-weight: 600;
          cursor: pointer;
          transition: background 0.2s;
        }

        .bot-reply-refresh-btn:hover {
          background: #5b4cdb;
        }

        .bot-reply-refresh-btn:disabled {
          opacity: 0.6;
          cursor: not-allowed;
        }

        .bot-reply-loading {
          text-align: center;
          padding: 40px 20px;
          color: #8b8fa3;
          font-size: 14px;
        }

        .bot-reply-empty {
          text-align: center;
          padding: 60px 20px;
          color: #666;
          font-size: 14px;
          background: #1e2130;
          border: 1px solid #2d313a;
          border-radius: 10px;
        }

        .bot-reply-conversations {
          display: flex;
          flex-direction: column;
          gap: 16px;
        }

        .bot-reply-conversation-block {
          background: #1e2130;
          border: 1px solid #2d313a;
          border-radius: 10px;
          overflow: hidden;
        }

        .bot-reply-conversation-header {
          padding: 12px 16px;
          font-size: 14px;
          font-weight: 700;
          color: #e4e4e7;
          background: #161822;
          border-bottom: 1px solid #2d313a;
          letter-spacing: 0.3px;
        }

        .bot-reply-messages {
          display: flex;
          flex-direction: column;
        }

        .bot-reply-message {
          padding: 10px 16px;
          border-bottom: 1px solid rgba(45, 49, 58, 0.5);
        }

        .bot-reply-message:last-child {
          border-bottom: none;
        }

        .bot-reply-message-bot {
          border-left: 3px solid #6c5ce7;
        }

        .bot-reply-message-human {
          border-left: 3px solid #e67e22;
        }

        .bot-reply-message-highlighted {
          background: rgba(230, 126, 34, 0.08);
        }

        .bot-reply-message-row {
          display: flex;
          align-items: flex-start;
          gap: 10px;
        }

        .bot-reply-avatar {
          width: 32px;
          height: 32px;
          min-width: 32px;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 13px;
          font-weight: 700;
          color: #fff;
          flex-shrink: 0;
        }

        .bot-reply-message-content {
          flex: 1;
          min-width: 0;
        }

        .bot-reply-message-header {
          display: flex;
          align-items: center;
          gap: 8px;
          margin-bottom: 3px;
          flex-wrap: wrap;
        }

        .bot-reply-bot-badge {
          display: inline-block;
          background: #6c5ce7;
          color: #fff;
          font-size: 10px;
          font-weight: 700;
          padding: 1px 6px;
          border-radius: 4px;
          letter-spacing: 0.5px;
          text-transform: uppercase;
          line-height: 1.4;
        }

        .bot-reply-display-name {
          font-size: 13px;
          font-weight: 600;
          color: #e4e4e7;
        }

        .bot-reply-timestamp {
          font-size: 11px;
          color: #666;
          margin-left: auto;
        }

        .bot-reply-message-text {
          font-size: 13px;
          color: #b0b3c6;
          line-height: 1.5;
          word-break: break-word;
        }

        .bot-reply-reply-btn {
          background: rgba(108, 92, 231, 0.12);
          border: 1px solid rgba(108, 92, 231, 0.25);
          color: #a29bfe;
          padding: 4px 12px;
          border-radius: 5px;
          font-size: 12px;
          font-weight: 500;
          cursor: pointer;
          white-space: nowrap;
          flex-shrink: 0;
          transition: background 0.2s;
        }

        .bot-reply-reply-btn:hover {
          background: rgba(108, 92, 231, 0.22);
        }

        .bot-reply-form {
          padding: 10px 16px 10px 58px;
          background: rgba(108, 92, 231, 0.05);
          border-bottom: 1px solid rgba(45, 49, 58, 0.5);
        }

        .bot-reply-form-row {
          display: flex;
          align-items: center;
          gap: 8px;
          flex-wrap: wrap;
        }

        .bot-reply-bot-select {
          background: #161822;
          border: 1px solid #2d313a;
          color: #e4e4e7;
          padding: 7px 10px;
          border-radius: 6px;
          font-size: 12px;
          cursor: pointer;
          outline: none;
          min-width: 180px;
        }

        .bot-reply-bot-select:focus {
          border-color: #6c5ce7;
        }

        .bot-reply-form-input {
          flex: 1;
          min-width: 200px;
          background: #161822;
          border: 1px solid #2d313a;
          color: #e4e4e7;
          padding: 7px 12px;
          border-radius: 6px;
          font-size: 13px;
          outline: none;
        }

        .bot-reply-form-input:focus {
          border-color: #6c5ce7;
        }

        .bot-reply-form-input::placeholder {
          color: #555;
        }

        .bot-reply-send-btn {
          background: #6c5ce7;
          border: none;
          color: #fff;
          padding: 7px 16px;
          border-radius: 6px;
          font-size: 12px;
          font-weight: 600;
          cursor: pointer;
          white-space: nowrap;
          transition: background 0.2s;
        }

        .bot-reply-send-btn:hover {
          background: #5b4cdb;
        }

        .bot-reply-send-btn:disabled {
          opacity: 0.5;
          cursor: not-allowed;
        }

        .bot-reply-cancel-btn {
          background: transparent;
          border: 1px solid #2d313a;
          color: #8b8fa3;
          padding: 7px 14px;
          border-radius: 6px;
          font-size: 12px;
          font-weight: 500;
          cursor: pointer;
          white-space: nowrap;
          transition: border-color 0.2s, color 0.2s;
        }

        .bot-reply-cancel-btn:hover {
          border-color: #e74c3c;
          color: #e74c3c;
        }
      `})]})}const Ua={LIVE:{bg:"rgba(231,76,60,0.15)",color:"#e74c3c"},"1H":{bg:"rgba(231,76,60,0.15)",color:"#e74c3c"},"2H":{bg:"rgba(231,76,60,0.15)",color:"#e74c3c"},HT:{bg:"rgba(241,196,15,0.15)",color:"#f1c40f"},ET:{bg:"rgba(231,76,60,0.15)",color:"#e74c3c"},FT:{bg:"rgba(149,165,166,0.15)",color:"#95a5a6"},AET:{bg:"rgba(149,165,166,0.15)",color:"#95a5a6"},PEN:{bg:"rgba(149,165,166,0.15)",color:"#95a5a6"},NS:{bg:"rgba(52,152,219,0.15)",color:"#3498db"},TBD:{bg:"rgba(52,152,219,0.15)",color:"#3498db"}};function Ba(a){const t=(a||"").toUpperCase();return Ua[t]||{bg:"rgba(108,92,231,0.15)",color:"#a29bfe"}}function Ia(a){const t=(a||"").toUpperCase();return["1H","2H","ET","LIVE"].includes(t)?"LIVE":t==="HT"?"HT":["FT","AET","PEN"].includes(t)?"FT":["NS","TBD"].includes(t)?"Scheduled":t||"Unknown"}function za({getAuthHeaders:a,selectedBotIds:t}){const[j,p]=s.useState("single"),[E,h]=s.useState([]),[f,o]=s.useState(!1),[v,_]=s.useState(""),[C,x]=s.useState(null),[F,q]=s.useState([]),[y,z]=s.useState(!1),[G,g]=s.useState(""),[H,I]=s.useState(""),[N,P]=s.useState(""),[K,U]=s.useState("skip"),[u,J]=s.useState("skip"),[b,c]=s.useState(""),[n,D]=s.useState(!1),[k,$]=s.useState(""),[ie,Z]=s.useState(""),[w,B]=s.useState("skip"),[X,W]=s.useState("skip"),[ee,M]=s.useState(""),[ae,A]=s.useState([{predicted_result:"",analysis_summary:""},{predicted_result:"",analysis_summary:""}]),[S,m]=s.useState(null),[r,Y]=s.useState(!1),[se,V]=s.useState(!0),[l,re]=s.useState(!1),[Se,ve]=s.useState(null),Ce=s.useCallback(async()=>{o(!0);try{const L=await T.get("/api/admin/bots/live-matches",{headers:a()});h(L.data?.matches||L.data||[])}catch(L){console.error("Failed to fetch matches:",L),h([])}finally{o(!1)}},[a]),Ae=s.useCallback(async()=>{z(!0);try{const L=await T.get("/api/admin/bots",{params:{is_active:1,per_page:100},headers:a()}),oe=L.data?.bots||L.data||[];q(oe)}catch(L){console.error("Failed to fetch bots:",L),q([])}finally{z(!1)}},[a]);s.useEffect(()=>{Ce()},[Ce]),s.useEffect(()=>{j==="single"&&Ae()},[j,Ae]);const ke=E.filter(L=>{if(!v.trim())return!0;const oe=v.toLowerCase(),ge=(L.home_team||"").toLowerCase(),je=(L.away_team||"").toLowerCase(),be=(L.league||"").toLowerCase();return ge.includes(oe)||je.includes(oe)||be.includes(oe)}),ye=L=>{const oe=L.match_key||L.id,ge=C?.match_key||C?.id;oe===ge?(x(null),m(null)):(x(L),Te(L)),ve(null)},Te=async L=>{if(!L.home_team_id||!L.away_team_id){m(null);return}Y(!0),m(null);try{const oe=L.league_code||"PL",[ge,je]=await Promise.allSettled([T.post("/api/predict",{team_a_id:L.home_team_id,team_b_id:L.away_team_id,venue:"team_a",competition:oe,team_a_name:L.home_team,team_b_name:L.away_team}),T.get(`/api/h2h-analysis/${L.home_team_id}/${L.away_team_id}?competition=${oe}`)]),be=ge.status==="fulfilled"?ge.value.data:null,Ne=je.status==="fulfilled"?je.value.data:null;m({prediction:be,h2h:Ne})}catch{m(null)}Y(!1)},$e=(L,oe,ge)=>{A(je=>{const be=[...je];return be[L]={...be[L],[oe]:ge},be})},R=()=>{ae.length>=5||A(L=>[...L,{predicted_result:"",analysis_summary:""}])},le=L=>{ae.length<=2||A(oe=>oe.filter((ge,je)=>je!==L))},me=()=>{I(""),P(""),U("skip"),J("skip"),c(""),$(""),Z(""),B("skip"),W("skip"),M(""),A([{predicted_result:"",analysis_summary:""},{predicted_result:"",analysis_summary:""}])},de=async()=>{if(!C||!G||!H.trim())return;re(!0),ve(null);const L=C.match_key||C.id,oe=C.home_team||"",ge=C.away_team||"",je=C.league||"";try{const be={bot_id:parseInt(G,10),fixture_id:L,team_a_name:oe,team_b_name:ge,competition:je,predicted_result:H.trim(),analysis_summary:N.trim(),predicted_over25:K!=="skip"?K:null,predicted_btts:u!=="skip"?u:null,odds:b?parseFloat(b):null};await T.post("/api/admin/bots/create-prediction",be,{headers:a()}),ve({type:"success",text:"Prediction created successfully!"}),me()}catch(be){const Ne=be.response?.data?.detail||"Failed to create prediction";ve({type:"error",text:typeof Ne=="string"?Ne:JSON.stringify(Ne)})}finally{re(!1)}},ue=async()=>{if(!C||!t||t.length===0)return;re(!0),ve(null);const L=C.match_key||C.id,oe=C.home_team||"",ge=C.away_team||"",je=C.league||"";try{let be;if(n){const Me=ae.filter(Pe=>Pe.predicted_result.trim());if(Me.length===0){ve({type:"error",text:"At least one variation must have a predicted result."}),re(!1);return}be=Me.map(Pe=>({predicted_result:Pe.predicted_result.trim(),analysis_summary:Pe.analysis_summary.trim(),predicted_over25:w!=="skip"?w:null,predicted_btts:X!=="skip"?X:null,odds:ee?parseFloat(ee):null}))}else{if(!k.trim()){ve({type:"error",text:"Please enter a predicted result."}),re(!1);return}be=[{predicted_result:k.trim(),analysis_summary:ie.trim(),predicted_over25:w!=="skip"?w:null,predicted_btts:X!=="skip"?X:null,odds:ee?parseFloat(ee):null}]}const Ne={bot_ids:t,fixture_id:L,team_a_name:oe,team_b_name:ge,competition:je,predictions:be},Le=await T.post("/api/admin/bots/batch-create-prediction",Ne,{headers:a()}),ze=Le.data?.successes||Le.data?.created||t.length,De=Le.data?.total||t.length;ve({type:"success",text:`Predictions created for ${ze}/${De} bots.`}),me()}catch(be){const Ne=be.response?.data?.detail||"Failed to create batch predictions";ve({type:"error",text:typeof Ne=="string"?Ne:JSON.stringify(Ne)})}finally{re(!1)}},he=C?.match_key||C?.id;return e.jsxs("div",{className:"bot-pred-container",children:[e.jsxs("div",{className:"bot-pred-mode-toggle",children:[e.jsx("button",{className:`bot-pred-mode-btn ${j==="single"?"bot-pred-mode-btn-active":""}`,onClick:()=>{p("single"),ve(null)},children:"Single Bot"}),e.jsx("button",{className:`bot-pred-mode-btn ${j==="batch"?"bot-pred-mode-btn-active":""}`,onClick:()=>{p("batch"),ve(null)},children:"Batch"})]}),Se&&e.jsxs("div",{className:`bot-pred-message ${Se.type==="success"?"bot-pred-message-success":"bot-pred-message-error"}`,children:[Se.text,e.jsx("button",{className:"bot-pred-message-close",onClick:()=>ve(null),children:"x"})]}),e.jsxs("div",{className:"bot-pred-layout",children:[e.jsxs("div",{className:"bot-pred-matches-panel",children:[e.jsxs("div",{className:"bot-pred-matches-header",children:[e.jsx("h4",{className:"bot-pred-matches-title",children:"Select Match"}),e.jsx("button",{className:"bot-pred-refresh-btn",onClick:Ce,disabled:f,title:"Refresh matches",children:f?"Loading...":"Refresh"})]}),e.jsx("input",{type:"text",className:"bot-pred-search",placeholder:"Search matches...",value:v,onChange:L=>_(L.target.value)}),e.jsxs("div",{className:"bot-pred-match-list",children:[f&&E.length===0&&e.jsx("div",{className:"bot-pred-loading",children:"Loading matches..."}),!f&&ke.length===0&&e.jsx("div",{className:"bot-pred-empty",children:v?"No matches found":"No live or scheduled matches"}),ke.map(L=>{const oe=L.match_key||L.id,ge=he===oe,je=Ba(L.status),be=Ia(L.status);return e.jsxs("div",{className:`bot-pred-match-item ${ge?"bot-pred-match-item-selected":""}`,onClick:()=>ye(L),children:[e.jsxs("div",{className:"bot-pred-match-row",children:[e.jsxs("div",{className:"bot-pred-match-teams",children:[e.jsx("span",{className:"bot-pred-match-home",children:L.home_team}),e.jsx("span",{className:"bot-pred-match-vs",children:"vs"}),e.jsx("span",{className:"bot-pred-match-away",children:L.away_team})]}),e.jsx("span",{className:"bot-pred-match-status",style:{background:je.bg,color:je.color},children:be})]}),e.jsxs("div",{className:"bot-pred-match-meta",children:[e.jsx("span",{className:"bot-pred-match-league",children:L.league||"Unknown League"}),L.score&&L.score!=="0-0"&&e.jsx("span",{className:"bot-pred-match-score",children:L.score}),L.minute&&e.jsxs("span",{className:"bot-pred-match-minute",children:[L.minute,"'"]})]})]},oe)})]})]}),e.jsx("div",{className:"bot-pred-form-panel",children:C?e.jsxs("div",{className:"bot-pred-form-content",children:[e.jsxs("div",{className:"bot-pred-selected-match",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"bot-pred-selected-teams",children:[C.home_team," vs ",C.away_team]}),e.jsx("span",{className:"bot-pred-selected-league",children:C.league||""})]}),e.jsx("button",{className:"bot-pred-analysis-link",onClick:()=>V(!se),children:se?"Hide Analysis":"Show Analysis"})]}),se&&e.jsx("div",{className:"bot-pred-analysis-panel",children:r?e.jsx("div",{className:"bot-pred-analysis-loading",children:"Loading analysis..."}):S?.prediction?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bot-pred-analysis-section",children:[e.jsx("div",{className:"bot-pred-analysis-heading",children:"AI Prediction"}),e.jsxs("div",{className:"bot-pred-analysis-row",children:[e.jsx("span",{className:"bot-pred-analysis-key",children:"Result:"}),e.jsx("strong",{children:S.prediction.predicted_outcome||S.prediction.match_info?.predicted_result||"â€”"})]}),S.prediction.confidence&&e.jsxs("div",{className:"bot-pred-analysis-row",children:[e.jsx("span",{className:"bot-pred-analysis-key",children:"Confidence:"}),e.jsxs("span",{children:[Math.round(S.prediction.confidence*100),"%"]})]}),S.prediction.predicted_score&&e.jsxs("div",{className:"bot-pred-analysis-row",children:[e.jsx("span",{className:"bot-pred-analysis-key",children:"Score:"}),e.jsx("span",{children:S.prediction.predicted_score})]}),(S.prediction.over_25||S.prediction.btts)&&e.jsxs("div",{className:"bot-pred-analysis-row",children:[S.prediction.over_25&&e.jsxs("span",{children:["Over 2.5: ",e.jsx("strong",{children:S.prediction.over_25})]}),S.prediction.btts&&e.jsxs("span",{style:{marginLeft:12},children:["BTTS: ",e.jsx("strong",{children:S.prediction.btts})]})]})]}),S.prediction.match_info?.team_a?.form&&e.jsxs("div",{className:"bot-pred-analysis-section",children:[e.jsx("div",{className:"bot-pred-analysis-heading",children:"Recent Form"}),e.jsxs("div",{className:"bot-pred-analysis-row",children:[e.jsxs("span",{className:"bot-pred-analysis-key",children:[C.home_team,":"]}),e.jsx("span",{className:"bot-pred-form-display",children:S.prediction.match_info.team_a.form.split("").map((L,oe)=>e.jsx("span",{className:`bot-pred-form-badge bot-pred-form-${L}`,children:L},oe))})]}),S.prediction.match_info?.team_b?.form&&e.jsxs("div",{className:"bot-pred-analysis-row",children:[e.jsxs("span",{className:"bot-pred-analysis-key",children:[C.away_team,":"]}),e.jsx("span",{className:"bot-pred-form-display",children:S.prediction.match_info.team_b.form.split("").map((L,oe)=>e.jsx("span",{className:`bot-pred-form-badge bot-pred-form-${L}`,children:L},oe))})]})]}),S.h2h?.summary&&e.jsxs("div",{className:"bot-pred-analysis-section",children:[e.jsx("div",{className:"bot-pred-analysis-heading",children:"Head to Head"}),e.jsx("div",{className:"bot-pred-analysis-row",children:e.jsx("span",{children:S.h2h.summary})})]}),S.h2h?.matches&&S.h2h.matches.length>0&&!S.h2h.summary&&e.jsxs("div",{className:"bot-pred-analysis-section",children:[e.jsxs("div",{className:"bot-pred-analysis-heading",children:["H2H (",S.h2h.matches.length," matches)"]}),S.h2h.matches.slice(0,5).map((L,oe)=>e.jsxs("div",{className:"bot-pred-analysis-row",style:{fontSize:11},children:[L.home_team," ",L.home_goals,"-",L.away_goals," ",L.away_team,e.jsx("span",{style:{color:"#888",marginLeft:6},children:L.date})]},oe))]}),S.prediction.reasoning&&e.jsxs("div",{className:"bot-pred-analysis-section",children:[e.jsx("div",{className:"bot-pred-analysis-heading",children:"AI Reasoning"}),e.jsx("div",{className:"bot-pred-analysis-reasoning",children:S.prediction.reasoning})]})]}):e.jsx("div",{className:"bot-pred-analysis-loading",children:C.home_team_id?"No analysis available":"Team data not available for analysis"})}),j==="single"?e.jsxs("div",{className:"bot-pred-single-form",children:[e.jsxs("div",{className:"bot-pred-field",children:[e.jsx("label",{className:"bot-pred-label",children:"Bot"}),e.jsxs("select",{className:"bot-pred-select",value:G,onChange:L=>g(L.target.value),disabled:y,children:[e.jsx("option",{value:"",children:y?"Loading bots...":"-- Select a bot --"}),F.map(L=>e.jsxs("option",{value:L.id,children:[L.display_name||L.username," (@",L.username,")"]},L.id))]})]}),e.jsxs("div",{className:"bot-pred-field",children:[e.jsx("label",{className:"bot-pred-label",children:"Predicted Result"}),e.jsx("input",{type:"text",className:"bot-pred-input",placeholder:'e.g. "Home Win", "Draw", "Away Win 2-1"',value:H,onChange:L=>I(L.target.value)})]}),e.jsxs("div",{className:"bot-pred-field",children:[e.jsx("label",{className:"bot-pred-label",children:"Analysis Summary"}),e.jsx("textarea",{className:"bot-pred-textarea",placeholder:'e.g. "Arsenal has been in great form..."',value:N,onChange:L=>P(L.target.value),rows:3})]}),e.jsxs("div",{className:"bot-pred-inline-fields",children:[e.jsxs("div",{className:"bot-pred-field bot-pred-field-small",children:[e.jsx("label",{className:"bot-pred-label",children:"Over 2.5 Goals"}),e.jsxs("select",{className:"bot-pred-select",value:K,onChange:L=>U(L.target.value),children:[e.jsx("option",{value:"skip",children:"Skip"}),e.jsx("option",{value:"Yes",children:"Yes"}),e.jsx("option",{value:"No",children:"No"})]})]}),e.jsxs("div",{className:"bot-pred-field bot-pred-field-small",children:[e.jsx("label",{className:"bot-pred-label",children:"BTTS"}),e.jsxs("select",{className:"bot-pred-select",value:u,onChange:L=>J(L.target.value),children:[e.jsx("option",{value:"skip",children:"Skip"}),e.jsx("option",{value:"Yes",children:"Yes"}),e.jsx("option",{value:"No",children:"No"})]})]}),e.jsxs("div",{className:"bot-pred-field bot-pred-field-small",children:[e.jsx("label",{className:"bot-pred-label",children:"Odds"}),e.jsx("input",{type:"number",className:"bot-pred-input",placeholder:"e.g. 1.85",value:b,onChange:L=>c(L.target.value),step:"0.01",min:"1"})]})]}),e.jsx("button",{className:"bot-pred-submit-btn",onClick:de,disabled:l||!G||!H.trim()||!C,children:l?"Creating...":"Create Prediction"})]}):e.jsxs("div",{className:"bot-pred-batch-form",children:[e.jsx("div",{className:"bot-pred-batch-info",children:e.jsx("span",{className:"bot-pred-batch-count",children:t&&t.length>0?`${t.length} bot${t.length!==1?"s":""} selected`:"No bots selected (select bots from the table above)"})}),e.jsxs("div",{className:"bot-pred-field",children:[e.jsxs("label",{className:"bot-pred-toggle-row",children:[e.jsx("span",{className:"bot-pred-label",style:{marginBottom:0},children:"Vary predictions"}),e.jsx("button",{type:"button",className:`bot-pred-toggle ${n?"bot-pred-toggle-on":""}`,onClick:()=>D(L=>!L),role:"switch","aria-checked":n,children:e.jsx("span",{className:"bot-pred-toggle-knob"})})]}),e.jsx("span",{className:"bot-pred-hint",children:n?"Bots will cycle through different prediction variations.":"All bots will post the same prediction."})]}),n?e.jsxs("div",{className:"bot-pred-variations",children:[e.jsx("label",{className:"bot-pred-label",children:"Prediction Variations"}),ae.map((L,oe)=>e.jsxs("div",{className:"bot-pred-variation-card",children:[e.jsxs("div",{className:"bot-pred-variation-header",children:[e.jsxs("span",{className:"bot-pred-variation-number",children:["Variation ",oe+1]}),ae.length>2&&e.jsx("button",{className:"bot-pred-variation-remove",onClick:()=>le(oe),title:"Remove variation",children:"Remove"})]}),e.jsxs("div",{className:"bot-pred-field",children:[e.jsx("label",{className:"bot-pred-label-sm",children:"Predicted Result"}),e.jsx("input",{type:"text",className:"bot-pred-input",placeholder:'e.g. "Home Win", "Draw"',value:L.predicted_result,onChange:ge=>$e(oe,"predicted_result",ge.target.value)})]}),e.jsxs("div",{className:"bot-pred-field",children:[e.jsx("label",{className:"bot-pred-label-sm",children:"Analysis Summary"}),e.jsx("textarea",{className:"bot-pred-textarea",placeholder:"Analysis for this variation...",value:L.analysis_summary,onChange:ge=>$e(oe,"analysis_summary",ge.target.value),rows:2})]})]},oe)),ae.length<5&&e.jsx("button",{className:"bot-pred-add-variation-btn",onClick:R,children:"+ Add Variation"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bot-pred-field",children:[e.jsx("label",{className:"bot-pred-label",children:"Predicted Result"}),e.jsx("input",{type:"text",className:"bot-pred-input",placeholder:'e.g. "Home Win", "Draw", "Away Win 2-1"',value:k,onChange:L=>$(L.target.value)})]}),e.jsxs("div",{className:"bot-pred-field",children:[e.jsx("label",{className:"bot-pred-label",children:"Analysis Summary"}),e.jsx("textarea",{className:"bot-pred-textarea",placeholder:'e.g. "Arsenal has been in great form..."',value:ie,onChange:L=>Z(L.target.value),rows:3})]})]}),e.jsxs("div",{className:"bot-pred-inline-fields",children:[e.jsxs("div",{className:"bot-pred-field bot-pred-field-small",children:[e.jsx("label",{className:"bot-pred-label",children:"Over 2.5 Goals"}),e.jsxs("select",{className:"bot-pred-select",value:w,onChange:L=>B(L.target.value),children:[e.jsx("option",{value:"skip",children:"Skip"}),e.jsx("option",{value:"Yes",children:"Yes"}),e.jsx("option",{value:"No",children:"No"})]})]}),e.jsxs("div",{className:"bot-pred-field bot-pred-field-small",children:[e.jsx("label",{className:"bot-pred-label",children:"BTTS"}),e.jsxs("select",{className:"bot-pred-select",value:X,onChange:L=>W(L.target.value),children:[e.jsx("option",{value:"skip",children:"Skip"}),e.jsx("option",{value:"Yes",children:"Yes"}),e.jsx("option",{value:"No",children:"No"})]})]}),e.jsxs("div",{className:"bot-pred-field bot-pred-field-small",children:[e.jsx("label",{className:"bot-pred-label",children:"Odds"}),e.jsx("input",{type:"number",className:"bot-pred-input",placeholder:"e.g. 1.85",value:ee,onChange:L=>M(L.target.value),step:"0.01",min:"1"})]})]}),e.jsx("button",{className:"bot-pred-submit-btn",onClick:ue,disabled:l||!C||!t||t.length===0||!n&&!k.trim()||n&&ae.every(L=>!L.predicted_result.trim()),children:l?"Creating...":`Create Predictions (${t?.length||0} bots)`})]})]}):e.jsxs("div",{className:"bot-pred-placeholder",children:[e.jsx("div",{className:"bot-pred-placeholder-icon",children:e.jsxs("svg",{width:"40",height:"40",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M12 20h9"}),e.jsx("path",{d:"M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"})]})}),e.jsx("p",{className:"bot-pred-placeholder-text",children:"Select a match to create a prediction"})]})})]})]})}const Oa=[{key:"manage",label:"Bot Management"},{key:"livechat",label:"Live Chat"},{key:"queue",label:"Message Queue"},{key:"replies",label:"Reply Monitor"},{key:"predictions",label:"Create Predictions"}],ys=[{value:"match_chat",label:"Live Chat",icon:"âš½",targetLabel:"Match Key",needsMessage:!0},{value:"prediction_chat",label:"Send Prediction Chat",icon:"ðŸ’¬",targetLabel:"Prediction ID",needsMessage:!0},{value:"comment",label:"Comment on Prediction",icon:"ðŸ“",targetLabel:"Prediction ID",needsMessage:!0},{value:"follow",label:"Follow User",icon:"âž•",targetLabel:"User ID",needsMessage:!1},{value:"unfollow",label:"Unfollow User",icon:"âž–",targetLabel:"User ID",needsMessage:!1},{value:"react",label:"React to Prediction",icon:"ðŸ‘",targetLabel:"Prediction ID",needsMessage:!1,hasReaction:!0}];function Wa(){const{getAuthHeaders:a}=fe(),[t,j]=s.useState("manage"),[p,E]=s.useState({total:0,active:0,assigned:0,unassigned:0}),[h,f]=s.useState([]),[o,v]=s.useState(!0),[_,C]=s.useState(1),[x,F]=s.useState(1),[q,y]=s.useState(0),[z,G]=s.useState("all"),[g,H]=s.useState(""),I=s.useRef(null),[N,P]=s.useState([]),[K,U]=s.useState(!1),[u,J]=s.useState(50),[b,c]=s.useState(""),[n,D]=s.useState(!1),[k,$]=s.useState(""),[ie,Z]=s.useState(""),[w,B]=s.useState(!1),[X,W]=s.useState([]),[ee,M]=s.useState(""),[ae,A]=s.useState(!1),[S,m]=s.useState(null),[r,Y]=s.useState("match_chat"),[se,V]=s.useState(""),[l,re]=s.useState(""),[Se,ve]=s.useState("like"),[Ce,Ae]=s.useState(!1),[ke,ye]=s.useState(null),[Te,$e]=s.useState(""),[R,le]=s.useState([]),[me,de]=s.useState(!1),[ue,he]=s.useState(!1),[L,oe]=s.useState(""),[ge,je]=s.useState([]),[be,Ne]=s.useState(!1),[Le,ze]=s.useState([]),[De,Me]=s.useState(!1),[Pe,Ge]=s.useState(""),[Ee,ss]=s.useState(1),[Oe,as]=s.useState(1),We=s.useRef(null),d=i=>{oe(i),setTimeout(()=>oe(""),4e3)},O=s.useCallback(async()=>{try{const i=await T.get("/api/admin/bots/stats",{headers:a()});E(i.data)}catch{}},[a]),te=s.useCallback(async()=>{v(!0);try{const i={page:_};z==="active"?i.is_active=1:z==="inactive"?i.is_active=0:z==="assigned"?i.assigned_to=-1:z==="unassigned"&&(i.is_active=void 0),g.trim()&&(i.search=g.trim()),z==="assigned"&&delete i.assigned_to;const ne=await T.get("/api/admin/bots",{headers:a(),params:i});f(ne.data.bots||[]),y(ne.data.total||0),F(ne.data.total_pages||1)}catch(i){console.error("Failed to fetch bots:",i)}v(!1)},[a,_,z,g]);s.useEffect(()=>{O()},[O]),s.useEffect(()=>{te()},[te]),s.useEffect(()=>{P([])},[_,z,g]);const xe=!!S;s.useEffect(()=>{xe&&(r==="match_chat"?xs():["comment","react","prediction_chat"].includes(r)&&(Ge(""),Ye(1,"")))},[r,xe]);const we=()=>{te(),O()},Be=i=>{H(i),I.current&&clearTimeout(I.current),I.current=setTimeout(()=>{C(1)},400)},He=async i=>{if(i.preventDefault(),$(""),Z(""),u<1||u>500){$("Count must be between 1 and 500");return}D(!0);try{const ne={count:u};b.trim()&&(ne.name_prefix=b.trim());const pe=await T.post("/api/admin/bots/create",ne,{headers:a()});Z(`Created ${pe.data.created||u} bot accounts`),J(50),c(""),U(!1),we(),setTimeout(()=>Z(""),5e3)}catch(ne){$(ne.response?.data?.detail||"Failed to create bots")}D(!1)},Ke=h.length>0&&h.every(i=>N.includes(i.id)),ts=()=>{P(Ke?[]:h.map(i=>i.id))},ws=i=>{P(ne=>ne.includes(i)?ne.filter(pe=>pe!==i):[...ne,i])},ks=async()=>{if(N.length!==0){he(!0);try{await T.post("/api/admin/bots/activate",{bot_ids:N},{headers:a()}),d(`Activated ${N.length} bot(s)`),P([]),we()}catch(i){alert(i.response?.data?.detail||"Failed")}he(!1)}},Cs=async()=>{if(N.length!==0){he(!0);try{await T.post("/api/admin/bots/deactivate",{bot_ids:N},{headers:a()}),d(`Deactivated ${N.length} bot(s)`),P([]),we()}catch(i){alert(i.response?.data?.detail||"Failed")}he(!1)}},As=async()=>{he(!0);try{await T.post("/api/admin/bots/activate-all",{},{headers:a()}),d("All bots activated"),we()}catch(i){alert(i.response?.data?.detail||"Failed")}he(!1)},$s=async()=>{he(!0);try{await T.post("/api/admin/bots/deactivate-all",{},{headers:a()}),d("All bots deactivated"),we()}catch(i){alert(i.response?.data?.detail||"Failed")}he(!1)},Ls=async()=>{if(N.length!==0&&confirm(`Permanently delete ${N.length} bot(s)? This cannot be undone.`)){he(!0);try{await T.post("/api/admin/bots/delete",{bot_ids:N},{headers:a()}),d(`Deleted ${N.length} bot(s)`),P([]),we()}catch(i){alert(i.response?.data?.detail||"Failed")}he(!1)}},Ts=async()=>{if(N.length!==0){he(!0);try{await T.post("/api/admin/bots/unassign",{bot_ids:N},{headers:a()}),d(`Unassigned ${N.length} bot(s)`),P([]),we()}catch(i){alert(i.response?.data?.detail||"Failed")}he(!1)}},hs=async i=>{try{i.is_active?await T.post("/api/admin/bots/deactivate",{bot_ids:[i.id]},{headers:a()}):await T.post("/api/admin/bots/activate",{bot_ids:[i.id]},{headers:a()}),we()}catch(ne){alert(ne.response?.data?.detail||"Failed")}},Ps=async i=>{try{await T.post("/api/admin/bots/unassign",{bot_ids:[i]},{headers:a()}),we()}catch(ne){alert(ne.response?.data?.detail||"Failed")}},Es=async()=>{if(N.length!==0){try{const i=await T.get("/api/admin/staff",{headers:a()});W(i.data.staff||[])}catch{}M(""),B(!0)}},Rs=async()=>{if(ee){A(!0);try{await T.post("/api/admin/bots/assign",{bot_ids:N,employee_user_id:parseInt(ee,10)},{headers:a()}),B(!1),P([]),d(`Assigned ${N.length} bot(s)`),we()}catch(i){alert(i.response?.data?.detail||"Failed")}A(!1)}},Ds=i=>{m({mode:"single",bot:i}),Y("match_chat"),V(""),re(""),ve("like"),ye(null),$e(""),le([])},Ms=()=>{N.length!==0&&(m({mode:"batch",botIds:[...N]}),Y("follow"),V(""),re(""),ve("like"),ye(null),$e(""),le([]))},ps=()=>{m(null),ye(null)},qe=ys.find(i=>i.value===r),qs=async i=>{if($e(i),!i.trim()){le([]);return}de(!0);try{const ne=await T.get("/api/admin/bots/users-search",{headers:a(),params:{search:i.trim(),limit:10}});le(ne.data.users||[])}catch{}de(!1)},Fs=i=>{V(String(i.id)),$e(""),le([])},xs=async()=>{Ne(!0);try{const i=await T.get("/api/admin/bots/live-matches",{headers:a()});je(i.data.matches||[])}catch{}Ne(!1)},Ye=async(i=1,ne="")=>{Me(!0);try{const pe=await T.get("/api/admin/bots/predictions",{headers:a(),params:{page:i,search:ne}});ze(pe.data.predictions||[]),ss(pe.data.page||1),as(pe.data.total_pages||1)}catch{}Me(!1)},Us=i=>{V(String(i.match_key||i.id))},Bs=i=>{V(String(i.id))},gs=async(i,ne)=>{if(S){Ae(!0),ye(null);try{const pe={action:ne,target_id:String(ne==="follow"?i.user_id:i.id)};if(ne==="react"&&(pe.reaction="like"),S.mode==="single")pe.bot_id=S.bot.id,await T.post("/api/admin/bots/action",pe,{headers:a()}),ye({success:!0,message:`${ne==="follow"?"Followed user":ne==="react"?"Liked prediction":"Done"}`});else{pe.bot_ids=S.botIds;const _e=await T.post("/api/admin/bots/batch-action",pe,{headers:a()});ye({success:!0,message:`${_e.data.successes}/${_e.data.total} bots succeeded`})}}catch(pe){ye({success:!1,message:pe.response?.data?.detail||"Action failed"})}Ae(!1)}},Is=async()=>{if(se.trim()){Ae(!0),ye(null);try{const i={action:r,target_id:se.trim()};if(qe?.needsMessage&&(i.message=l),qe?.hasReaction&&(i.reaction=Se),S.mode==="single"){i.bot_id=S.bot.id;const ne=await T.post("/api/admin/bots/action",i,{headers:a()});ye({success:!0,message:"Action executed successfully"})}else{i.bot_ids=S.botIds;const ne=await T.post("/api/admin/bots/batch-action",i,{headers:a()});ye({success:!0,message:`${ne.data.successes}/${ne.data.total} bots succeeded${ne.data.failures>0?` (${ne.data.failures} failed)`:""}`})}re("")}catch(i){ye({success:!1,message:i.response?.data?.detail||"Action failed"})}Ae(!1)}},zs=()=>{if(x<=1)return null;const i=[],ne=Math.max(1,_-2),pe=Math.min(x,_+2);for(let _e=ne;_e<=pe;_e++)i.push(e.jsx("button",{className:`admin-action-btn ${_e===_?"upgrade":""}`,onClick:()=>C(_e),style:{minWidth:36,padding:"4px 8px"},children:_e},_e));return e.jsxs("div",{style:{display:"flex",gap:4,justifyContent:"center",marginTop:16,flexWrap:"wrap",alignItems:"center"},children:[e.jsx("button",{className:"admin-action-btn",onClick:()=>C(1),disabled:_===1,children:"First"}),e.jsx("button",{className:"admin-action-btn",onClick:()=>C(_e=>Math.max(1,_e-1)),disabled:_===1,children:"Prev"}),i,e.jsx("button",{className:"admin-action-btn",onClick:()=>C(_e=>Math.min(x,_e+1)),disabled:_===x,children:"Next"}),e.jsx("button",{className:"admin-action-btn",onClick:()=>C(x),disabled:_===x,children:"Last"}),e.jsxs("span",{style:{fontSize:12,color:"#888",marginLeft:8},children:["Page ",_," of ",x]})]})};return o&&h.length===0&&t==="manage"?e.jsx("div",{className:"admin-loading",children:"Loading bots..."}):e.jsxs("div",{className:"admin-tab-content",children:[e.jsx("div",{className:"bot-view-nav",children:Oa.map(i=>e.jsx("button",{className:`bot-view-btn${t===i.key?" active":""}`,onClick:()=>j(i.key),children:i.label},i.key))}),t==="livechat"&&e.jsx(Ra,{getAuthHeaders:a}),t==="queue"&&e.jsx(Ma,{getAuthHeaders:a,selectedBotIds:N}),t==="replies"&&e.jsx(Fa,{getAuthHeaders:a}),t==="predictions"&&e.jsx(za,{getAuthHeaders:a,selectedBotIds:N}),t==="manage"&&e.jsxs(e.Fragment,{children:[L&&e.jsx("div",{style:{position:"fixed",top:20,right:20,zIndex:9999,background:"#2ecc71",color:"#fff",padding:"10px 20px",borderRadius:8,fontWeight:600,fontSize:14,boxShadow:"0 4px 16px rgba(0,0,0,0.3)"},children:L}),ie&&e.jsx("div",{style:{background:"rgba(46,204,113,0.15)",border:"1px solid rgba(46,204,113,0.3)",color:"#2ecc71",padding:"10px 16px",borderRadius:8,marginBottom:16,fontSize:14},children:ie}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:12,marginBottom:20},children:[{label:"Total Bots",value:p.total,color:"#fff"},{label:"Active",value:p.active,color:"#2ecc71"},{label:"Assigned",value:p.assigned,color:"#3498db"},{label:"Unassigned",value:p.unassigned,color:"#e67e22"}].map(i=>e.jsxs("div",{style:{background:"#1e2130",borderRadius:10,padding:"18px 20px",textAlign:"center",border:"1px solid #2d313a"},children:[e.jsx("div",{style:{fontSize:28,fontWeight:700,color:i.color},children:i.value}),e.jsx("div",{style:{fontSize:12,color:"#8b8fa3",marginTop:4,textTransform:"uppercase",letterSpacing:.5},children:i.label})]},i.label))}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap",marginBottom:16},children:[e.jsx("button",{className:`admin-action-btn ${K?"suspend":"upgrade"}`,onClick:()=>{U(!K),$("")},children:K?"Cancel":"+ Create Bots"}),e.jsx("div",{style:{borderLeft:"1px solid #2d313a",height:24,margin:"0 4px"}}),e.jsx("button",{className:"admin-action-btn upgrade",onClick:As,disabled:ue,children:"Activate All"}),e.jsx("button",{className:"admin-action-btn suspend",onClick:$s,disabled:ue,children:"Deactivate All"})]}),K&&e.jsxs("div",{className:"admin-create-staff-form",style:{marginBottom:16},children:[k&&e.jsx("div",{className:"admin-create-staff-error",children:k}),e.jsxs("form",{onSubmit:He,children:[e.jsxs("div",{className:"admin-create-staff-grid",children:[e.jsxs("div",{className:"admin-create-staff-field",children:[e.jsx("label",{children:"Number of Bots"}),e.jsx("input",{type:"number",value:u,onChange:i=>J(parseInt(i.target.value,10)||1),min:1,max:500,required:!0})]}),e.jsxs("div",{className:"admin-create-staff-field",children:[e.jsx("label",{children:"Name Prefix (optional)"}),e.jsx("input",{type:"text",value:b,onChange:i=>c(i.target.value),placeholder:"e.g. Fan, Supporter",maxLength:50})]})]}),e.jsx("p",{className:"admin-create-staff-note",children:"Bots get random names, usernames, and avatars. They appear as real users but cannot make purchases."}),e.jsx("button",{type:"submit",className:"admin-create-staff-submit",disabled:n,children:n?"Creating...":`Create ${u} Bots`})]})]}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap",marginBottom:12},children:[e.jsx("input",{type:"text",value:g,onChange:i=>Be(i.target.value),placeholder:"Search bots by name or username...",className:"admin-search-input",style:{flex:"1 1 200px",maxWidth:300}}),e.jsxs("select",{value:z,onChange:i=>{G(i.target.value),C(1)},className:"admin-filter-select",children:[e.jsx("option",{value:"all",children:"All Bots"}),e.jsx("option",{value:"active",children:"Active Only"}),e.jsx("option",{value:"inactive",children:"Inactive Only"})]}),e.jsxs("span",{style:{fontSize:13,color:"#8b8fa3"},children:[q," total"]})]}),N.length>0&&e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap",padding:"10px 14px",marginBottom:12,background:"rgba(108,92,231,0.08)",border:"1px solid rgba(108,92,231,0.2)",borderRadius:8,fontSize:13},children:[e.jsxs("strong",{style:{color:"#a29bfe"},children:[N.length," selected"]}),e.jsx("div",{style:{borderLeft:"1px solid #2d313a",height:20,margin:"0 4px"}}),e.jsx("button",{className:"admin-action-btn upgrade",onClick:ks,disabled:ue,children:"Activate"}),e.jsx("button",{className:"admin-action-btn suspend",onClick:Cs,disabled:ue,children:"Deactivate"}),e.jsx("button",{className:"admin-action-btn upgrade",onClick:Es,disabled:ue,children:"Assign"}),e.jsx("button",{className:"admin-action-btn reset-pw",onClick:Ts,disabled:ue,children:"Unassign"}),e.jsx("button",{className:"admin-action-btn reset-pw",onClick:Ms,disabled:ue,children:"Batch Action"}),e.jsx("button",{className:"admin-action-btn suspend",onClick:Ls,disabled:ue,children:"Delete"}),e.jsx("button",{style:{background:"none",border:"none",color:"#888",cursor:"pointer",fontSize:12},onClick:()=>P([]),children:"Clear"})]}),e.jsxs("div",{className:"admin-users-table",children:[e.jsxs("div",{className:"admin-table-header",children:[e.jsx("span",{style:{width:36,textAlign:"center"},children:e.jsx("input",{type:"checkbox",checked:Ke,onChange:ts})}),e.jsx("span",{className:"col-name",style:{flex:2},children:"Bot"}),e.jsx("span",{className:"col-status",children:"Status"}),e.jsx("span",{className:"col-tier",style:{flex:1},children:"Assigned To"}),e.jsx("span",{className:"col-joined",children:"Created"}),e.jsx("span",{className:"col-actions",style:{flex:1.5},children:"Actions"})]}),o?e.jsx("div",{className:"admin-loading",style:{padding:20},children:"Loading..."}):h.length===0?e.jsx("div",{className:"admin-empty-row",children:g?`No bots matching "${g}"`:"No bots found. Create some above!"}):h.map(i=>e.jsxs("div",{className:`admin-table-row ${i.is_active?"":"suspended"}`,children:[e.jsx("span",{style:{width:36,textAlign:"center"},children:e.jsx("input",{type:"checkbox",checked:N.includes(i.id),onChange:()=>ws(i.id)})}),e.jsxs("span",{className:"col-name",style:{flex:2,display:"flex",alignItems:"center",gap:8},children:[e.jsx("span",{className:"admin-user-avatar-sm",style:{background:i.avatar_color||"#6c5ce7"},children:(i.display_name||"?")[0].toUpperCase()}),e.jsxs("div",{children:[e.jsx("strong",{children:i.display_name||"Bot"}),e.jsxs("small",{style:{display:"block",color:"#666"},children:["@",i.username]})]})]}),e.jsx("span",{className:"col-status",children:e.jsx("span",{className:"admin-staff-role-tag",style:{background:i.is_active?"#2ecc71":"#636e72",fontSize:11,cursor:"pointer"},onClick:()=>hs(i),title:i.is_active?"Click to deactivate":"Click to activate",children:i.is_active?"ðŸŸ¢ Online":"âš« Offline"})}),e.jsx("span",{className:"col-tier",style:{flex:1},children:i.assigned_to_name?e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx("span",{style:{color:"#3498db"},children:i.assigned_to_name}),e.jsx("button",{onClick:()=>Ps(i.id),style:{background:"none",border:"none",color:"#e74c3c",cursor:"pointer",fontSize:14,padding:"0 2px",lineHeight:1},title:"Unassign",children:"âœ–"})]}):e.jsx("span",{style:{color:"#555"},children:"-"})}),e.jsx("span",{className:"col-joined",style:{fontSize:12},children:i.created_at?new Date(i.created_at).toLocaleDateString():"-"}),e.jsxs("span",{className:"col-actions",style:{flex:1.5,display:"flex",gap:4,flexWrap:"wrap"},children:[e.jsx("button",{className:`admin-action-btn ${i.is_active?"suspend":"upgrade"}`,onClick:()=>hs(i),style:{fontSize:11,padding:"3px 8px"},children:i.is_active?"Deactivate":"Activate"}),e.jsx("button",{className:"admin-action-btn reset-pw",onClick:()=>Ds(i),style:{fontSize:11,padding:"3px 8px"},children:"Action"})]})]},i.id))]}),zs(),w&&e.jsx("div",{className:"admin-modal-overlay",onClick:()=>B(!1),children:e.jsxs("div",{className:"admin-modal",onClick:i=>i.stopPropagation(),children:[e.jsxs("h3",{children:["Assign ",N.length," Bot(s) to Employee"]}),e.jsxs("select",{value:ee,onChange:i=>M(i.target.value),className:"admin-modal-input",children:[e.jsx("option",{value:"",children:"-- Select Employee --"}),X.map(i=>e.jsxs("option",{value:i.id,children:[i.display_name||i.username," (",i.role_display_name||i.staff_role||"Staff",")"]},i.id))]}),e.jsxs("div",{className:"admin-modal-actions",children:[e.jsx("button",{className:"admin-modal-cancel",onClick:()=>B(!1),children:"Cancel"}),e.jsx("button",{className:"admin-modal-confirm",onClick:Rs,disabled:!ee||ae,children:ae?"Assigning...":"Assign"})]})]})}),S&&e.jsx("div",{className:"admin-modal-overlay",onClick:ps,children:e.jsxs("div",{className:"admin-modal",onClick:i=>i.stopPropagation(),style:{maxWidth:640,maxHeight:"90vh",display:"flex",flexDirection:"column"},children:[e.jsxs("div",{style:{padding:"16px 20px",borderBottom:"1px solid #2d313a"},children:[e.jsx("h3",{style:{margin:0,marginBottom:4},children:S.mode==="batch"?`Batch Action (${S.botIds.length} bots)`:"Bot Action"}),S.mode==="single"&&e.jsxs("p",{className:"admin-modal-user",style:{margin:0},children:[e.jsx("span",{className:"admin-user-avatar-sm",style:{background:S.bot.avatar_color||"#6c5ce7",display:"inline-flex",verticalAlign:"middle",marginRight:8},children:(S.bot.display_name||"?")[0].toUpperCase()}),S.bot.display_name," (@",S.bot.username,")"]})]}),e.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"16px 20px"},children:[e.jsxs("div",{style:{marginBottom:14},children:[e.jsx("label",{style:{display:"block",marginBottom:6,fontSize:12,color:"#8b8fa3",textTransform:"uppercase",letterSpacing:.3},children:"Action Type"}),e.jsx("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:ys.map(i=>e.jsxs("button",{onClick:()=>{Y(i.value),ye(null),V("")},style:{padding:"6px 12px",borderRadius:6,fontSize:12,fontWeight:500,cursor:"pointer",border:"1px solid",background:r===i.value?"#6c5ce7":"transparent",borderColor:r===i.value?"#6c5ce7":"#2d313a",color:r===i.value?"#fff":"#aaa"},children:[i.icon," ",i.label]},i.value))})]}),r==="match_chat"&&e.jsxs("div",{style:{marginBottom:14},children:[e.jsx("label",{style:{display:"block",marginBottom:6,fontSize:12,color:"#8b8fa3",textTransform:"uppercase"},children:"Select a Match"}),be?e.jsx("div",{style:{textAlign:"center",padding:20,color:"#888"},children:"Loading matches..."}):ge.length===0?e.jsx("div",{style:{textAlign:"center",padding:20,color:"#666",background:"#1a1d23",borderRadius:8,border:"1px solid #2d313a"},children:"No live or scheduled matches right now"}):e.jsx("div",{style:{maxHeight:220,overflowY:"auto",background:"#1a1d23",border:"1px solid #2d313a",borderRadius:8},children:ge.map(i=>{const ne=se===String(i.match_key||i.id),pe=["1H","2H","HT","ET","LIVE"].includes(i.status);return e.jsxs("div",{onClick:()=>Us(i),style:{display:"flex",alignItems:"center",gap:10,padding:"10px 14px",cursor:"pointer",borderBottom:"1px solid #2d313a",background:ne?"rgba(108,92,231,0.15)":"transparent",borderLeft:ne?"3px solid #6c5ce7":"3px solid transparent"},onMouseEnter:_e=>{ne||(_e.currentTarget.style.background="rgba(255,255,255,0.03)")},onMouseLeave:_e=>{ne||(_e.currentTarget.style.background="transparent")},children:[e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("div",{style:{fontSize:13,fontWeight:600,color:"#e4e4e7"},children:[i.home_team," vs ",i.away_team]}),e.jsxs("div",{style:{fontSize:11,color:"#8b8fa3",marginTop:2},children:[i.league,i.score&&i.score!=="0-0"?` | ${i.score}`:"",i.minute?` | ${i.minute}'`:""]})]}),e.jsx("span",{style:{padding:"2px 8px",borderRadius:4,fontSize:11,fontWeight:600,background:pe?"rgba(231,76,60,0.15)":"rgba(52,152,219,0.15)",color:pe?"#e74c3c":"#3498db"},children:pe?"LIVE":i.status||"Scheduled"})]},i.id||i.match_key)})}),e.jsx("button",{onClick:xs,style:{marginTop:4,background:"none",border:"none",color:"#6c5ce7",cursor:"pointer",fontSize:12},children:"Refresh matches"})]}),["comment","react","prediction_chat"].includes(r)&&e.jsxs("div",{style:{marginBottom:14},children:[e.jsx("label",{style:{display:"block",marginBottom:6,fontSize:12,color:"#8b8fa3",textTransform:"uppercase"},children:"Browse Predictions"}),e.jsx("input",{type:"text",value:Pe,onChange:i=>{const ne=i.target.value;Ge(ne),We.current&&clearTimeout(We.current),We.current=setTimeout(()=>Ye(1,ne),400)},className:"admin-modal-input",placeholder:"Search predictions by user or match...",style:{marginBottom:8}}),De?e.jsx("div",{style:{textAlign:"center",padding:20,color:"#888"},children:"Loading predictions..."}):Le.length===0?e.jsx("div",{style:{textAlign:"center",padding:20,color:"#666",background:"#1a1d23",borderRadius:8,border:"1px solid #2d313a"},children:"No predictions found"}):e.jsx("div",{style:{maxHeight:260,overflowY:"auto",background:"#1a1d23",border:"1px solid #2d313a",borderRadius:8},children:Le.map(i=>{const ne=se===String(i.id);return e.jsxs("div",{onClick:()=>Bs(i),style:{padding:"10px 14px",cursor:"pointer",borderBottom:"1px solid #2d313a",background:ne?"rgba(108,92,231,0.15)":"transparent",borderLeft:ne?"3px solid #6c5ce7":"3px solid transparent"},onMouseEnter:pe=>{ne||(pe.currentTarget.style.background="rgba(255,255,255,0.03)")},onMouseLeave:pe=>{ne||(pe.currentTarget.style.background="transparent")},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4},children:[e.jsx("span",{className:"admin-user-avatar-sm",style:{background:i.avatar_color||"#6c5ce7",width:24,height:24,fontSize:10},children:(i.display_name||"?")[0].toUpperCase()}),e.jsx("strong",{style:{fontSize:13,color:"#e4e4e7"},children:i.display_name}),e.jsxs("span",{style:{color:"#666",fontSize:11},children:["@",i.username]})]}),e.jsx("div",{style:{fontSize:12,color:"#b0b3c6",marginBottom:3},children:i.match_description||"Match prediction"}),e.jsxs("div",{style:{fontSize:12,color:"#8b8fa3",marginBottom:6,fontStyle:"italic"},children:["â€œ",i.prediction_text?.substring(0,80),i.prediction_text?.length>80?"...":"","â€"]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,fontSize:11},children:[e.jsxs("span",{style:{color:"#2ecc71"},children:["ðŸ‘"," ",i.likes||0]}),e.jsxs("span",{style:{color:"#e74c3c"},children:["ðŸ‘Ž"," ",i.dislikes||0]}),e.jsxs("span",{style:{color:"#888"},children:["ðŸ’¬"," ",i.comment_count||0]}),e.jsxs("div",{style:{marginLeft:"auto",display:"flex",gap:6},children:[e.jsxs("button",{onClick:pe=>{pe.stopPropagation(),gs(i,"react")},disabled:Ce,style:{background:"rgba(46,204,113,0.12)",border:"1px solid rgba(46,204,113,0.25)",color:"#2ecc71",borderRadius:4,padding:"2px 8px",cursor:"pointer",fontSize:11},title:"Like this prediction",children:["ðŸ‘"," Like"]}),e.jsx("button",{onClick:pe=>{pe.stopPropagation(),gs(i,"follow")},disabled:Ce,style:{background:"rgba(108,92,231,0.12)",border:"1px solid rgba(108,92,231,0.25)",color:"#a29bfe",borderRadius:4,padding:"2px 8px",cursor:"pointer",fontSize:11},title:"Follow this user",children:"+ Follow"})]})]})]},i.id)})}),Oe>1&&e.jsxs("div",{style:{display:"flex",gap:4,justifyContent:"center",marginTop:8},children:[e.jsx("button",{onClick:()=>Ye(Ee-1,Pe),disabled:Ee<=1||De,style:{background:"none",border:"1px solid #2d313a",color:"#aaa",borderRadius:4,padding:"3px 10px",cursor:"pointer",fontSize:12},children:"Prev"}),e.jsxs("span",{style:{fontSize:12,color:"#888",padding:"3px 8px"},children:[Ee," / ",Oe]}),e.jsx("button",{onClick:()=>Ye(Ee+1,Pe),disabled:Ee>=Oe||De,style:{background:"none",border:"1px solid #2d313a",color:"#aaa",borderRadius:4,padding:"3px 10px",cursor:"pointer",fontSize:12},children:"Next"})]})]}),["follow","unfollow"].includes(r)&&e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("label",{style:{display:"block",marginBottom:4,fontSize:12,color:"#8b8fa3",textTransform:"uppercase"},children:"Search Users"}),e.jsx("input",{type:"text",value:Te,onChange:i=>qs(i.target.value),className:"admin-modal-input",placeholder:"Search users by name or username...",style:{marginBottom:4}}),R.length>0&&e.jsx("div",{style:{background:"#1a1d23",border:"1px solid #2d313a",borderRadius:6,maxHeight:160,overflowY:"auto"},children:R.map(i=>e.jsxs("div",{onClick:()=>Fs(i),style:{display:"flex",alignItems:"center",gap:8,padding:"6px 10px",cursor:"pointer",fontSize:13,borderBottom:"1px solid #2d313a"},onMouseEnter:ne=>ne.currentTarget.style.background="rgba(108,92,231,0.1)",onMouseLeave:ne=>ne.currentTarget.style.background="transparent",children:[e.jsx("span",{className:"admin-user-avatar-sm",style:{background:i.avatar_color||"#6c5ce7",width:26,height:26,fontSize:11},children:(i.display_name||"?")[0].toUpperCase()}),e.jsxs("div",{children:[e.jsx("strong",{style:{color:"#e4e4e7"},children:i.display_name}),e.jsxs("span",{style:{color:"#888",marginLeft:6},children:["@",i.username]})]}),e.jsxs("span",{style:{marginLeft:"auto",color:"#555",fontSize:11},children:["ID: ",i.id]})]},i.id))})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("label",{style:{display:"block",marginBottom:4,fontSize:12,color:"#8b8fa3",textTransform:"uppercase"},children:qe?.targetLabel||"Target ID"}),e.jsx("input",{type:"text",value:se,onChange:i=>V(i.target.value),className:"admin-modal-input",placeholder:qe?.targetLabel||"Enter target..."})]}),qe?.needsMessage&&e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("label",{style:{display:"block",marginBottom:4,fontSize:12,color:"#8b8fa3",textTransform:"uppercase"},children:"Message"}),e.jsx("textarea",{value:l,onChange:i=>re(i.target.value),className:"admin-modal-input",style:{minHeight:80,resize:"vertical"},placeholder:"Enter message..."})]}),qe?.hasReaction&&e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("label",{style:{display:"block",marginBottom:6,fontSize:12,color:"#8b8fa3",textTransform:"uppercase"},children:"Reaction"}),e.jsx("div",{style:{display:"flex",gap:12},children:["like","dislike"].map(i=>e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,cursor:"pointer",color:"#ccc",padding:"6px 12px",borderRadius:6,background:Se===i?"rgba(108,92,231,0.15)":"transparent",border:`1px solid ${Se===i?"#6c5ce7":"#2d313a"}`},children:[e.jsx("input",{type:"radio",name:"action_reaction",value:i,checked:Se===i,onChange:ne=>ve(ne.target.value),style:{accentColor:"#6c5ce7"}}),i==="like"?"ðŸ‘ Like":"ðŸ‘Ž Dislike"]},i))})]}),ke&&e.jsx("div",{style:{padding:"8px 12px",borderRadius:6,marginBottom:12,fontSize:13,background:ke.success?"rgba(46,204,113,0.12)":"rgba(231,76,60,0.12)",color:ke.success?"#2ecc71":"#e74c3c",border:`1px solid ${ke.success?"rgba(46,204,113,0.25)":"rgba(231,76,60,0.25)"}`},children:ke.message})]}),e.jsxs("div",{style:{padding:"12px 20px",borderTop:"1px solid #2d313a",display:"flex",gap:8,justifyContent:"flex-end"},children:[e.jsx("button",{className:"admin-modal-cancel",onClick:ps,children:"Close"}),e.jsx("button",{className:"admin-modal-confirm",onClick:Is,disabled:!se.trim()||Ce||qe?.needsMessage&&!l.trim(),children:Ce?"Executing...":S.mode==="batch"?`Execute on ${S.botIds.length} Bots`:"Execute"})]})]})})]})]})}function Ha(){return e.jsx(Os,{embedded:!0})}const Ns={high_clicks_no_engagement:"High clicks, no engagement",suspicious_click_ratio:"Suspicious click ratio (>80%)",review_purchase_volume:"High purchase volume",possible_bot_views:"Possible bot views"};function Ka(){const{getAuthHeaders:a}=fe(),[t,j]=s.useState(null),[p,E]=s.useState(!0),[h,f]=s.useState("all"),[o,v]=s.useState(""),_=s.useCallback(async()=>{try{const x=await T.get("/api/admin/creator-analytics",{headers:a()});j(x.data)}catch{}E(!1)},[a]);if(s.useEffect(()=>{_()},[_]),p)return e.jsx("div",{className:"admin-tab-content",children:e.jsxs("div",{className:"admin-loading",children:[e.jsx("div",{className:"admin-loading-spinner"}),e.jsx("p",{children:"Loading creator analytics..."})]})});if(!t)return e.jsx("div",{className:"admin-tab-content",children:e.jsx("div",{className:"admin-error-banner",children:"Failed to load analytics"})});let C=t.creators||[];if(h==="flagged"&&(C=C.filter(x=>x.has_flags)),o.trim()){const x=o.toLowerCase();C=C.filter(F=>F.display_name.toLowerCase().includes(x)||F.username.toLowerCase().includes(x))}return e.jsxs("div",{className:"admin-tab-content",children:[e.jsx("h2",{className:"admin-tab-title",children:"Creator Analytics"}),e.jsxs("div",{className:"admin-stats-grid",children:[e.jsx(Q,{label:"Total Creators",value:t.summary.total_creators,icon:"ðŸ‘¥",color:"#3498db"}),e.jsx(Q,{label:"Flagged",value:t.summary.flagged_creators,icon:"âš ï¸",color:"#e74c3c"}),e.jsx(Q,{label:"Total Views",value:(t.summary.total_views_all||0).toLocaleString(),icon:"ðŸ‘ï¸",color:"#2ecc71"}),e.jsx(Q,{label:"Total Clicks",value:(t.summary.total_clicks_all||0).toLocaleString(),icon:"ðŸ‘†",color:"#8b5cf6"}),e.jsx(Q,{label:"Total Revenue",value:`$${(t.summary.total_revenue_all||0).toFixed(2)}`,icon:"ðŸ’°",color:"#f39c12"})]}),e.jsxs("div",{style:ce.filterBar,children:[e.jsxs("div",{style:ce.filterTabs,children:[e.jsxs("button",{style:{...ce.filterTab,...h==="all"?ce.filterTabActive:{}},onClick:()=>f("all"),children:["All (",t.creators.length,")"]}),e.jsxs("button",{style:{...ce.filterTab,...h==="flagged"?ce.filterTabActive:{}},onClick:()=>f("flagged"),children:["Flagged (",t.summary.flagged_creators,")"]})]}),e.jsx("input",{type:"text",placeholder:"Search creators...",value:o,onChange:x=>v(x.target.value),style:ce.searchInput}),e.jsx("button",{style:ce.refreshBtn,onClick:()=>{E(!0),_()},children:"Refresh"})]}),C.length===0?e.jsx("div",{style:ce.empty,children:e.jsx("p",{children:h==="flagged"?"No flagged creators found.":"No creators found."})}):e.jsx("div",{style:ce.tableWrap,children:e.jsxs("table",{style:ce.table,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:ce.th,children:"Creator"}),e.jsx("th",{style:ce.thNum,children:"Preds"}),e.jsx("th",{style:ce.thNum,children:"Views"}),e.jsx("th",{style:ce.thNum,children:"Clicks"}),e.jsx("th",{style:ce.thNum,children:"CTR"}),e.jsx("th",{style:ce.thNum,children:"Likes"}),e.jsx("th",{style:ce.thNum,children:"Cmts"}),e.jsx("th",{style:ce.thNum,children:"Rating"}),e.jsx("th",{style:ce.thNum,children:"Buys"}),e.jsx("th",{style:ce.thNum,children:"Revenue"}),e.jsx("th",{style:ce.thNum,children:"Earned"}),e.jsx("th",{style:ce.th,children:"Status"})]})}),e.jsx("tbody",{children:C.map(x=>e.jsxs("tr",{style:x.has_flags?ce.flaggedRow:{},children:[e.jsx("td",{style:ce.td,children:e.jsxs("div",{style:ce.creatorCell,children:[e.jsx("div",{style:{...ce.avatar,background:x.avatar_color},children:(x.display_name||"?")[0].toUpperCase()}),e.jsxs("div",{children:[e.jsx("strong",{style:{fontSize:13,color:"#e2e8f0"},children:x.display_name}),e.jsxs("div",{style:{fontSize:11,color:"#64748b"},children:["@",x.username]})]})]})}),e.jsx("td",{style:ce.tdNum,children:x.prediction_count}),e.jsx("td",{style:ce.tdNum,children:x.total_views.toLocaleString()}),e.jsx("td",{style:ce.tdNum,children:x.total_clicks.toLocaleString()}),e.jsxs("td",{style:ce.tdNum,children:[x.click_through_rate,"%"]}),e.jsx("td",{style:ce.tdNum,children:x.total_likes}),e.jsx("td",{style:ce.tdNum,children:x.total_comments}),e.jsx("td",{style:ce.tdNum,children:x.avg_rating}),e.jsx("td",{style:ce.tdNum,children:x.total_purchases}),e.jsxs("td",{style:ce.tdNum,children:["$",x.total_revenue.toFixed(2)]}),e.jsxs("td",{style:ce.tdNum,children:["$",x.wallet.total_earned_usd.toFixed(2)]}),e.jsx("td",{style:ce.td,children:x.flags.length>0?e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:3},children:x.flags.map(F=>e.jsx("span",{style:ce.flagBadge,title:Ns[F]||F,children:Ns[F]||F},F))}):e.jsx("span",{style:ce.cleanBadge,children:"Clean"})})]},x.user_id))})]})})]})}const ce={filterBar:{display:"flex",alignItems:"center",gap:12,marginBottom:16,flexWrap:"wrap"},filterTabs:{display:"flex",gap:4,background:"#0f1629",borderRadius:8,padding:3},filterTab:{padding:"6px 14px",background:"none",border:"none",borderRadius:6,color:"#94a3b8",fontSize:13,cursor:"pointer",fontFamily:"inherit"},filterTabActive:{background:"#1e293b",color:"#e2e8f0"},searchInput:{flex:1,minWidth:160,padding:"7px 12px",background:"#111827",border:"1px solid #1e293b",borderRadius:6,color:"#e2e8f0",fontSize:13,outline:"none",fontFamily:"inherit"},refreshBtn:{padding:"7px 16px",background:"#1e293b",border:"1px solid #334155",borderRadius:6,color:"#94a3b8",fontSize:13,cursor:"pointer",fontFamily:"inherit"},empty:{textAlign:"center",padding:"40px 20px",color:"#64748b",fontSize:14},tableWrap:{overflowX:"auto",borderRadius:8,border:"1px solid #1e293b"},table:{width:"100%",borderCollapse:"collapse",fontSize:13},th:{textAlign:"left",padding:"10px 12px",background:"#111827",color:"#94a3b8",fontWeight:600,fontSize:12,borderBottom:"1px solid #1e293b",whiteSpace:"nowrap"},thNum:{textAlign:"center",padding:"10px 8px",background:"#111827",color:"#94a3b8",fontWeight:600,fontSize:12,borderBottom:"1px solid #1e293b",whiteSpace:"nowrap"},td:{padding:"10px 12px",borderBottom:"1px solid rgba(30,41,59,0.5)",color:"#cbd5e1"},tdNum:{padding:"10px 8px",borderBottom:"1px solid rgba(30,41,59,0.5)",color:"#cbd5e1",textAlign:"center"},flaggedRow:{background:"rgba(239,68,68,0.06)"},creatorCell:{display:"flex",alignItems:"center",gap:8,minWidth:140},avatar:{width:32,height:32,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontWeight:700,fontSize:14,flexShrink:0},flagBadge:{display:"inline-block",padding:"2px 8px",background:"rgba(239,68,68,0.15)",border:"1px solid rgba(239,68,68,0.3)",borderRadius:4,color:"#f87171",fontSize:11,whiteSpace:"nowrap"},cleanBadge:{display:"inline-block",padding:"2px 8px",background:"rgba(34,197,94,0.12)",border:"1px solid rgba(34,197,94,0.3)",borderRadius:4,color:"#4ade80",fontSize:11}},_s=[{id:"match_analyses",label:"Match analyses",hasLimit:!0,unlimitedLabel:"Unlimited match analyses",limitLabel:"{n} match analyses per day"},{id:"jackpot_analyses",label:"Jackpot analyses",hasLimit:!0,unlimitedLabel:"Unlimited jackpot analyses",limitLabel:"{n} jackpot analyses per day"},{id:"ai_chat",label:"AI chat prompts",hasLimit:!0,unlimitedLabel:"Unlimited AI chat prompts",limitLabel:"{n} AI chat prompts"},{id:"advanced_analytics",label:"Advanced analytics & value betting",hasLimit:!1},{id:"ad_free",label:"Ad-free experience",hasLimit:!1},{id:"priority_support",label:"Priority support",hasLimit:!1},{id:"save_weekly",label:"Save vs weekly pricing",hasLimit:!1,customLabel:!0,placeholder:"e.g. Save 20% vs weekly"},{id:"monthly_report",label:"Monthly insights report",hasLimit:!1},{id:"everything_weekly",label:"Everything in Weekly",hasLimit:!1}];function Va(){const{getAuthHeaders:a}=fe(),[t,j]=s.useState([]),[p,E]=s.useState(!0),[h,f]=s.useState(!1),[o,v]=s.useState(null),[_,C]=s.useState({}),[x,F]=s.useState(!1),[q,y]=s.useState({plan_id:"",name:"",price:"",currency:"USD",duration_days:""}),[z,G]=s.useState({}),[g,H]=s.useState(!1),[I,N]=s.useState(null),P=s.useCallback(async()=>{E(!0);try{const w=await T.get("/api/admin/pricing",{headers:a()});j(w.data.configs||[])}catch{}E(!1)},[a]);s.useEffect(()=>{P()},[P]);const K=(w,B)=>{C(X=>({...X,[w]:B}))},U=w=>_[w.config_key]!==void 0?_[w.config_key]:w.parsed_value,u=async()=>{if(Object.keys(_).length!==0){f(!0),v(null);try{await T.put("/api/admin/pricing",{updates:_},{headers:a()}),v({type:"success",text:"Pricing updated successfully! Changes are now live across the entire site."}),C({}),P()}catch(w){v({type:"error",text:w.response?.data?.detail||"Failed to save pricing changes"})}f(!1),setTimeout(()=>v(null),5e3)}},J=()=>{C({}),v(null)},b=async()=>{if(!q.plan_id||!q.name||!q.price||!q.duration_days){v({type:"error",text:"Please fill in all required fields for the new plan"});return}H(!0);try{const w=[];_s.forEach(B=>{const X=z[B.id];X?.enabled&&(B.hasLimit?X.unlimited?w.push(B.unlimitedLabel):X.limit&&w.push(B.limitLabel.replace("{n}",X.limit)):B.customLabel&&X.customText?w.push(X.customText):w.push(B.label))}),await T.post("/api/admin/pricing/plans",{plan_id:q.plan_id,name:q.name,price:parseFloat(q.price),currency:q.currency,duration_days:parseInt(q.duration_days),features:w},{headers:a()}),v({type:"success",text:`Plan "${q.name}" created successfully!`}),y({plan_id:"",name:"",price:"",currency:"USD",duration_days:""}),G({}),F(!1),P()}catch(w){v({type:"error",text:w.response?.data?.detail||"Failed to create plan"})}H(!1)},c=w=>{G(B=>{if((B[w]||{}).enabled){const W={...B};return delete W[w],W}return{...B,[w]:{enabled:!0,unlimited:!0,limit:"",customText:""}}})},n=(w,B,X)=>{G(W=>({...W,[w]:{...W[w],[B]:X}}))},D=async w=>{try{await T.delete(`/api/admin/pricing/plans/${w}`,{headers:a()}),v({type:"success",text:`Plan "${w}" deleted successfully`}),N(null),P()}catch(B){v({type:"error",text:B.response?.data?.detail||"Failed to delete plan"})}};if(p)return e.jsx("div",{className:"admin-loading",children:"Loading pricing configuration..."});const k={};t.forEach(w=>{k[w.category]||(k[w.category]=[]),k[w.category].push(w)});const $=t.find(w=>w.config_key==="plans_list"),ie=$?JSON.parse($.config_value):[],Z=Object.keys(_).length>0;return e.jsxs("div",{className:"admin-tab-content pricing-tab",children:[e.jsxs("div",{className:"admin-section-header",children:[e.jsx("h3",{children:"Pricing Management"}),e.jsx("span",{className:"pricing-subtitle",children:"Changes apply instantly across the entire platform"})]}),o&&e.jsx("div",{className:`pricing-message ${o.type}`,children:o.text}),e.jsxs("div",{className:"pricing-section",children:[e.jsxs("div",{className:"pricing-section-header",children:[e.jsx("h4",{children:"Subscription Plans"}),e.jsx("button",{className:"pricing-add-btn",onClick:()=>F(!x),children:x?"Cancel":"+ New Plan"})]}),x&&e.jsxs("div",{className:"pricing-new-plan-form",children:[e.jsx("h5",{children:"Create New Plan"}),e.jsxs("div",{className:"pricing-form-grid",children:[e.jsxs("div",{className:"pricing-form-group",children:[e.jsx("label",{children:"Plan ID *"}),e.jsx("input",{type:"text",value:q.plan_id,onChange:w=>y(B=>({...B,plan_id:w.target.value})),placeholder:"e.g. quarterly_usd",className:"pricing-input"}),e.jsx("small",{children:"Unique identifier (lowercase, no spaces)"})]}),e.jsxs("div",{className:"pricing-form-group",children:[e.jsx("label",{children:"Plan Name *"}),e.jsx("input",{type:"text",value:q.name,onChange:w=>y(B=>({...B,name:w.target.value})),placeholder:"e.g. Pro Quarterly (USD)",className:"pricing-input"})]}),e.jsxs("div",{className:"pricing-form-group",children:[e.jsx("label",{children:"Price *"}),e.jsx("input",{type:"number",value:q.price,onChange:w=>y(B=>({...B,price:w.target.value})),placeholder:"0.00",min:"0",step:"0.01",className:"pricing-input"})]}),e.jsxs("div",{className:"pricing-form-group",children:[e.jsx("label",{children:"Currency"}),e.jsxs("select",{value:q.currency,onChange:w=>y(B=>({...B,currency:w.target.value})),className:"pricing-input",children:[e.jsx("option",{value:"USD",children:"USD"}),e.jsx("option",{value:"KES",children:"KES"})]})]}),e.jsxs("div",{className:"pricing-form-group",children:[e.jsx("label",{children:"Duration (days) *"}),e.jsx("input",{type:"number",value:q.duration_days,onChange:w=>y(B=>({...B,duration_days:w.target.value})),placeholder:"30",min:"1",className:"pricing-input"})]}),e.jsxs("div",{className:"pricing-form-group full-width",children:[e.jsx("label",{children:"Plan Features"}),e.jsx("div",{className:"pricing-features-selector",children:_s.map(w=>{const B=z[w.id],X=B?.enabled;return e.jsxs("div",{className:`pricing-feature-option ${X?"active":""}`,children:[e.jsxs("label",{className:"pricing-feature-checkbox",children:[e.jsx("input",{type:"checkbox",checked:!!X,onChange:()=>c(w.id)}),e.jsx("span",{children:w.label})]}),X&&w.hasLimit&&e.jsxs("div",{className:"pricing-feature-limit",children:[e.jsxs("label",{className:"pricing-limit-toggle",children:[e.jsx("input",{type:"checkbox",checked:B?.unlimited??!0,onChange:W=>n(w.id,"unlimited",W.target.checked)}),e.jsx("span",{children:"Unlimited"})]}),!B?.unlimited&&e.jsx("input",{type:"number",className:"pricing-limit-input",value:B?.limit||"",onChange:W=>n(w.id,"limit",W.target.value),placeholder:"Limit per day",min:"1"})]}),X&&w.customLabel&&e.jsx("input",{type:"text",className:"pricing-input pricing-custom-label",value:B?.customText||"",onChange:W=>n(w.id,"customText",W.target.value),placeholder:w.placeholder})]},w.id)})})]})]}),e.jsx("button",{className:"pricing-create-btn",onClick:b,disabled:g,children:g?"Creating...":"Create Plan"})]}),(()=>{const w=W=>{const ee=t.find(V=>V.config_key===`plan_${W}_price`),M=t.find(V=>V.config_key===`plan_${W}_name`),ae=t.find(V=>V.config_key===`plan_${W}_duration`),A=t.find(V=>V.config_key===`plan_${W}_currency`),S=t.find(V=>V.config_key===`plan_${W}_features`);if(!ee||!M)return null;const m=A?U(A):W.endsWith("_kes")?"KES":"USD",r=m==="USD"?"$":"KES ",Y=U(S),se=Array.isArray(Y)?Y:[];return e.jsxs("div",{className:"pricing-plan-card",children:[e.jsxs("div",{className:"pricing-plan-card-header",children:[e.jsx("span",{className:`pricing-currency-badge ${m.toLowerCase()}`,children:m}),e.jsx("span",{className:"pricing-plan-id",children:W}),!["weekly_usd","weekly_kes","monthly_usd","monthly_kes"].includes(W)&&e.jsx("button",{className:"pricing-delete-btn",onClick:()=>N(W),title:"Delete plan",children:e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("polyline",{points:"3 6 5 6 21 6"}),e.jsx("path",{d:"M19 6l-1 14H6L5 6"}),e.jsx("path",{d:"M10 11v6"}),e.jsx("path",{d:"M14 11v6"}),e.jsx("path",{d:"M9 6V4h6v2"})]})})]}),e.jsxs("div",{className:"pricing-plan-fields",children:[e.jsxs("div",{className:"pricing-field",children:[e.jsx("label",{children:"Name"}),e.jsx("input",{type:"text",value:U(M),onChange:V=>K(M.config_key,V.target.value),className:"pricing-input"})]}),e.jsxs("div",{className:"pricing-field",children:[e.jsxs("label",{children:["Price (",r.trim(),")"]}),e.jsx("input",{type:"number",value:U(ee),onChange:V=>K(ee.config_key,V.target.value),min:"0",step:"0.01",className:"pricing-input"})]}),e.jsxs("div",{className:"pricing-field",children:[e.jsx("label",{children:"Duration (days)"}),e.jsx("input",{type:"number",value:U(ae),onChange:V=>K(ae.config_key,V.target.value),min:"1",className:"pricing-input"})]}),e.jsxs("div",{className:"pricing-field full-width",children:[e.jsxs("label",{children:["Features (",se.length,")"]}),e.jsx("textarea",{value:se.join(`
`),onChange:V=>K(S.config_key,V.target.value.split(`
`).filter(Boolean)),className:"pricing-input pricing-textarea",rows:3})]})]})]},W)},B=ie.filter(W=>{const ee=t.find(ae=>ae.config_key===`plan_${W}_currency`);return(ee?U(ee):W.endsWith("_kes")?"KES":"USD")==="USD"}),X=ie.filter(W=>{const ee=t.find(ae=>ae.config_key===`plan_${W}_currency`);return(ee?U(ee):W.endsWith("_kes")?"KES":"USD")==="KES"});return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"pricing-tier",children:[e.jsxs("div",{className:"pricing-tier-header usd",children:[e.jsx("span",{className:"pricing-tier-badge usd",children:"$"}),e.jsxs("div",{children:[e.jsx("h5",{className:"pricing-tier-title",children:"USD Packages â€” Rest of World"}),e.jsx("small",{className:"pricing-tier-desc",children:"Visible to all users outside Kenya. Payments via card."})]})]}),e.jsx("div",{className:"pricing-plans-grid",children:B.map(w)})]}),e.jsxs("div",{className:"pricing-tier",children:[e.jsxs("div",{className:"pricing-tier-header kes",children:[e.jsx("span",{className:"pricing-tier-badge kes",children:"KES"}),e.jsxs("div",{children:[e.jsx("h5",{className:"pricing-tier-title",children:"KES Packages â€” Kenya Only"}),e.jsx("small",{className:"pricing-tier-desc",children:"Visible only to users with a Kenyan IP address. Payments via M-Pesa."})]})]}),e.jsx("div",{className:"pricing-plans-grid",children:X.map(w)})]})]})})()]}),(()=>{const w=k.pay_per_use||[],B=w.filter(ee=>ee.config_key.includes("_usd")),X=w.filter(ee=>ee.config_key.includes("_kes")),W=(ee,M)=>e.jsxs("div",{className:"pricing-setting-card",children:[e.jsxs("div",{className:"pricing-setting-label",children:[e.jsx("span",{children:ee.label}),ee.description&&e.jsx("small",{children:ee.description})]}),e.jsxs("div",{className:"pricing-setting-input",children:[e.jsx("span",{className:"pricing-input-prefix",children:M}),e.jsx("input",{type:"number",value:U(ee),onChange:ae=>K(ee.config_key,ae.target.value),min:"0",step:"0.01",className:"pricing-input"})]})]},ee.config_key);return e.jsxs("div",{className:"pricing-section",children:[e.jsx("h4",{children:"Pay-Per-Use Pricing"}),e.jsxs("div",{className:"pricing-tier",children:[e.jsxs("div",{className:"pricing-tier-header usd",style:{marginBottom:12},children:[e.jsx("span",{className:"pricing-tier-badge usd",children:"$"}),e.jsx("h5",{className:"pricing-tier-title",style:{margin:0},children:"USD Pricing"})]}),e.jsx("div",{className:"pricing-settings-grid",children:B.map(ee=>W(ee,"$"))})]}),e.jsxs("div",{className:"pricing-tier",children:[e.jsxs("div",{className:"pricing-tier-header kes",style:{marginBottom:12},children:[e.jsx("span",{className:"pricing-tier-badge kes",children:"KES"}),e.jsx("h5",{className:"pricing-tier-title",style:{margin:0},children:"KES Pricing"})]}),e.jsx("div",{className:"pricing-settings-grid",children:X.map(ee=>W(ee,"KES"))})]})]})})(),e.jsxs("div",{className:"pricing-section",children:[e.jsx("h4",{children:"Commission Rates"}),e.jsx("div",{className:"pricing-settings-grid",children:(k.commissions||[]).map(w=>{const B=U(w),X=Math.round(B*100);return e.jsxs("div",{className:"pricing-setting-card",children:[e.jsxs("div",{className:"pricing-setting-label",children:[e.jsx("span",{children:w.label}),w.description&&e.jsx("small",{children:w.description})]}),e.jsxs("div",{className:"pricing-setting-input",children:[e.jsx("input",{type:"number",value:X,onChange:W=>K(w.config_key,(parseFloat(W.target.value)/100).toFixed(2)),min:"0",max:"100",step:"1",className:"pricing-input"}),e.jsx("span",{className:"pricing-input-suffix",children:"%"})]})]},w.config_key)})}),(()=>{const w=U(t.find(X=>X.config_key==="creator_sale_share")||{parsed_value:.7}),B=Math.round((1-w)*100);return e.jsxs("div",{className:"pricing-computed-note",children:["Platform fee on prediction sales: ",e.jsxs("strong",{children:[B,"%"]})," (100% - ",Math.round(w*100),"% creator share)"]})})()]}),e.jsxs("div",{className:"pricing-section",children:[e.jsx("h4",{children:"Free Tier Limits"}),e.jsx("div",{className:"pricing-settings-grid",children:(k.free_tier||[]).map(w=>e.jsxs("div",{className:"pricing-setting-card",children:[e.jsxs("div",{className:"pricing-setting-label",children:[e.jsx("span",{children:w.label}),w.description&&e.jsx("small",{children:w.description})]}),e.jsx("div",{className:"pricing-setting-input",children:e.jsx("input",{type:"number",value:U(w),onChange:B=>K(w.config_key,B.target.value),min:"0",step:"1",className:"pricing-input"})})]},w.config_key))})]}),Z&&e.jsxs("div",{className:"pricing-save-bar",children:[e.jsxs("span",{className:"pricing-save-count",children:[Object.keys(_).length," unsaved change(s)"]}),e.jsx("button",{className:"pricing-discard-btn",onClick:J,children:"Discard"}),e.jsx("button",{className:"pricing-save-btn",onClick:u,disabled:h,children:h?"Saving...":"Save Changes"})]}),I&&e.jsx("div",{className:"admin-modal-overlay",onClick:()=>N(null),children:e.jsxs("div",{className:"admin-modal",onClick:w=>w.stopPropagation(),children:[e.jsx("h3",{children:"Delete Plan"}),e.jsxs("p",{className:"admin-modal-user",children:["Are you sure you want to delete plan ",e.jsx("strong",{children:I}),"?"]}),e.jsx("p",{style:{color:"#fca5a5",fontSize:13},children:"This will remove the plan from the subscription options. Existing subscribers on this plan will not be affected."}),e.jsxs("div",{className:"admin-modal-actions",children:[e.jsx("button",{className:"admin-modal-cancel",onClick:()=>N(null),children:"Cancel"}),e.jsx("button",{className:"admin-modal-confirm",style:{background:"#dc2626"},onClick:()=>D(I),children:"Delete Plan"})]})]})})]})}function Ga(){const{getAuthHeaders:a}=fe(),[t,j]=s.useState(null),[p,E]=s.useState(!0),[h,f]=s.useState(30);s.useEffect(()=>{o()},[h]);async function o(){E(!0);try{const v=await T.get(`/api/admin/extension-analytics?days=${h}`,{headers:a()});j(v.data)}catch(v){console.error("Failed to load extension analytics:",v)}E(!1)}return p?e.jsx("div",{className:"admin-tab-loading",children:"Loading extension analytics..."}):t?e.jsxs("div",{className:"admin-tab-content",children:[e.jsxs("div",{className:"admin-tab-header",children:[e.jsx("h2",{children:"Chrome Extension Analytics"}),e.jsxs("select",{value:h,onChange:v=>f(Number(v.target.value)),className:"admin-select",children:[e.jsx("option",{value:7,children:"Last 7 days"}),e.jsx("option",{value:14,children:"Last 14 days"}),e.jsx("option",{value:30,children:"Last 30 days"}),e.jsx("option",{value:90,children:"Last 90 days"})]})]}),e.jsxs("div",{className:"admin-stats-grid",children:[e.jsxs("div",{className:"admin-stat-card",children:[e.jsx("div",{className:"admin-stat-value",children:t.total_extension_users}),e.jsx("div",{className:"admin-stat-label",children:"Extension Users"})]}),e.jsxs("div",{className:"admin-stat-card",children:[e.jsx("div",{className:"admin-stat-value",children:t.extension_predictions}),e.jsx("div",{className:"admin-stat-label",children:"Extension Predictions"})]}),e.jsxs("div",{className:"admin-stat-card",children:[e.jsx("div",{className:"admin-stat-value",children:t.total_events}),e.jsx("div",{className:"admin-stat-label",children:"Total Events"})]})]}),e.jsxs("div",{className:"admin-section",children:[e.jsx("h3",{children:"Events by Type"}),e.jsx("div",{className:"admin-table-wrap",children:e.jsxs("table",{className:"admin-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Action"}),e.jsx("th",{children:"Count"})]})}),e.jsx("tbody",{children:(t.by_action||[]).map((v,_)=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("span",{className:"admin-badge",style:{background:v.action.includes("login")?"rgba(59,130,246,0.15)":v.action==="prediction"?"rgba(34,197,94,0.15)":"rgba(148,163,184,0.1)",color:v.action.includes("login")?"#60a5fa":v.action==="prediction"?"#4ade80":"#94a3b8"},children:v.action})}),e.jsx("td",{children:v.cnt})]},_))})]})})]}),t.daily&&t.daily.length>0&&e.jsxs("div",{className:"admin-section",children:[e.jsx("h3",{children:"Daily Activity"}),e.jsx("div",{className:"admin-table-wrap",children:e.jsxs("table",{className:"admin-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Users"}),e.jsx("th",{children:"Events"})]})}),e.jsx("tbody",{children:t.daily.map((v,_)=>e.jsxs("tr",{children:[e.jsx("td",{children:v.day}),e.jsx("td",{children:v.users}),e.jsx("td",{children:v.events})]},_))})]})})]}),t.top_users&&t.top_users.length>0&&e.jsxs("div",{className:"admin-section",children:[e.jsx("h3",{children:"Top Extension Users"}),e.jsx("div",{className:"admin-table-wrap",children:e.jsxs("table",{className:"admin-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"User"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Events"}),e.jsx("th",{children:"Last Active"})]})}),e.jsx("tbody",{children:t.top_users.map((v,_)=>e.jsxs("tr",{children:[e.jsx("td",{children:v.display_name||v.username}),e.jsx("td",{style:{fontSize:12,color:"#64748b"},children:v.email}),e.jsx("td",{children:v.event_count}),e.jsx("td",{style:{fontSize:12,color:"#64748b"},children:v.last_active?new Date(v.last_active).toLocaleDateString():"-"})]},_))})]})})]})]}):e.jsx("div",{className:"admin-tab-empty",children:"Failed to load data"})}class Ya extends s.Component{constructor(t){super(t),this.state={hasError:!1,error:null}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,j){console.error("Admin Error:",t,j)}render(){return this.state.hasError?e.jsxs("div",{style:{padding:40,color:"#e74c3c",background:"#0f1117",minHeight:"100vh",fontFamily:"monospace"},children:[e.jsx("h2",{children:"Admin Portal Error"}),e.jsx("p",{children:this.state.error?.message}),e.jsx("pre",{style:{whiteSpace:"pre-wrap",fontSize:12,color:"#94a3b8"},children:this.state.error?.stack}),e.jsx("button",{onClick:()=>window.location.reload(),style:{marginTop:16,padding:"8px 16px",cursor:"pointer"},children:"Reload"})]}):this.props.children}}const Ja={overview:aa,online:na,users:ra,subscriptions:la,withdrawals:oa,community:da,referrals:ma,codes:ua,support:ga,staff:ba,activity:Sa,security:Aa,predictions:$a,sales:La,settings:Ta,broadcast:Pa,bots:Wa,docs:Ha,analytics:Ka,pricing:Va,extension:Ga};function Qa(){const{isLoggedIn:a,loading:t}=fe(),[j,p]=s.useState("overview");if(t)return e.jsxs("div",{className:"admin-loading",children:[e.jsx("div",{className:"admin-loading-spinner"}),e.jsx("p",{children:"Loading admin portal..."})]});if(!a)return e.jsx(Vs,{});const E=Ja[j];return e.jsxs("div",{className:"admin-page",children:[e.jsx(Js,{activeTab:j,setActiveTab:p}),e.jsx("div",{className:"admin-main",children:e.jsx("div",{className:"admin-content",children:E?e.jsx(E,{}):e.jsx("div",{children:"Tab not found"})})})]})}function et(){return e.jsx(Ya,{children:e.jsx(Ks,{children:e.jsx(Qa,{})})})}export{et as default};
