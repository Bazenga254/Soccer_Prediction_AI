import{u as P,a as $,r as t,c as G,j as e}from"./index-B3SC9TNl.js";const F=["âš½","ðŸ¥…","ðŸ†","ðŸ”¥","ðŸ’ª","ðŸ‘","ðŸŽ¯","ðŸ‘","ðŸ‘Ž","ðŸ˜‚","ðŸ˜­","ðŸ™","â¤ï¸","ðŸ’¯","ðŸ¤”","ðŸ˜","ðŸ¤£","ðŸ’€","ðŸ˜¤","ðŸ«¡","ðŸŽ‰","ðŸ˜Ž","ðŸ¤","ðŸ’°","â­","ðŸš€","ðŸ˜±"];function T({onSelect:n}){return e.jsx("div",{className:"emoji-picker",onClick:a=>a.stopPropagation(),children:e.jsx("div",{className:"emoji-picker-grid",children:F.map(a=>e.jsx("button",{className:"emoji-picker-btn",onClick:()=>n(a),type:"button",children:a},a))})})}function z({onSelect:n,onClose:a}){const[N,l]=t.useState(""),[y,o]=t.useState([]),[r,h]=t.useState(!1),[p,j]=t.useState(!1);t.useRef(null);const d=t.useCallback(async u=>{},[]);return t.useEffect(()=>{d("")},[d]),e.jsx("div",{className:"gif-picker",onClick:u=>u.stopPropagation(),children:e.jsx("div",{className:"gif-empty",style:{padding:"20px"},children:"GIF search is not configured"})})}function A(n){const a=n.match(/^\[gif\](.*?)\[\/gif\]$/);return a?e.jsx("img",{src:a[1],alt:"GIF",className:"chat-gif",loading:"lazy"}):e.jsx("p",{className:"chat-text",children:n})}function q({matchKey:n,matchName:a,onClose:N}){const{t:l}=P(),{user:y}=$(),[o,r]=t.useState([]),[h,p]=t.useState(""),[j,d]=t.useState(!1),[u,f]=t.useState(!1),[k,m]=t.useState(!1),[v,L]=t.useState(!0),g=t.useRef(0),b=t.useRef(null),S=t.useRef(null),C=t.useRef(null),x=t.useCallback(async(s=0)=>{try{const c=(await G.get(`/api/match/${n}/chat?since_id=${s}`)).data.messages||[];s===0?r(c):c.length>0&&r(_=>[..._,...c]),c.length>0&&(g.current=c[c.length-1].id)}catch{}},[n]);t.useEffect(()=>(document.body.classList.add("live-chat-open"),()=>document.body.classList.remove("live-chat-open")),[]),t.useEffect(()=>{g.current=0,r([]),x(0)},[n,x]),t.useEffect(()=>(S.current=setInterval(()=>{x(g.current)},3e3),()=>clearInterval(S.current)),[x]),t.useEffect(()=>{b.current&&b.current.scrollIntoView({behavior:"smooth"})},[o.length]);const w=async s=>{if(s.trim()){d(!0),f(!1),m(!1);try{const i=await G.post(`/api/match/${n}/chat`,{message:s});i.data.success&&(r(c=>[...c,i.data.chat]),g.current=i.data.chat.id,p(""))}catch{}d(!1)}},E=()=>w(h),M=s=>{w(`[gif]${s}[/gif]`)},R=s=>{p(i=>i+s),f(!1),C.current?.focus()},I=s=>new Date(s).toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"});return e.jsxs("div",{className:"live-chat-popup",children:[e.jsxs("div",{className:"live-chat-popup-header",onClick:()=>L(!v),children:[e.jsxs("div",{className:"live-chat-popup-title",children:[e.jsx("span",{className:"live-chat-popup-icon",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"})})}),e.jsx("span",{children:l("community.liveChat")}),e.jsx("span",{className:"live-chat-popup-badge",children:o.length})]}),e.jsxs("div",{className:"live-chat-popup-actions",children:[e.jsx("button",{className:"live-chat-popup-minimize",children:v?"â–¼":"â–²"}),e.jsx("button",{className:"live-chat-popup-close",onClick:s=>{s.stopPropagation(),N()},children:"âœ•"})]})]}),v&&e.jsxs("div",{className:"live-chat-popup-body",children:[e.jsx("div",{className:"live-chat-popup-match-name",children:a}),e.jsxs("div",{className:"live-chat-popup-messages",children:[o.length===0&&e.jsx("p",{className:"chat-empty",children:l("community.noChatMessagesAlt")}),o.map(s=>e.jsxs("div",{className:`chat-bubble ${s.user_id===y?.id?"own":""}`,children:[e.jsx("span",{className:"chat-avatar",style:{background:s.avatar_color},children:(s.display_name||"?")[0].toUpperCase()}),e.jsxs("div",{className:"chat-bubble-content",children:[e.jsxs("div",{className:"chat-bubble-header",children:[e.jsx("strong",{children:s.display_name}),e.jsx("span",{className:"chat-time",children:I(s.created_at)})]}),A(s.message)]})]},s.id)),e.jsx("div",{ref:b})]}),e.jsxs("div",{className:"live-chat-popup-input",children:[e.jsx("button",{className:"emoji-toggle-btn",onClick:()=>{f(!u),m(!1)},type:"button",title:l("community.emojis"),children:"ðŸ˜€"}),e.jsx("button",{className:"gif-toggle-btn",onClick:()=>{m(!k),f(!1)},type:"button",title:"GIF",children:"GIF"}),u&&e.jsx(T,{onSelect:R}),k&&e.jsx(z,{onSelect:M,onClose:()=>m(!1)}),e.jsx("input",{ref:C,type:"text",value:h,onChange:s=>p(s.target.value),placeholder:l("community.discussMatch"),maxLength:500,onKeyDown:s=>s.key==="Enter"&&E(),disabled:j}),e.jsx("button",{className:"chat-send-btn",onClick:E,disabled:j||!h.trim(),children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"22",y1:"2",x2:"11",y2:"13"}),e.jsx("polygon",{points:"22 2 15 22 11 13 2 9 22 2"})]})})]})]})]})}export{q as L};
