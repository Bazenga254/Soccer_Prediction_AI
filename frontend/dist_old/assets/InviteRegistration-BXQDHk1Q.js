import{u as R,d as I,b as T,r as t,j as e,c as b}from"./index-B3SC9TNl.js";const L={owner:"#e74c3c",general_manager:"#3498db",sales_hod:"#2ecc71",customer_care_hod:"#e67e22",marketing_hod:"#9b59b6",predictions_hod:"#1abc9c",sales_agent:"#27ae60",customer_support_agent:"#f39c12",prediction_analyst:"#16a085"};function P(i){return i?i.replace(/_/g," ").replace(/\b\w/g,n=>n.toUpperCase()):""}function F(){const{t:i}=R(),{token:n}=I(),f=T(),[y,v]=t.useState(!0),[r,w]=t.useState(null),[g,m]=t.useState(null),[u,_]=t.useState(""),[o,S]=t.useState(""),[p,k]=t.useState(""),[c,x]=t.useState(!1),[N,d]=t.useState(null),[j,C]=t.useState(!1);t.useEffect(()=>{n?(async()=>{try{v(!0),m(null);const s=await b.get(`/api/invite/validate/${n}`);w(s.data)}catch(s){const l=s.response?.data?.detail||"This invite link is invalid or has expired.";m(l)}finally{v(!1)}})():(v(!1),m("No invite token provided."))},[n]);const E=async a=>{if(a.preventDefault(),d(null),!u.trim()||!o.trim()||!p.trim()){d(i("invite.allFieldsRequired"));return}if(o.length<6){d(i("invite.passwordMinLength"));return}try{x(!0);const s=await b.post("/api/invite/register",{token:n,email:u.trim(),password:o,display_name:p.trim()}),l=s.data.token||s.data.access_token;l&&localStorage.setItem("spark_token",l),f("/employee",{replace:!0})}catch(s){const l=s.response?.data?.detail||"Registration failed. Please try again.";d(l)}finally{x(!1)}};if(y)return e.jsx("div",{className:"invite-page",children:e.jsx("div",{className:"invite-container",children:e.jsxs("div",{className:"invite-loading",children:[e.jsx("div",{className:"invite-spinner"}),e.jsx("p",{children:i("invite.validating")})]})})});if(g)return e.jsx("div",{className:"invite-page",children:e.jsx("div",{className:"invite-container",children:e.jsxs("div",{className:"invite-error-card",children:[e.jsx("div",{className:"invite-error-icon",children:"!"}),e.jsx("h2",{className:"invite-error-title",children:i("invite.invalidInvite")}),e.jsx("p",{className:"invite-error-message",children:g}),e.jsx("p",{className:"invite-error-help",children:i("invite.contactManager")}),e.jsx("a",{href:"/login",className:"invite-btn invite-btn-secondary",children:i("invite.goToLogin")})]})})});const h=L[r?.role_name]||"#6c5ce7";return e.jsx("div",{className:"invite-page",children:e.jsx("div",{className:"invite-container",children:e.jsxs("div",{className:"invite-form-card",children:[e.jsxs("div",{className:"invite-header",children:[e.jsx("div",{className:"invite-logo",children:i("invite.sparkAI")}),e.jsx("h1",{className:"invite-title",children:i("invite.invitedToJoin")}),e.jsx("p",{className:"invite-subtitle",children:i("invite.completeRegistration")})]}),e.jsxs("div",{className:"invite-meta",children:[e.jsxs("div",{className:"invite-badge-row",children:[e.jsx("span",{className:"invite-role-badge",style:{background:h+"22",color:h,border:`1px solid ${h}44`},children:P(r?.role_name)}),r?.department&&e.jsx("span",{className:"invite-dept-badge",children:r.department})]}),r?.created_by_name&&e.jsxs("p",{className:"invite-invited-by",children:[i("invite.invitedByLabel")," ",e.jsx("strong",{children:r.created_by_name})]})]}),e.jsxs("form",{className:"invite-form",onSubmit:E,children:[e.jsxs("div",{className:"invite-form-group",children:[e.jsx("label",{className:"invite-label",htmlFor:"invite-display-name",children:i("invite.displayName")}),e.jsx("input",{id:"invite-display-name",type:"text",className:"invite-input",placeholder:i("invite.yourFullName"),value:p,onChange:a=>k(a.target.value),required:!0,autoComplete:"name",disabled:c})]}),e.jsxs("div",{className:"invite-form-group",children:[e.jsx("label",{className:"invite-label",htmlFor:"invite-email",children:i("invite.emailAddress")}),e.jsx("input",{id:"invite-email",type:"email",className:"invite-input",placeholder:i("invite.emailPlaceholder"),value:u,onChange:a=>_(a.target.value),required:!0,autoComplete:"email",disabled:c})]}),e.jsxs("div",{className:"invite-form-group",children:[e.jsx("label",{className:"invite-label",htmlFor:"invite-password",children:i("invite.password")}),e.jsxs("div",{className:"invite-password-wrapper",children:[e.jsx("input",{id:"invite-password",type:j?"text":"password",className:"invite-input",placeholder:i("invite.minCharacters"),value:o,onChange:a=>S(a.target.value),required:!0,minLength:6,autoComplete:"new-password",disabled:c}),e.jsx("button",{type:"button",className:"invite-password-toggle",onClick:()=>C(a=>!a),tabIndex:-1,children:i(j?"invite.hide":"invite.show")})]})]}),N&&e.jsx("div",{className:"invite-form-error",children:N}),e.jsx("button",{type:"submit",className:"invite-btn invite-btn-primary",disabled:c,children:i(c?"invite.creatingAccount":"invite.createAccount")})]}),e.jsx("div",{className:"invite-footer",children:e.jsxs("p",{children:[i("invite.alreadyHaveAccount")," ",e.jsx("a",{href:"/login",className:"invite-link",children:i("invite.signIn")})]})})]})})})}export{F as default};
